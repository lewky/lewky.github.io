<!doctype html><html lang><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta http-equiv=x-ua-compatible content="IE=edge, chrome=1"><title>PGP加解密 - Yulin Lewis' Blog</title><meta name=keywords content="雨临Lewis,Java,hugo,hexo,博客"><meta name=Description content="不想当写手的码农不是好咸鱼_(xз」∠)_"><meta property="og:title" content="PGP加解密"><meta property="og:description" content="PGP和GPG
对接客户需求时对方使用PGP对文件进行加解密，但PGP是商用的非对称加解密方式，可以改用Apache基金会推出的开源的GPG，两者的加解密可以无缝对接。
Linux通常自带GPG命令，可以直接使用。"><meta property="og:type" content="article"><meta property="og:url" content="https://lewky233.top/posts/pgp/"><meta property="og:image" content="https://lewky233.top/logo.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-06-16T00:19:39+08:00"><meta property="article:modified_time" content="2023-06-16T00:19:39+08:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://lewky233.top/logo.png"><meta name=twitter:title content="PGP加解密"><meta name=twitter:description content="PGP和GPG
对接客户需求时对方使用PGP对文件进行加解密，但PGP是商用的非对称加解密方式，可以改用Apache基金会推出的开源的GPG，两者的加解密可以无缝对接。
Linux通常自带GPG命令，可以直接使用。"><meta name=application-name content="雨临Lewis的博客"><meta name=apple-mobile-web-app-title content="雨临Lewis的博客"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://lewky233.top/posts/pgp/><link rel=prev href=https://lewky233.top/posts/apollo-issues/><link rel=next href=https://lewky233.top/posts/ssh-issues/><link rel=stylesheet href=https://unpkg.com/normalize.css@8.0.1/normalize.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=https://unpkg.com/@fortawesome/fontawesome-free@5.13.0/css/all.min.css><link rel=stylesheet href=https://unpkg.com/animate.css@3.7.2/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"PGP加解密","inLanguage":"","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/lewky233.top\/posts\/pgp\/"},"genre":"posts","keywords":"PGP, GPG, 加解密","wordcount":3937,"url":"https:\/\/lewky233.top\/posts\/pgp\/","datePublished":"2023-06-16T00:19:39+08:00","dateModified":"2023-06-16T00:19:39+08:00","license":"This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher":{"@type":"Organization","name":"雨临Lewis","logo":"https:\/\/lewky233.top\/images\/avatar.jpg"},"author":{"@type":"Person","name":"雨临Lewis"},"description":""}</script></head><body header-desktop=fixed header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><a href=https://github.com/lewky class=github-corner target=_blank title="Follow me on GitHub" aria-label="Follow me on GitHub"><svg width="3.5rem" height="3.5rem" viewBox="0 0 250 250" style="fill:#70b7fd;color:#fff;position:absolute;top:0;border:0;left:0;transform:scale(-1,1)" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentcolor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentcolor" class="octo-body"/></svg></a><div class=header-title><a href=/ title="Yulin Lewis' Blog"><span class=header-title-pre><i class='fas fa-fw fa-atom'></i></span>雨临Lewis</a></div><div class=menu><div class=menu-inner><div class=dropdown><a href=/posts/ class="menu-item menu-more dropbtn" title=点击查看所有文章><i class='fas fa-fw fa-archive'></i> 归档</a><div class="menu-more-content dropdown-content"><a href=/categories/ title><i class='fas fa-fw fa-th'></i> 分类 </a><a href=/tags/ title><i class='fas fa-fw fa-tag'></i> 标签 </a><a href=/about/ title><i class='fas fa-fw fa-at'></i> 关于</a></div></div><a class=menu-item href=/friends/ title=欢迎申请友链><i class='fas fa-fw fa-link'></i> 友链</a><div class=dropdown><a href=javascript:void(0); class="menu-item menu-more dropbtn" title=一些有意思的东东~><i class='fas fa-fw fa-fan fa-spin'></i> 趣味</a><div class="menu-more-content dropdown-content"><a href=/funny/high/ title="前方高能♂ 小心外放！" target=_blank rel=noopener><i class='fas fa-fw fa-dizzy'></i> 燥起来！ </a><a href=/funny/mikutap/ title=初音未来音乐游戏 target=_blank rel=noopener><i class='fas fa-fw fa-music'></i> 在线打碟 </a><a href=/funny/catch-the-cat/ title=逮住那只猫!><i class='fas fa-fw fa-cat'></i> 抓住猫咪</a></div></div><div class=dropdown><a href=/ class="menu-item menu-more dropbtn" title=回到首页><i class='fas fa-fw fa-atom'></i> 站点</a><div class="menu-more-content dropdown-content"><a href=/bbs/ title=来留言吧~><i class='fas fa-fw fa-comment'></i> 公告留言 </a><a href=https://seo.chinaz.com title target=_blank rel=noopener><i class='fas fa-fw fa-chart-line'></i> SEO查询 </a><a href=https://www.ping.cn/http/lewky233.top title target=_blank rel=noopener><i class='fas fa-fw fa-bezier-curve'></i> 网站测速 </a><a href=/posts/e62c38c4.html/ title><i class='fas fa-fw fa-cog fa-spin'></i> 建站日志</a></div></div><div class=dropdown><a href=javascript:void(0); class="menu-item menu-more dropbtn" title><i class='fas fa-fw fa-book'></i> 文档</a><div class="menu-more-content dropdown-content"><a href=https://gohugo.io/documentation/ title target=_blank rel=noopener><i class='fas fa-fw fa-star'></i> Hugo文档 </a><a href=https://javanote.doc.lewky233.top/ title=尚在完善中~ target=_blank rel=noopener><i class='fab fa-fw fa-java'></i> Java 笔记</a></div></div><a class=menu-item href=/search/ title=渲染搜索结果需要等待几秒钟~><i class='fas fa-fw fa-search'></i> 搜索
</a><span class="menu-item delimiter"></span>
<a href=https://travellings.link target=_blank class=menu-item rel=noopener title=开往-友链接力><i class='fas fa-fw fa-subway'></i></a>
<a href=https://rssblog.vercel.app/ class=menu-item target=_blank rel=noopener title=RSSBlog><i class='fas fa-fw fa-inbox'></i></a>
<a href=https://github.com/lewky class=menu-item target=_blank rel=noopener title=GitHub><i class='fab fa-fw fa-github'></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Yulin Lewis' Blog"><span class=header-title-pre><i class='fas fa-fw fa-atom'></i></span>雨临Lewis</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=dropdown><a href=/posts/ class="menu-item menu-more dropbtn" title=点击查看所有文章><i class='fas fa-fw fa-archive'></i> 归档</a><div class="menu-more-content dropdown-content"><a href=/categories/ title><i class='fas fa-fw fa-th'></i> 分类 </a><a href=/tags/ title><i class='fas fa-fw fa-tag'></i> 标签 </a><a href=/about/ title><i class='fas fa-fw fa-at'></i> 关于</a></div></div><a class=menu-item href=/friends/ title=欢迎申请友链><i class='fas fa-fw fa-link'></i> 友链</a><div class=dropdown><a href=javascript:void(0); class="menu-item menu-more dropbtn" title=一些有意思的东东~><i class='fas fa-fw fa-fan fa-spin'></i> 趣味</a><div class="menu-more-content dropdown-content"><a href=/funny/high/ title="前方高能♂ 小心外放！" target=_blank rel=noopener><i class='fas fa-fw fa-dizzy'></i> 燥起来！ </a><a href=/funny/mikutap/ title=初音未来音乐游戏 target=_blank rel=noopener><i class='fas fa-fw fa-music'></i> 在线打碟 </a><a href=/funny/catch-the-cat/ title=逮住那只猫!><i class='fas fa-fw fa-cat'></i> 抓住猫咪</a></div></div><div class=dropdown><a href=/ class="menu-item menu-more dropbtn" title=回到首页><i class='fas fa-fw fa-atom'></i> 站点</a><div class="menu-more-content dropdown-content"><a href=/bbs/ title=来留言吧~><i class='fas fa-fw fa-comment'></i> 公告留言 </a><a href=https://seo.chinaz.com title target=_blank rel=noopener><i class='fas fa-fw fa-chart-line'></i> SEO查询 </a><a href=https://www.ping.cn/http/lewky233.top title target=_blank rel=noopener><i class='fas fa-fw fa-bezier-curve'></i> 网站测速 </a><a href=/posts/e62c38c4.html/ title><i class='fas fa-fw fa-cog fa-spin'></i> 建站日志</a></div></div><div class=dropdown><a href=javascript:void(0); class="menu-item menu-more dropbtn" title><i class='fas fa-fw fa-book'></i> 文档</a><div class="menu-more-content dropdown-content"><a href=https://gohugo.io/documentation/ title target=_blank rel=noopener><i class='fas fa-fw fa-star'></i> Hugo文档 </a><a href=https://javanote.doc.lewky233.top/ title=尚在完善中~ target=_blank rel=noopener><i class='fab fa-fw fa-java'></i> Java 笔记</a></div></div><a class=menu-item href=/search/ title=渲染搜索结果需要等待几秒钟~><i class='fas fa-fw fa-search'></i> 搜索</a>
<a href=https://travellings.link target=_blank class=menu-item rel=noopener title=开往-友链接力><i class='fas fa-fw fa-subway'></i></a>
<a href=https://rssblog.vercel.app/ class=menu-item target=_blank rel=noopener title=RSSBlog><i class='fas fa-fw fa-inbox'></i></a>
<a href=https://github.com/lewky class=menu-item target=_blank rel=noopener title=GitHub><i class='fab fa-fw fa-github'></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>目录</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animated flipInX">PGP加解密</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw"></i>雨临Lewis</a></span>&nbsp;<span class=post-category>收录于 <a href=/categories/%E5%B7%A5%E4%BD%9C%E8%AE%B0%E5%BD%95/><i class="far fa-folder fa-fw"></i>工作记录</a></span></div><div class=post-meta-line><i class="far fa-calendar fa-fw"></i>&nbsp;<time datetime=2023-06-16>2023-06-16</time>&nbsp;<i class="far fa-calendar-plus fa-fw"></i>&nbsp;<time datetime=2023-06-16>2023-06-16</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 3937 字
<i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 8 分钟&nbsp;<span id=/posts/pgp/ class=leancloud_visitors data-flag-title=PGP加解密>
<i class="far fa-eye fa-fw"></i>&nbsp;<span class=leancloud-visitors-count></span>&nbsp;次阅读
</span>&nbsp;
<a href=#comments id=post-meta-vcount title=查看评论><i class="fas fa-comment fa-fw"></i>&nbsp;<span id=/posts/pgp/ class=waline-comment-count></span>&nbsp;条评论</a></div></div><div class="details toc" id=toc-static kept><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ol><li><a href=#pgp和gpg>PGP和GPG</a></li><li><a href=#生成pgp密钥>生成PGP密钥</a></li><li><a href=#列出已经生成的pgp密钥>列出已经生成的PGP密钥</a></li><li><a href=#导出pgp密钥>导出PGP密钥</a></li><li><a href=#导入pgp密钥>导入PGP密钥</a></li><li><a href=#删除pgp密钥>删除PGP密钥</a></li><li><a href=#java实现pgp加解密>Java实现PGP加解密</a></li><li><a href=#参考链接>参考链接</a></li></ol></nav></div></div><div class=content id=content><h2 id=pgp和gpg>PGP和GPG</h2><p>对接客户需求时对方使用PGP对文件进行加解密，但PGP是商用的非对称加解密方式，可以改用Apache基金会推出的开源的GPG，两者的加解密可以无缝对接。</p><p>Linux通常自带GPG命令，可以直接使用。</p><h2 id=生成pgp密钥>生成PGP密钥</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>输入gpg --gen-key
</span></span><span class=line><span class=cl>输入1，使用rsa算法
</span></span><span class=line><span class=cl>按下回车确定keysize
</span></span><span class=line><span class=cl>输入0，表明该密钥永不过期
</span></span><span class=line><span class=cl>输入y确定
</span></span><span class=line><span class=cl>输入xxx作为名字（请自行指定一个名字）
</span></span><span class=line><span class=cl>输入xxx作为邮箱（请自行指定一个邮箱）
</span></span><span class=line><span class=cl>按下回车跳过注释
</span></span><span class=line><span class=cl>输入o确定
</span></span><span class=line><span class=cl>输入私钥密码，后续若想修改密钥或解密需要用到该密码，然后回车确定
</span></span><span class=line><span class=cl>再次输入密码，回车确定
</span></span><span class=line><span class=cl>移动鼠标来提供随机数以生成密钥
</span></span></code></pre></td></tr></table></div></div><p>GPG生成密钥的最后一步需要采集随机数，通常此时会卡住无法生成，需要先安装协助生成密钥的工具<code>rng-tools</code>：</p><p><code>apt-get install rng-tools</code> 或 <code>yum install rng-tools</code></p><p>之后再执行命令，就能在采集随机数时瞬间生成密钥：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>rngd –r /dev/urandom
</span></span></code></pre></td></tr></table></div></div><h2 id=列出已经生成的pgp密钥>列出已经生成的PGP密钥</h2><p><code>-K</code>查询私钥，<code>-k</code>查询公钥，一次只能查询一种密钥。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>// 查询私钥
</span></span><span class=line><span class=cl>gpg -K
</span></span><span class=line><span class=cl>gpg --fingerprint -K --keyid-format long
</span></span><span class=line><span class=cl>// 查询公钥
</span></span><span class=line><span class=cl>gpg -k
</span></span><span class=line><span class=cl>gpg --fingerprint -k --keyid-format long
</span></span></code></pre></td></tr></table></div></div><p>这里导出的密钥会附带显示keyId。</p><p>keyId相当于一对密钥的别名，GPG密钥库里会把每次生成的密钥对都保存进去，因此会用keyId来区分，如果不指定keyId则会全部导出来。后续加解密时使用到密钥库文件其实也会通过keyId来获取对应的密钥对。</p><h2 id=导出pgp密钥>导出PGP密钥</h2><p><code>-a</code>即<code>--armor</code>，表示以ASCII格式输出，即Base64串。</p><p><code>-o</code>即<code>--output FILE</code>，表示写入到文件里。</p><p><code>–-export</code>导出公钥，<code>–-export-secret-keys</code>导出私钥，后面通过指定keyId导出对应的密钥。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>// 导出公钥，97E208A1是keyId
</span></span><span class=line><span class=cl>gpg –a –o public-file.key –-export 97E208A1
</span></span><span class=line><span class=cl>// 导出私钥，97E208A1是keyId
</span></span><span class=line><span class=cl>gpg -a –o private-file.key –-export-secret-keys 97E208A1
</span></span></code></pre></td></tr></table></div></div><h2 id=导入pgp密钥>导入PGP密钥</h2><p>假设公钥文件是<code>public-file.key</code>，私钥文件是<code>private-file.key</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>gpg --import public-file.key
</span></span><span class=line><span class=cl>gpg --import private-file.key
</span></span></code></pre></td></tr></table></div></div><h2 id=删除pgp密钥>删除PGP密钥</h2><p><code>--delete-keys</code>删除公钥，<code>--delete-secret-keys</code>删除私钥。</p><p>在同时拥有一对公钥和私钥时，需要先删除私钥，才能删除公钥。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>// 删除公钥，97E208A1是keyId
</span></span><span class=line><span class=cl>gpg --delete-keys 97E208A1
</span></span><span class=line><span class=cl>// 删除私钥，97E208A1是keyId
</span></span><span class=line><span class=cl>gpg --delete-secret-keys 97E208A1
</span></span></code></pre></td></tr></table></div></div><h2 id=java实现pgp加解密>Java实现PGP加解密</h2><p>Java使用openpgp库来实现，pom依赖：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>	<span class=nt>&lt;groupId&gt;</span>org.bouncycastle<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>	<span class=nt>&lt;artifactId&gt;</span>bcprov-jdk15on<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>	<span class=nt>&lt;version&gt;</span>1.58<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/dependency&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>	<span class=nt>&lt;groupId&gt;</span>org.bouncycastle<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>	<span class=nt>&lt;artifactId&gt;</span>bcpg-jdk15on<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>	<span class=nt>&lt;version&gt;</span>1.58<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/dependency&gt;</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span><span class=lnt>175
</span><span class=lnt>176
</span><span class=lnt>177
</span><span class=lnt>178
</span><span class=lnt>179
</span><span class=lnt>180
</span><span class=lnt>181
</span><span class=lnt>182
</span><span class=lnt>183
</span><span class=lnt>184
</span><span class=lnt>185
</span><span class=lnt>186
</span><span class=lnt>187
</span><span class=lnt>188
</span><span class=lnt>189
</span><span class=lnt>190
</span><span class=lnt>191
</span><span class=lnt>192
</span><span class=lnt>193
</span><span class=lnt>194
</span><span class=lnt>195
</span><span class=lnt>196
</span><span class=lnt>197
</span><span class=lnt>198
</span><span class=lnt>199
</span><span class=lnt>200
</span><span class=lnt>201
</span><span class=lnt>202
</span><span class=lnt>203
</span><span class=lnt>204
</span><span class=lnt>205
</span><span class=lnt>206
</span><span class=lnt>207
</span><span class=lnt>208
</span><span class=lnt>209
</span><span class=lnt>210
</span><span class=lnt>211
</span><span class=lnt>212
</span><span class=lnt>213
</span><span class=lnt>214
</span><span class=lnt>215
</span><span class=lnt>216
</span><span class=lnt>217
</span><span class=lnt>218
</span><span class=lnt>219
</span><span class=lnt>220
</span><span class=lnt>221
</span><span class=lnt>222
</span><span class=lnt>223
</span><span class=lnt>224
</span><span class=lnt>225
</span><span class=lnt>226
</span><span class=lnt>227
</span><span class=lnt>228
</span><span class=lnt>229
</span><span class=lnt>230
</span><span class=lnt>231
</span><span class=lnt>232
</span><span class=lnt>233
</span><span class=lnt>234
</span><span class=lnt>235
</span><span class=lnt>236
</span><span class=lnt>237
</span><span class=lnt>238
</span><span class=lnt>239
</span><span class=lnt>240
</span><span class=lnt>241
</span><span class=lnt>242
</span><span class=lnt>243
</span><span class=lnt>244
</span><span class=lnt>245
</span><span class=lnt>246
</span><span class=lnt>247
</span><span class=lnt>248
</span><span class=lnt>249
</span><span class=lnt>250
</span><span class=lnt>251
</span><span class=lnt>252
</span><span class=lnt>253
</span><span class=lnt>254
</span><span class=lnt>255
</span><span class=lnt>256
</span><span class=lnt>257
</span><span class=lnt>258
</span><span class=lnt>259
</span><span class=lnt>260
</span><span class=lnt>261
</span><span class=lnt>262
</span><span class=lnt>263
</span><span class=lnt>264
</span><span class=lnt>265
</span><span class=lnt>266
</span><span class=lnt>267
</span><span class=lnt>268
</span><span class=lnt>269
</span><span class=lnt>270
</span><span class=lnt>271
</span><span class=lnt>272
</span><span class=lnt>273
</span><span class=lnt>274
</span><span class=lnt>275
</span><span class=lnt>276
</span><span class=lnt>277
</span><span class=lnt>278
</span><span class=lnt>279
</span><span class=lnt>280
</span><span class=lnt>281
</span><span class=lnt>282
</span><span class=lnt>283
</span><span class=lnt>284
</span><span class=lnt>285
</span><span class=lnt>286
</span><span class=lnt>287
</span><span class=lnt>288
</span><span class=lnt>289
</span><span class=lnt>290
</span><span class=lnt>291
</span><span class=lnt>292
</span><span class=lnt>293
</span><span class=lnt>294
</span><span class=lnt>295
</span><span class=lnt>296
</span><span class=lnt>297
</span><span class=lnt>298
</span><span class=lnt>299
</span><span class=lnt>300
</span><span class=lnt>301
</span><span class=lnt>302
</span><span class=lnt>303
</span><span class=lnt>304
</span><span class=lnt>305
</span><span class=lnt>306
</span><span class=lnt>307
</span><span class=lnt>308
</span><span class=lnt>309
</span><span class=lnt>310
</span><span class=lnt>311
</span><span class=lnt>312
</span><span class=lnt>313
</span><span class=lnt>314
</span><span class=lnt>315
</span><span class=lnt>316
</span><span class=lnt>317
</span><span class=lnt>318
</span><span class=lnt>319
</span><span class=lnt>320
</span><span class=lnt>321
</span><span class=lnt>322
</span><span class=lnt>323
</span><span class=lnt>324
</span><span class=lnt>325
</span><span class=lnt>326
</span><span class=lnt>327
</span><span class=lnt>328
</span><span class=lnt>329
</span><span class=lnt>330
</span><span class=lnt>331
</span><span class=lnt>332
</span><span class=lnt>333
</span><span class=lnt>334
</span><span class=lnt>335
</span><span class=lnt>336
</span><span class=lnt>337
</span><span class=lnt>338
</span><span class=lnt>339
</span><span class=lnt>340
</span><span class=lnt>341
</span><span class=lnt>342
</span><span class=lnt>343
</span><span class=lnt>344
</span><span class=lnt>345
</span><span class=lnt>346
</span><span class=lnt>347
</span><span class=lnt>348
</span><span class=lnt>349
</span><span class=lnt>350
</span><span class=lnt>351
</span><span class=lnt>352
</span><span class=lnt>353
</span><span class=lnt>354
</span><span class=lnt>355
</span><span class=lnt>356
</span><span class=lnt>357
</span><span class=lnt>358
</span><span class=lnt>359
</span><span class=lnt>360
</span><span class=lnt>361
</span><span class=lnt>362
</span><span class=lnt>363
</span><span class=lnt>364
</span><span class=lnt>365
</span><span class=lnt>366
</span><span class=lnt>367
</span><span class=lnt>368
</span><span class=lnt>369
</span><span class=lnt>370
</span><span class=lnt>371
</span><span class=lnt>372
</span><span class=lnt>373
</span><span class=lnt>374
</span><span class=lnt>375
</span><span class=lnt>376
</span><span class=lnt>377
</span><span class=lnt>378
</span><span class=lnt>379
</span><span class=lnt>380
</span><span class=lnt>381
</span><span class=lnt>382
</span><span class=lnt>383
</span><span class=lnt>384
</span><span class=lnt>385
</span><span class=lnt>386
</span><span class=lnt>387
</span><span class=lnt>388
</span><span class=lnt>389
</span><span class=lnt>390
</span><span class=lnt>391
</span><span class=lnt>392
</span><span class=lnt>393
</span><span class=lnt>394
</span><span class=lnt>395
</span><span class=lnt>396
</span><span class=lnt>397
</span><span class=lnt>398
</span><span class=lnt>399
</span><span class=lnt>400
</span><span class=lnt>401
</span><span class=lnt>402
</span><span class=lnt>403
</span><span class=lnt>404
</span><span class=lnt>405
</span><span class=lnt>406
</span><span class=lnt>407
</span><span class=lnt>408
</span><span class=lnt>409
</span><span class=lnt>410
</span><span class=lnt>411
</span><span class=lnt>412
</span><span class=lnt>413
</span><span class=lnt>414
</span><span class=lnt>415
</span><span class=lnt>416
</span><span class=lnt>417
</span><span class=lnt>418
</span><span class=lnt>419
</span><span class=lnt>420
</span><span class=lnt>421
</span><span class=lnt>422
</span><span class=lnt>423
</span><span class=lnt>424
</span><span class=lnt>425
</span><span class=lnt>426
</span><span class=lnt>427
</span><span class=lnt>428
</span><span class=lnt>429
</span><span class=lnt>430
</span><span class=lnt>431
</span><span class=lnt>432
</span><span class=lnt>433
</span><span class=lnt>434
</span><span class=lnt>435
</span><span class=lnt>436
</span><span class=lnt>437
</span><span class=lnt>438
</span><span class=lnt>439
</span><span class=lnt>440
</span><span class=lnt>441
</span><span class=lnt>442
</span><span class=lnt>443
</span><span class=lnt>444
</span><span class=lnt>445
</span><span class=lnt>446
</span><span class=lnt>447
</span><span class=lnt>448
</span><span class=lnt>449
</span><span class=lnt>450
</span><span class=lnt>451
</span><span class=lnt>452
</span><span class=lnt>453
</span><span class=lnt>454
</span><span class=lnt>455
</span><span class=lnt>456
</span><span class=lnt>457
</span><span class=lnt>458
</span><span class=lnt>459
</span><span class=lnt>460
</span><span class=lnt>461
</span><span class=lnt>462
</span><span class=lnt>463
</span><span class=lnt>464
</span><span class=lnt>465
</span><span class=lnt>466
</span><span class=lnt>467
</span><span class=lnt>468
</span><span class=lnt>469
</span><span class=lnt>470
</span><span class=lnt>471
</span><span class=lnt>472
</span><span class=lnt>473
</span><span class=lnt>474
</span><span class=lnt>475
</span><span class=lnt>476
</span><span class=lnt>477
</span><span class=lnt>478
</span><span class=lnt>479
</span><span class=lnt>480
</span><span class=lnt>481
</span><span class=lnt>482
</span><span class=lnt>483
</span><span class=lnt>484
</span><span class=lnt>485
</span><span class=lnt>486
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.apache.commons.io.IOUtils</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.apache.commons.logging.Log</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.apache.commons.logging.LogFactory</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.bouncycastle.bcpg.ArmoredOutputStream</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.bouncycastle.bcpg.CompressionAlgorithmTags</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.bouncycastle.bcpg.HashAlgorithmTags</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.bouncycastle.jce.provider.BouncyCastleProvider</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.bouncycastle.openpgp.PGPCompressedData</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.bouncycastle.openpgp.PGPCompressedDataGenerator</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.bouncycastle.openpgp.PGPEncryptedData</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.bouncycastle.openpgp.PGPEncryptedDataGenerator</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.bouncycastle.openpgp.PGPEncryptedDataList</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.bouncycastle.openpgp.PGPException</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.bouncycastle.openpgp.PGPLiteralData</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.bouncycastle.openpgp.PGPObjectFactory</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.bouncycastle.openpgp.PGPOnePassSignature</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.bouncycastle.openpgp.PGPOnePassSignatureList</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.bouncycastle.openpgp.PGPPrivateKey</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.bouncycastle.openpgp.PGPPublicKey</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.bouncycastle.openpgp.PGPPublicKeyEncryptedData</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.bouncycastle.openpgp.PGPPublicKeyRing</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.bouncycastle.openpgp.PGPPublicKeyRingCollection</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.bouncycastle.openpgp.PGPSecretKey</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.bouncycastle.openpgp.PGPSecretKeyRing</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.bouncycastle.openpgp.PGPSecretKeyRingCollection</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.bouncycastle.openpgp.PGPSignature</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.bouncycastle.openpgp.PGPSignatureList</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.bouncycastle.openpgp.PGPUtil</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.bouncycastle.openpgp.jcajce.JcaPGPObjectFactory</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.bouncycastle.openpgp.operator.PGPDigestCalculator</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.bouncycastle.openpgp.operator.bc.BcKeyFingerprintCalculator</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.bouncycastle.openpgp.operator.bc.BcPGPContentVerifierBuilderProvider</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.bouncycastle.openpgp.operator.bc.BcPublicKeyDataDecryptorFactory</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.bouncycastle.openpgp.operator.jcajce.JcaKeyFingerprintCalculator</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.bouncycastle.openpgp.operator.jcajce.JcaPGPContentSignerBuilder</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.bouncycastle.openpgp.operator.jcajce.JcaPGPDigestCalculatorProviderBuilder</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.bouncycastle.openpgp.operator.jcajce.JcaPGPKeyPair</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.bouncycastle.openpgp.operator.jcajce.JcePBESecretKeyDecryptorBuilder</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.bouncycastle.openpgp.operator.jcajce.JcePBESecretKeyEncryptorBuilder</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.bouncycastle.openpgp.operator.jcajce.JcePGPDataEncryptorBuilder</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.bouncycastle.openpgp.operator.jcajce.JcePublicKeyKeyEncryptionMethodGenerator</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.bouncycastle.util.io.Streams</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.io.BufferedInputStream</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.io.BufferedOutputStream</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.io.ByteArrayInputStream</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.io.ByteArrayOutputStream</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.io.File</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.io.FileInputStream</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.io.FileOutputStream</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.io.IOException</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.io.InputStream</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.io.OutputStream</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.security.KeyPair</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.security.KeyPairGenerator</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.security.NoSuchProviderException</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.security.SecureRandom</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.security.Security</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.Date</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.Iterator</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * PGP加密解密方式
</span></span></span><span class=line><span class=cl><span class=cm> *
</span></span></span><span class=line><span class=cl><span class=cm> * @author Administrator
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>PGPUtils</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>static</span> <span class=kd>final</span> <span class=n>String</span> <span class=n>PROVIDER_BC</span> <span class=o>=</span> <span class=s>&#34;BC&#34;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>static</span> <span class=kd>final</span> <span class=n>String</span> <span class=n>RSA</span> <span class=o>=</span> <span class=s>&#34;RSA&#34;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>static</span> <span class=kd>final</span> <span class=n>Log</span> <span class=n>log</span> <span class=o>=</span> <span class=n>LogFactory</span><span class=o>.</span><span class=na>getLog</span><span class=o>(</span><span class=n>PGPUtils</span><span class=o>.</span><span class=na>class</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>static</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>Security</span><span class=o>.</span><span class=na>getProvider</span><span class=o>(</span><span class=n>PROVIDER_BC</span><span class=o>)</span> <span class=o>==</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>Security</span><span class=o>.</span><span class=na>addProvider</span><span class=o>(</span><span class=k>new</span> <span class=n>BouncyCastleProvider</span><span class=o>());</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 生成PGP密钥对
</span></span></span><span class=line><span class=cl><span class=cm>     *
</span></span></span><span class=line><span class=cl><span class=cm>     * @param keySize 生成多少位的密钥，如2048
</span></span></span><span class=line><span class=cl><span class=cm>     * @param passPhrase 私钥密码，可为空
</span></span></span><span class=line><span class=cl><span class=cm>     * @param identity 公钥的userId
</span></span></span><span class=line><span class=cl><span class=cm>     * @param pubKeyFile 公钥文件目录
</span></span></span><span class=line><span class=cl><span class=cm>     * @param priKeyFile 私钥文件目录
</span></span></span><span class=line><span class=cl><span class=cm>     * @param path 文件目录
</span></span></span><span class=line><span class=cl><span class=cm>     * @throws Exception
</span></span></span><span class=line><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>generatePGPKeyPair</span><span class=o>(</span><span class=kt>int</span> <span class=n>keySize</span><span class=o>,</span> <span class=n>String</span> <span class=n>passPhrase</span><span class=o>,</span> <span class=n>String</span> <span class=n>identity</span><span class=o>,</span> <span class=n>String</span> <span class=n>pubKeyFile</span><span class=o>,</span> <span class=n>String</span> <span class=n>priKeyFile</span><span class=o>,</span> <span class=n>String</span> <span class=n>path</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>createDirectory</span><span class=o>(</span><span class=n>path</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>KeyPairGenerator</span> <span class=n>keyPairGenerator</span> <span class=o>=</span> <span class=n>KeyPairGenerator</span><span class=o>.</span><span class=na>getInstance</span><span class=o>(</span><span class=n>RSA</span><span class=o>,</span> <span class=n>PROVIDER_BC</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>keyPairGenerator</span><span class=o>.</span><span class=na>initialize</span><span class=o>(</span><span class=n>keySize</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>KeyPair</span> <span class=n>keyPair</span> <span class=o>=</span> <span class=n>keyPairGenerator</span><span class=o>.</span><span class=na>generateKeyPair</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>OutputStream</span> <span class=n>priOs</span> <span class=o>=</span> <span class=kc>null</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=n>OutputStream</span> <span class=n>pubOs</span> <span class=o>=</span> <span class=kc>null</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=c1>// key format without armored
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=n>priOs</span> <span class=o>=</span> <span class=k>new</span> <span class=n>FileOutputStream</span><span class=o>(</span><span class=n>priKeyFile</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=n>pubOs</span> <span class=o>=</span> <span class=k>new</span> <span class=n>FileOutputStream</span><span class=o>(</span><span class=n>pubKeyFile</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=c1>// the pass phrase to open private key
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=kt>char</span><span class=o>[]</span> <span class=n>passPhrase_</span> <span class=o>=</span> <span class=n>passPhrase</span><span class=o>.</span><span class=na>toCharArray</span><span class=o>();</span>
</span></span><span class=line><span class=cl>            <span class=c1>// Hash algorithm using SHA1 as certificate
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=n>PGPDigestCalculator</span> <span class=n>sha1Calc</span> <span class=o>=</span> <span class=k>new</span> <span class=n>JcaPGPDigestCalculatorProviderBuilder</span><span class=o>().</span><span class=na>build</span><span class=o>().</span><span class=na>get</span><span class=o>(</span><span class=n>HashAlgorithmTags</span><span class=o>.</span><span class=na>SHA1</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=c1>// Generate RSA key pair
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=n>JcaPGPKeyPair</span> <span class=n>jcaPGPKeyPair</span> <span class=o>=</span> <span class=k>new</span> <span class=n>JcaPGPKeyPair</span><span class=o>(</span><span class=n>PGPPublicKey</span><span class=o>.</span><span class=na>RSA_GENERAL</span><span class=o>,</span> <span class=n>keyPair</span><span class=o>,</span> <span class=k>new</span> <span class=n>Date</span><span class=o>());</span>
</span></span><span class=line><span class=cl>            <span class=n>PGPSecretKey</span> <span class=n>pgpSecretKey</span> <span class=o>=</span> <span class=k>new</span> <span class=n>PGPSecretKey</span><span class=o>(</span><span class=n>PGPSignature</span><span class=o>.</span><span class=na>DEFAULT_CERTIFICATION</span><span class=o>,</span>
</span></span><span class=line><span class=cl>                    <span class=n>jcaPGPKeyPair</span><span class=o>,</span>
</span></span><span class=line><span class=cl>                    <span class=n>identity</span><span class=o>,</span>
</span></span><span class=line><span class=cl>                    <span class=n>sha1Calc</span><span class=o>,</span>
</span></span><span class=line><span class=cl>                    <span class=kc>null</span><span class=o>,</span>
</span></span><span class=line><span class=cl>                    <span class=kc>null</span><span class=o>,</span>
</span></span><span class=line><span class=cl>                    <span class=k>new</span> <span class=n>JcaPGPContentSignerBuilder</span><span class=o>(</span><span class=n>jcaPGPKeyPair</span><span class=o>.</span><span class=na>getPublicKey</span><span class=o>().</span><span class=na>getAlgorithm</span><span class=o>(),</span> <span class=n>HashAlgorithmTags</span><span class=o>.</span><span class=na>SHA1</span><span class=o>),</span>
</span></span><span class=line><span class=cl>                    <span class=k>new</span> <span class=n>JcePBESecretKeyEncryptorBuilder</span><span class=o>(</span><span class=n>PGPEncryptedData</span><span class=o>.</span><span class=na>CAST5</span><span class=o>,</span> <span class=n>sha1Calc</span><span class=o>).</span><span class=na>setProvider</span><span class=o>(</span><span class=n>PROVIDER_BC</span><span class=o>).</span><span class=na>build</span><span class=o>(</span><span class=n>passPhrase_</span><span class=o>));</span>
</span></span><span class=line><span class=cl>            <span class=n>String</span> <span class=n>privateKeyBase64Str</span> <span class=o>=</span> <span class=n>Base64</span><span class=o>.</span><span class=na>encode</span><span class=o>(</span><span class=n>pgpSecretKey</span><span class=o>.</span><span class=na>getEncoded</span><span class=o>());</span>
</span></span><span class=line><span class=cl>            <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;PGP密钥Base64串：\r\n&#34;</span> <span class=o>+</span> <span class=n>privateKeyBase64Str</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=n>priOs</span><span class=o>.</span><span class=na>write</span><span class=o>(</span><span class=n>privateKeyBase64Str</span><span class=o>.</span><span class=na>getBytes</span><span class=o>());</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>PGPPublicKey</span> <span class=n>publicKey</span> <span class=o>=</span> <span class=n>pgpSecretKey</span><span class=o>.</span><span class=na>getPublicKey</span><span class=o>();</span>
</span></span><span class=line><span class=cl>            <span class=n>String</span> <span class=n>publicKeyBase64Str</span> <span class=o>=</span> <span class=n>Base64</span><span class=o>.</span><span class=na>encode</span><span class=o>(</span><span class=n>publicKey</span><span class=o>.</span><span class=na>getEncoded</span><span class=o>());</span>
</span></span><span class=line><span class=cl>            <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;PGP公钥Base64串：\r\n&#34;</span> <span class=o>+</span> <span class=n>publicKeyBase64Str</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;PGP公钥信息：\r\n&#34;</span> <span class=o>+</span> <span class=n>publicKey</span><span class=o>.</span><span class=na>getKeyID</span><span class=o>());</span>
</span></span><span class=line><span class=cl>            <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;PGP公钥信息：\r\n&#34;</span> <span class=o>+</span> <span class=n>publicKey</span><span class=o>.</span><span class=na>getUserIDs</span><span class=o>().</span><span class=na>next</span><span class=o>());</span>
</span></span><span class=line><span class=cl>            <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;PGP公钥信息：\r\n&#34;</span> <span class=o>+</span> <span class=n>publicKey</span><span class=o>.</span><span class=na>getValidSeconds</span><span class=o>());</span>
</span></span><span class=line><span class=cl>            <span class=n>pubOs</span><span class=o>.</span><span class=na>write</span><span class=o>(</span><span class=n>publicKeyBase64Str</span><span class=o>.</span><span class=na>getBytes</span><span class=o>());</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>Exception</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>log</span><span class=o>.</span><span class=na>error</span><span class=o>(</span><span class=s>&#34;生成密钥失败&#34;</span><span class=o>,</span> <span class=n>e</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span> <span class=k>finally</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>IOUtils</span><span class=o>.</span><span class=na>closeQuietly</span><span class=o>(</span><span class=n>priOs</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=n>IOUtils</span><span class=o>.</span><span class=na>closeQuietly</span><span class=o>(</span><span class=n>pubOs</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>createDirectory</span><span class=o>(</span><span class=n>String</span> <span class=n>path</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>File</span> <span class=n>file</span> <span class=o>=</span> <span class=k>new</span> <span class=n>File</span><span class=o>(</span><span class=n>path</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(!</span><span class=n>file</span><span class=o>.</span><span class=na>exists</span><span class=o>()</span> <span class=o>&amp;&amp;</span> <span class=o>!</span><span class=n>file</span><span class=o>.</span><span class=na>isDirectory</span><span class=o>())</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>file</span><span class=o>.</span><span class=na>mkdirs</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>byte</span><span class=o>[]</span> <span class=nf>compressFile</span><span class=o>(</span><span class=n>String</span> <span class=n>fileName</span><span class=o>,</span> <span class=kt>int</span> <span class=n>algorithm</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>IOException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>ByteArrayOutputStream</span> <span class=n>bOut</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ByteArrayOutputStream</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>PGPCompressedDataGenerator</span> <span class=n>comData</span> <span class=o>=</span> <span class=k>new</span> <span class=n>PGPCompressedDataGenerator</span><span class=o>(</span><span class=n>algorithm</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>PGPUtil</span><span class=o>.</span><span class=na>writeFileToLiteralData</span><span class=o>(</span><span class=n>comData</span><span class=o>.</span><span class=na>open</span><span class=o>(</span><span class=n>bOut</span><span class=o>),</span> <span class=n>PGPLiteralData</span><span class=o>.</span><span class=na>BINARY</span><span class=o>,</span> <span class=k>new</span> <span class=n>File</span><span class=o>(</span><span class=n>fileName</span><span class=o>));</span>
</span></span><span class=line><span class=cl>        <span class=n>comData</span><span class=o>.</span><span class=na>close</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>bOut</span><span class=o>.</span><span class=na>toByteArray</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * Search a secret key ring collection for a secret key corresponding to keyID if it
</span></span></span><span class=line><span class=cl><span class=cm>     * &lt;p&gt;
</span></span></span><span class=line><span class=cl><span class=cm>     * exists.
</span></span></span><span class=line><span class=cl><span class=cm>     *
</span></span></span><span class=line><span class=cl><span class=cm>     * @param pgpSec a secret key ring collection.
</span></span></span><span class=line><span class=cl><span class=cm>     * @param keyID? keyID we want.
</span></span></span><span class=line><span class=cl><span class=cm>     * @param pass?  passphrase to decrypt secret key with.
</span></span></span><span class=line><span class=cl><span class=cm>     * @return the private key.
</span></span></span><span class=line><span class=cl><span class=cm>     * @throws PGPException
</span></span></span><span class=line><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=n>PGPPrivateKey</span> <span class=nf>findSecretKey</span><span class=o>(</span><span class=n>PGPSecretKeyRingCollection</span> <span class=n>pgpSec</span><span class=o>,</span> <span class=kt>long</span> <span class=n>keyID</span><span class=o>,</span> <span class=kt>char</span><span class=o>[]</span> <span class=n>pass</span><span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=kd>throws</span> <span class=n>PGPException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>PGPSecretKey</span> <span class=n>pgpSecKey</span> <span class=o>=</span> <span class=n>pgpSec</span><span class=o>.</span><span class=na>getSecretKey</span><span class=o>(</span><span class=n>keyID</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>pgpSecKey</span> <span class=o>==</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>null</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>pgpSecKey</span><span class=o>.</span><span class=na>extractPrivateKey</span><span class=o>(</span><span class=k>new</span> <span class=n>JcePBESecretKeyDecryptorBuilder</span><span class=o>().</span><span class=na>setProvider</span><span class=o>(</span><span class=s>&#34;BC&#34;</span><span class=o>).</span><span class=na>build</span><span class=o>(</span><span class=n>pass</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=n>PGPPublicKey</span> <span class=nf>readPublicKey</span><span class=o>(</span><span class=n>String</span> <span class=n>fileName</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>IOException</span><span class=o>,</span> <span class=n>PGPException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>InputStream</span> <span class=n>keyIn</span> <span class=o>=</span> <span class=k>new</span> <span class=n>BufferedInputStream</span><span class=o>(</span><span class=k>new</span> <span class=n>FileInputStream</span><span class=o>(</span><span class=n>fileName</span><span class=o>));</span>
</span></span><span class=line><span class=cl>        <span class=n>PGPPublicKey</span> <span class=n>pubKey</span> <span class=o>=</span> <span class=n>readPublicKey</span><span class=o>(</span><span class=n>keyIn</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>keyIn</span><span class=o>.</span><span class=na>close</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>pubKey</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * A simple routine that opens a key ring file and loads the first available key
</span></span></span><span class=line><span class=cl><span class=cm>     * &lt;p&gt;
</span></span></span><span class=line><span class=cl><span class=cm>     * suitable for encryption.
</span></span></span><span class=line><span class=cl><span class=cm>     *
</span></span></span><span class=line><span class=cl><span class=cm>     * @param input data stream containing the public key data
</span></span></span><span class=line><span class=cl><span class=cm>     * @return the first public key found.
</span></span></span><span class=line><span class=cl><span class=cm>     * @throws IOException
</span></span></span><span class=line><span class=cl><span class=cm>     * @throws PGPException
</span></span></span><span class=line><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=n>PGPPublicKey</span> <span class=nf>readPublicKey</span><span class=o>(</span><span class=n>InputStream</span> <span class=n>input</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>IOException</span><span class=o>,</span> <span class=n>PGPException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>PGPPublicKeyRingCollection</span> <span class=n>pgpPub</span> <span class=o>=</span> <span class=k>new</span> <span class=n>PGPPublicKeyRingCollection</span><span class=o>(</span>
</span></span><span class=line><span class=cl>                <span class=n>PGPUtil</span><span class=o>.</span><span class=na>getDecoderStream</span><span class=o>(</span><span class=n>input</span><span class=o>),</span> <span class=k>new</span> <span class=n>JcaKeyFingerprintCalculator</span><span class=o>());</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// we just loop through the collection till we find a key suitable for encryption, in the real
</span></span></span><span class=line><span class=cl><span class=c1>// world you would probably want to be a bit smarter about this.
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>        <span class=n>Iterator</span> <span class=n>keyRingIter</span> <span class=o>=</span> <span class=n>pgpPub</span><span class=o>.</span><span class=na>getKeyRings</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=k>while</span> <span class=o>(</span><span class=n>keyRingIter</span><span class=o>.</span><span class=na>hasNext</span><span class=o>())</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>PGPPublicKeyRing</span> <span class=n>keyRing</span> <span class=o>=</span> <span class=o>(</span><span class=n>PGPPublicKeyRing</span><span class=o>)</span> <span class=n>keyRingIter</span><span class=o>.</span><span class=na>next</span><span class=o>();</span>
</span></span><span class=line><span class=cl>            <span class=n>Iterator</span> <span class=n>keyIter</span> <span class=o>=</span> <span class=n>keyRing</span><span class=o>.</span><span class=na>getPublicKeys</span><span class=o>();</span>
</span></span><span class=line><span class=cl>            <span class=k>while</span> <span class=o>(</span><span class=n>keyIter</span><span class=o>.</span><span class=na>hasNext</span><span class=o>())</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=n>PGPPublicKey</span> <span class=n>key</span> <span class=o>=</span> <span class=o>(</span><span class=n>PGPPublicKey</span><span class=o>)</span> <span class=n>keyIter</span><span class=o>.</span><span class=na>next</span><span class=o>();</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=o>(</span><span class=n>key</span><span class=o>.</span><span class=na>isEncryptionKey</span><span class=o>())</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                    <span class=k>return</span> <span class=n>key</span><span class=o>;</span>
</span></span><span class=line><span class=cl>                <span class=o>}</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>throw</span> <span class=k>new</span> <span class=n>IllegalArgumentException</span><span class=o>(</span><span class=s>&#34;Can&#39;t find encryption key in key ring.&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=n>PGPSecretKey</span> <span class=nf>readSecretKey</span><span class=o>(</span><span class=n>String</span> <span class=n>fileName</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>IOException</span><span class=o>,</span> <span class=n>PGPException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>InputStream</span> <span class=n>keyIn</span> <span class=o>=</span> <span class=k>new</span> <span class=n>BufferedInputStream</span><span class=o>(</span><span class=k>new</span> <span class=n>FileInputStream</span><span class=o>(</span><span class=n>fileName</span><span class=o>));</span>
</span></span><span class=line><span class=cl>        <span class=n>PGPSecretKey</span> <span class=n>secKey</span> <span class=o>=</span> <span class=n>readSecretKey</span><span class=o>(</span><span class=n>keyIn</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>keyIn</span><span class=o>.</span><span class=na>close</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>secKey</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * A simple routine that opens a key ring file and loads the first available key
</span></span></span><span class=line><span class=cl><span class=cm>     * &lt;p&gt;
</span></span></span><span class=line><span class=cl><span class=cm>     * suitable for signature generation.
</span></span></span><span class=line><span class=cl><span class=cm>     *
</span></span></span><span class=line><span class=cl><span class=cm>     * @param input stream to read the secret key ring collection from.
</span></span></span><span class=line><span class=cl><span class=cm>     * @return a secret key.
</span></span></span><span class=line><span class=cl><span class=cm>     * @throws IOException? on a problem with using the input stream.
</span></span></span><span class=line><span class=cl><span class=cm>     * @throws PGPException if there is an issue parsing the input stream.
</span></span></span><span class=line><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=n>PGPSecretKey</span> <span class=nf>readSecretKey</span><span class=o>(</span><span class=n>InputStream</span> <span class=n>input</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>IOException</span><span class=o>,</span> <span class=n>PGPException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>PGPSecretKeyRingCollection</span> <span class=n>pgpSec</span> <span class=o>=</span> <span class=k>new</span> <span class=n>PGPSecretKeyRingCollection</span><span class=o>(</span>
</span></span><span class=line><span class=cl>                <span class=n>PGPUtil</span><span class=o>.</span><span class=na>getDecoderStream</span><span class=o>(</span><span class=n>input</span><span class=o>),</span> <span class=k>new</span> <span class=n>JcaKeyFingerprintCalculator</span><span class=o>());</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// we just loop through the collection till we find a key suitable for encryption, in the real
</span></span></span><span class=line><span class=cl><span class=c1>// world you would probably want to be a bit smarter about this.
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>        <span class=n>Iterator</span> <span class=n>keyRingIter</span> <span class=o>=</span> <span class=n>pgpSec</span><span class=o>.</span><span class=na>getKeyRings</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=k>while</span> <span class=o>(</span><span class=n>keyRingIter</span><span class=o>.</span><span class=na>hasNext</span><span class=o>())</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>PGPSecretKeyRing</span> <span class=n>keyRing</span> <span class=o>=</span> <span class=o>(</span><span class=n>PGPSecretKeyRing</span><span class=o>)</span> <span class=n>keyRingIter</span><span class=o>.</span><span class=na>next</span><span class=o>();</span>
</span></span><span class=line><span class=cl>            <span class=n>Iterator</span> <span class=n>keyIter</span> <span class=o>=</span> <span class=n>keyRing</span><span class=o>.</span><span class=na>getSecretKeys</span><span class=o>();</span>
</span></span><span class=line><span class=cl>            <span class=k>while</span> <span class=o>(</span><span class=n>keyIter</span><span class=o>.</span><span class=na>hasNext</span><span class=o>())</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=n>PGPSecretKey</span> <span class=n>key</span> <span class=o>=</span> <span class=o>(</span><span class=n>PGPSecretKey</span><span class=o>)</span> <span class=n>keyIter</span><span class=o>.</span><span class=na>next</span><span class=o>();</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=o>(</span><span class=n>key</span><span class=o>.</span><span class=na>isSigningKey</span><span class=o>())</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                    <span class=k>return</span> <span class=n>key</span><span class=o>;</span>
</span></span><span class=line><span class=cl>                <span class=o>}</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>throw</span> <span class=k>new</span> <span class=n>IllegalArgumentException</span><span class=o>(</span><span class=s>&#34;Can&#39;t find signing key in key ring.&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 解密文件并跳过核签
</span></span></span><span class=line><span class=cl><span class=cm>     * @param inputFileName 加密的文件
</span></span></span><span class=line><span class=cl><span class=cm>     * @param priKeyFile 私钥文件，即base64串
</span></span></span><span class=line><span class=cl><span class=cm>     * @param passwd 私钥密码
</span></span></span><span class=line><span class=cl><span class=cm>     * @param outputFileName 输出文件名
</span></span></span><span class=line><span class=cl><span class=cm>     * @throws Exception
</span></span></span><span class=line><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>decryptFileSkipSign</span><span class=o>(</span><span class=n>String</span> <span class=n>inputFileName</span><span class=o>,</span> <span class=n>String</span> <span class=n>priKeyFile</span><span class=o>,</span> <span class=kt>char</span><span class=o>[]</span> <span class=n>passwd</span><span class=o>,</span> <span class=n>String</span> <span class=n>outputFileName</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>InputStream</span> <span class=n>in</span> <span class=o>=</span> <span class=kc>null</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=n>InputStream</span> <span class=n>keyIn</span> <span class=o>=</span> <span class=kc>null</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>in</span> <span class=o>=</span> <span class=k>new</span> <span class=n>BufferedInputStream</span><span class=o>(</span><span class=k>new</span> <span class=n>FileInputStream</span><span class=o>(</span><span class=n>inputFileName</span><span class=o>));</span>
</span></span><span class=line><span class=cl>            <span class=n>keyIn</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ByteArrayInputStream</span><span class=o>(</span><span class=n>Base64</span><span class=o>.</span><span class=na>decode</span><span class=o>(</span><span class=n>priKeyFile</span><span class=o>));</span>  <span class=c1>// 自身私钥，用于解密
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=n>decryptFile</span><span class=o>(</span><span class=n>in</span><span class=o>,</span> <span class=n>keyIn</span><span class=o>,</span> <span class=n>passwd</span><span class=o>,</span> <span class=n>outputFileName</span><span class=o>,</span> <span class=kc>null</span><span class=o>,</span> <span class=kc>true</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>Exception</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>throw</span> <span class=k>new</span> <span class=n>Exception</span><span class=o>(</span><span class=n>e</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span> <span class=k>finally</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>IOUtils</span><span class=o>.</span><span class=na>closeQuietly</span><span class=o>(</span><span class=n>keyIn</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=n>IOUtils</span><span class=o>.</span><span class=na>closeQuietly</span><span class=o>(</span><span class=n>in</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 解密文件
</span></span></span><span class=line><span class=cl><span class=cm>     * @param inputFileName 加密的文件
</span></span></span><span class=line><span class=cl><span class=cm>     * @param priKeyPath 私钥路径
</span></span></span><span class=line><span class=cl><span class=cm>     * @param passwd 私钥密码
</span></span></span><span class=line><span class=cl><span class=cm>     * @param outputFileName 输出文件名
</span></span></span><span class=line><span class=cl><span class=cm>     * @param pubKeyPath 公钥路径
</span></span></span><span class=line><span class=cl><span class=cm>     * @param skipCheckSign 跳过核签
</span></span></span><span class=line><span class=cl><span class=cm>     * @throws Exception
</span></span></span><span class=line><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>decryptFile</span><span class=o>(</span><span class=n>String</span> <span class=n>inputFileName</span><span class=o>,</span> <span class=n>String</span> <span class=n>priKeyPath</span><span class=o>,</span> <span class=kt>char</span><span class=o>[]</span> <span class=n>passwd</span><span class=o>,</span> <span class=n>String</span> <span class=n>outputFileName</span><span class=o>,</span> <span class=n>String</span> <span class=n>pubKeyPath</span><span class=o>,</span> <span class=kt>boolean</span> <span class=n>skipCheckSign</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>InputStream</span> <span class=n>in</span> <span class=o>=</span> <span class=kc>null</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=n>InputStream</span> <span class=n>keyIn</span> <span class=o>=</span> <span class=kc>null</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=n>InputStream</span> <span class=n>signIn</span> <span class=o>=</span> <span class=kc>null</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>in</span> <span class=o>=</span> <span class=k>new</span> <span class=n>BufferedInputStream</span><span class=o>(</span><span class=k>new</span> <span class=n>FileInputStream</span><span class=o>(</span><span class=n>inputFileName</span><span class=o>));</span>
</span></span><span class=line><span class=cl>            <span class=n>keyIn</span> <span class=o>=</span> <span class=k>new</span> <span class=n>BufferedInputStream</span><span class=o>(</span><span class=k>new</span> <span class=n>FileInputStream</span><span class=o>(</span><span class=n>priKeyPath</span><span class=o>));</span>  <span class=c1>// 自身私钥，用于解密
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=n>signIn</span> <span class=o>=</span> <span class=k>new</span> <span class=n>BufferedInputStream</span><span class=o>(</span><span class=k>new</span> <span class=n>FileInputStream</span><span class=o>(</span><span class=n>pubKeyPath</span><span class=o>));</span> <span class=c1>// 对方公钥，用于验签
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=n>decryptFile</span><span class=o>(</span><span class=n>in</span><span class=o>,</span> <span class=n>keyIn</span><span class=o>,</span> <span class=n>passwd</span><span class=o>,</span> <span class=n>outputFileName</span><span class=o>,</span> <span class=n>signIn</span><span class=o>,</span> <span class=n>skipCheckSign</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>Exception</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>throw</span> <span class=k>new</span> <span class=n>Exception</span><span class=o>(</span><span class=n>e</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span> <span class=k>finally</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>IOUtils</span><span class=o>.</span><span class=na>closeQuietly</span><span class=o>(</span><span class=n>keyIn</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=n>IOUtils</span><span class=o>.</span><span class=na>closeQuietly</span><span class=o>(</span><span class=n>in</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=n>IOUtils</span><span class=o>.</span><span class=na>closeQuietly</span><span class=o>(</span><span class=n>signIn</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * decrypt the passed in message stream
</span></span></span><span class=line><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>decryptFile</span><span class=o>(</span><span class=n>InputStream</span> <span class=n>in</span><span class=o>,</span> <span class=n>InputStream</span> <span class=n>keyIn</span><span class=o>,</span> <span class=kt>char</span><span class=o>[]</span> <span class=n>passwd</span><span class=o>,</span> <span class=n>String</span> <span class=n>defaultFileName</span><span class=o>,</span> <span class=n>InputStream</span> <span class=n>signIn</span><span class=o>,</span> <span class=kt>boolean</span> <span class=n>skipCheckSign</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>ByteArrayOutputStream</span> <span class=n>actualOutput</span> <span class=o>=</span> <span class=kc>null</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=n>OutputStream</span> <span class=n>fOut</span> <span class=o>=</span> <span class=kc>null</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=n>BufferedInputStream</span> <span class=n>bis</span> <span class=o>=</span> <span class=kc>null</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>in</span> <span class=o>=</span> <span class=n>PGPUtil</span><span class=o>.</span><span class=na>getDecoderStream</span><span class=o>(</span><span class=n>in</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=n>JcaPGPObjectFactory</span> <span class=n>pgpF</span> <span class=o>=</span> <span class=k>new</span> <span class=n>JcaPGPObjectFactory</span><span class=o>(</span><span class=n>in</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=n>PGPEncryptedDataList</span> <span class=n>enc</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=n>Object</span> <span class=n>o</span> <span class=o>=</span> <span class=n>pgpF</span><span class=o>.</span><span class=na>nextObject</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=c1>// the first object might be a PGP marker packet.
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=k>if</span> <span class=o>(</span><span class=n>o</span> <span class=k>instanceof</span> <span class=n>PGPEncryptedDataList</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=n>enc</span> <span class=o>=</span> <span class=o>(</span><span class=n>PGPEncryptedDataList</span><span class=o>)</span> <span class=n>o</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span> <span class=k>else</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=n>enc</span> <span class=o>=</span> <span class=o>(</span><span class=n>PGPEncryptedDataList</span><span class=o>)</span> <span class=n>pgpF</span><span class=o>.</span><span class=na>nextObject</span><span class=o>();</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=c1>// find the secret key
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=n>Iterator</span> <span class=n>it</span> <span class=o>=</span> <span class=n>enc</span><span class=o>.</span><span class=na>getEncryptedDataObjects</span><span class=o>();</span>
</span></span><span class=line><span class=cl>            <span class=n>PGPPrivateKey</span> <span class=n>sKey</span> <span class=o>=</span> <span class=kc>null</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=n>PGPPublicKeyEncryptedData</span> <span class=n>pbe</span> <span class=o>=</span> <span class=kc>null</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=n>PGPSecretKeyRingCollection</span> <span class=n>pgpSec</span> <span class=o>=</span> <span class=k>new</span> <span class=n>PGPSecretKeyRingCollection</span><span class=o>(</span>
</span></span><span class=line><span class=cl>                    <span class=n>PGPUtil</span><span class=o>.</span><span class=na>getDecoderStream</span><span class=o>(</span><span class=n>keyIn</span><span class=o>),</span> <span class=k>new</span> <span class=n>JcaKeyFingerprintCalculator</span><span class=o>());</span>
</span></span><span class=line><span class=cl>            <span class=k>while</span> <span class=o>(</span><span class=n>sKey</span> <span class=o>==</span> <span class=kc>null</span> <span class=o>&amp;&amp;</span> <span class=n>it</span><span class=o>.</span><span class=na>hasNext</span><span class=o>())</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=n>pbe</span> <span class=o>=</span> <span class=o>(</span><span class=n>PGPPublicKeyEncryptedData</span><span class=o>)</span> <span class=n>it</span><span class=o>.</span><span class=na>next</span><span class=o>();</span>
</span></span><span class=line><span class=cl>                <span class=n>sKey</span> <span class=o>=</span> <span class=n>findSecretKey</span><span class=o>(</span><span class=n>pgpSec</span><span class=o>,</span> <span class=n>pbe</span><span class=o>.</span><span class=na>getKeyID</span><span class=o>(),</span> <span class=n>passwd</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=o>(</span><span class=n>sKey</span> <span class=o>==</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=k>throw</span> <span class=k>new</span> <span class=n>IllegalArgumentException</span><span class=o>(</span><span class=s>&#34;secret key for message not found.&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>InputStream</span> <span class=n>clear</span> <span class=o>=</span> <span class=n>pbe</span><span class=o>.</span><span class=na>getDataStream</span><span class=o>(</span><span class=k>new</span> <span class=n>BcPublicKeyDataDecryptorFactory</span><span class=o>(</span><span class=n>sKey</span><span class=o>));</span>
</span></span><span class=line><span class=cl>            <span class=n>PGPObjectFactory</span> <span class=n>plainFact</span> <span class=o>=</span> <span class=k>new</span> <span class=n>PGPObjectFactory</span><span class=o>(</span><span class=n>clear</span><span class=o>,</span> <span class=k>new</span> <span class=n>BcKeyFingerprintCalculator</span><span class=o>());</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>PGPOnePassSignatureList</span> <span class=n>onePassSignatureList</span> <span class=o>=</span> <span class=kc>null</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=n>PGPSignatureList</span> <span class=n>signatureList</span> <span class=o>=</span> <span class=kc>null</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=n>PGPCompressedData</span> <span class=n>compressedData</span> <span class=o>=</span> <span class=kc>null</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=n>String</span> <span class=n>outFileName</span> <span class=o>=</span> <span class=kc>null</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=n>Object</span> <span class=n>message</span> <span class=o>=</span> <span class=n>plainFact</span><span class=o>.</span><span class=na>nextObject</span><span class=o>();</span>
</span></span><span class=line><span class=cl>            <span class=n>actualOutput</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ByteArrayOutputStream</span><span class=o>();</span>
</span></span><span class=line><span class=cl>            <span class=k>while</span> <span class=o>(</span><span class=n>message</span> <span class=o>!=</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=o>(</span><span class=n>message</span> <span class=k>instanceof</span> <span class=n>PGPCompressedData</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                    <span class=n>compressedData</span> <span class=o>=</span> <span class=o>(</span><span class=n>PGPCompressedData</span><span class=o>)</span> <span class=n>message</span><span class=o>;</span>
</span></span><span class=line><span class=cl>                    <span class=n>plainFact</span> <span class=o>=</span> <span class=k>new</span> <span class=n>PGPObjectFactory</span><span class=o>(</span><span class=n>compressedData</span><span class=o>.</span><span class=na>getDataStream</span><span class=o>(),</span> <span class=k>new</span> <span class=n>BcKeyFingerprintCalculator</span><span class=o>());</span>
</span></span><span class=line><span class=cl>                    <span class=n>message</span> <span class=o>=</span> <span class=n>plainFact</span><span class=o>.</span><span class=na>nextObject</span><span class=o>();</span>
</span></span><span class=line><span class=cl>                <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=o>(</span><span class=n>message</span> <span class=k>instanceof</span> <span class=n>PGPLiteralData</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                    <span class=n>PGPLiteralData</span> <span class=n>ld</span> <span class=o>=</span> <span class=o>(</span><span class=n>PGPLiteralData</span><span class=o>)</span> <span class=n>message</span><span class=o>;</span>
</span></span><span class=line><span class=cl>                    <span class=n>outFileName</span> <span class=o>=</span> <span class=n>ld</span><span class=o>.</span><span class=na>getFileName</span><span class=o>();</span>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=o>(</span><span class=n>outFileName</span><span class=o>.</span><span class=na>length</span><span class=o>()</span> <span class=o>==</span> <span class=mi>0</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                        <span class=n>outFileName</span> <span class=o>=</span> <span class=n>defaultFileName</span><span class=o>;</span>
</span></span><span class=line><span class=cl>                    <span class=o>}</span> <span class=k>else</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                        <span class=n>outFileName</span> <span class=o>=</span> <span class=n>defaultFileName</span><span class=o>;</span>
</span></span><span class=line><span class=cl>                    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                    <span class=n>InputStream</span> <span class=n>unc</span> <span class=o>=</span> <span class=n>ld</span><span class=o>.</span><span class=na>getInputStream</span><span class=o>();</span>
</span></span><span class=line><span class=cl>                    <span class=n>Streams</span><span class=o>.</span><span class=na>pipeAll</span><span class=o>(</span><span class=n>unc</span><span class=o>,</span> <span class=n>actualOutput</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                <span class=o>}</span> <span class=k>else</span> <span class=k>if</span> <span class=o>(</span><span class=n>message</span> <span class=k>instanceof</span> <span class=n>PGPOnePassSignatureList</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                    <span class=n>onePassSignatureList</span> <span class=o>=</span> <span class=o>(</span><span class=n>PGPOnePassSignatureList</span><span class=o>)</span> <span class=n>message</span><span class=o>;</span>
</span></span><span class=line><span class=cl>                <span class=o>}</span> <span class=k>else</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                    <span class=n>signatureList</span> <span class=o>=</span> <span class=o>(</span><span class=n>PGPSignatureList</span><span class=o>)</span> <span class=n>message</span><span class=o>;</span>
</span></span><span class=line><span class=cl>                <span class=o>}</span>
</span></span><span class=line><span class=cl>                <span class=n>message</span> <span class=o>=</span> <span class=n>plainFact</span><span class=o>.</span><span class=na>nextObject</span><span class=o>();</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=kt>byte</span><span class=o>[]</span> <span class=n>outputBytes</span> <span class=o>=</span> <span class=n>actualOutput</span><span class=o>.</span><span class=na>toByteArray</span><span class=o>();</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=o>(</span><span class=n>onePassSignatureList</span> <span class=o>==</span> <span class=kc>null</span> <span class=o>||</span> <span class=n>signatureList</span> <span class=o>==</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=n>log</span><span class=o>.</span><span class=na>info</span><span class=o>(</span><span class=s>&#34;Poor PGP. Signatures not found.&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span> <span class=k>else</span> <span class=k>if</span> <span class=o>(</span><span class=n>onePassSignatureList</span> <span class=o>!=</span> <span class=kc>null</span> <span class=o>&amp;&amp;</span> <span class=o>!</span><span class=n>skipCheckSign</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=c1>// 实际上不验签、验签失败也不会影响文件解密
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=k>for</span> <span class=o>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=o>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>onePassSignatureList</span><span class=o>.</span><span class=na>size</span><span class=o>();</span> <span class=n>i</span><span class=o>++)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                    <span class=n>PGPOnePassSignature</span> <span class=n>ops</span> <span class=o>=</span> <span class=n>onePassSignatureList</span><span class=o>.</span><span class=na>get</span><span class=o>(</span><span class=n>i</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                    <span class=n>PGPPublicKeyRingCollection</span> <span class=n>pgpRing</span> <span class=o>=</span> <span class=k>new</span> <span class=n>PGPPublicKeyRingCollection</span><span class=o>(</span><span class=n>PGPUtil</span><span class=o>.</span><span class=na>getDecoderStream</span><span class=o>(</span><span class=n>signIn</span><span class=o>),</span> <span class=k>new</span> <span class=n>BcKeyFingerprintCalculator</span><span class=o>());</span>
</span></span><span class=line><span class=cl>                    <span class=n>PGPPublicKey</span> <span class=n>publicKey</span> <span class=o>=</span> <span class=n>pgpRing</span><span class=o>.</span><span class=na>getPublicKey</span><span class=o>(</span><span class=n>ops</span><span class=o>.</span><span class=na>getKeyID</span><span class=o>());</span>
</span></span><span class=line><span class=cl>                    <span class=c1>// PGPPublicKey publicKey = readPublicKey(signIn);
</span></span></span><span class=line><span class=cl><span class=c1></span>                    <span class=k>if</span> <span class=o>(</span><span class=n>publicKey</span> <span class=o>!=</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                        <span class=n>ops</span><span class=o>.</span><span class=na>init</span><span class=o>(</span><span class=k>new</span> <span class=n>BcPGPContentVerifierBuilderProvider</span><span class=o>(),</span> <span class=n>publicKey</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                        <span class=n>ops</span><span class=o>.</span><span class=na>update</span><span class=o>(</span><span class=n>outputBytes</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                        <span class=n>PGPSignature</span> <span class=n>signature</span> <span class=o>=</span> <span class=n>signatureList</span><span class=o>.</span><span class=na>get</span><span class=o>(</span><span class=n>i</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                        <span class=k>if</span> <span class=o>(</span><span class=n>ops</span><span class=o>.</span><span class=na>verify</span><span class=o>(</span><span class=n>signature</span><span class=o>))</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                            <span class=n>log</span><span class=o>.</span><span class=na>info</span><span class=o>(</span><span class=s>&#34;验证签名成功&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                        <span class=o>}</span> <span class=k>else</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                            <span class=n>log</span><span class=o>.</span><span class=na>info</span><span class=o>(</span><span class=s>&#34;验证签名失败&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                        <span class=o>}</span>
</span></span><span class=line><span class=cl>                    <span class=o>}</span>
</span></span><span class=line><span class=cl>                <span class=o>}</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>
</span></span><span class=line><span class=cl>            <span class=n>fOut</span> <span class=o>=</span> <span class=k>new</span> <span class=n>BufferedOutputStream</span><span class=o>(</span><span class=k>new</span> <span class=n>FileOutputStream</span><span class=o>(</span><span class=n>outFileName</span><span class=o>));</span>
</span></span><span class=line><span class=cl>            <span class=n>bis</span> <span class=o>=</span> <span class=k>new</span> <span class=n>BufferedInputStream</span><span class=o>(</span><span class=k>new</span> <span class=n>ByteArrayInputStream</span><span class=o>(</span><span class=n>outputBytes</span><span class=o>));</span>
</span></span><span class=line><span class=cl>            <span class=kt>byte</span><span class=o>[]</span> <span class=n>b</span> <span class=o>=</span> <span class=k>new</span> <span class=kt>byte</span><span class=o>[</span><span class=mi>1024</span><span class=o>];</span>
</span></span><span class=line><span class=cl>            <span class=kt>int</span> <span class=n>len</span> <span class=o>=</span> <span class=o>-</span><span class=mi>1</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=k>while</span> <span class=o>((</span><span class=n>len</span> <span class=o>=</span> <span class=n>bis</span><span class=o>.</span><span class=na>read</span><span class=o>(</span><span class=n>b</span><span class=o>))</span> <span class=o>!=</span> <span class=o>-</span><span class=mi>1</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=n>fOut</span><span class=o>.</span><span class=na>write</span><span class=o>(</span><span class=n>b</span><span class=o>,</span> <span class=mi>0</span><span class=o>,</span> <span class=n>len</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>PGPException</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>log</span><span class=o>.</span><span class=na>error</span><span class=o>(</span><span class=s>&#34;PGPException.&#34;</span><span class=o>,</span> <span class=n>e</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=o>(</span><span class=n>e</span><span class=o>.</span><span class=na>getUnderlyingException</span><span class=o>()</span> <span class=o>!=</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=n>log</span><span class=o>.</span><span class=na>error</span><span class=o>(</span><span class=s>&#34;UnderlyingException.&#34;</span><span class=o>,</span> <span class=n>e</span><span class=o>.</span><span class=na>getUnderlyingException</span><span class=o>());</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>
</span></span><span class=line><span class=cl>            <span class=k>throw</span> <span class=k>new</span> <span class=n>Exception</span><span class=o>(</span><span class=n>e</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>IOException</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>log</span><span class=o>.</span><span class=na>error</span><span class=o>(</span><span class=s>&#34;IOException.&#34;</span><span class=o>,</span> <span class=n>e</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=k>throw</span> <span class=k>new</span> <span class=n>Exception</span><span class=o>(</span><span class=n>e</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span> <span class=k>finally</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>IOUtils</span><span class=o>.</span><span class=na>closeQuietly</span><span class=o>(</span><span class=n>actualOutput</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=n>IOUtils</span><span class=o>.</span><span class=na>closeQuietly</span><span class=o>(</span><span class=n>fOut</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=n>IOUtils</span><span class=o>.</span><span class=na>closeQuietly</span><span class=o>(</span><span class=n>bis</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>encryptFile</span><span class=o>(</span><span class=n>String</span> <span class=n>outputFileName</span><span class=o>,</span> <span class=n>String</span> <span class=n>inputFileName</span><span class=o>,</span> <span class=n>String</span> <span class=n>encKeyFileName</span><span class=o>,</span> <span class=kt>boolean</span> <span class=n>armor</span><span class=o>,</span> <span class=kt>boolean</span> <span class=n>withIntegrityCheck</span><span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=kd>throws</span> <span class=n>IOException</span><span class=o>,</span> <span class=n>NoSuchProviderException</span><span class=o>,</span> <span class=n>PGPException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>OutputStream</span> <span class=n>out</span> <span class=o>=</span> <span class=k>new</span> <span class=n>BufferedOutputStream</span><span class=o>(</span><span class=k>new</span> <span class=n>FileOutputStream</span><span class=o>(</span><span class=n>outputFileName</span><span class=o>));</span>
</span></span><span class=line><span class=cl>        <span class=n>PGPPublicKey</span> <span class=n>encKey</span> <span class=o>=</span> <span class=n>readPublicKey</span><span class=o>(</span><span class=n>encKeyFileName</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>encryptFile</span><span class=o>(</span><span class=n>out</span><span class=o>,</span> <span class=n>inputFileName</span><span class=o>,</span> <span class=n>encKey</span><span class=o>,</span> <span class=n>armor</span><span class=o>,</span> <span class=n>withIntegrityCheck</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>out</span><span class=o>.</span><span class=na>close</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>encryptFile</span><span class=o>(</span><span class=n>OutputStream</span> <span class=n>out</span><span class=o>,</span> <span class=n>String</span> <span class=n>fileName</span><span class=o>,</span> <span class=n>PGPPublicKey</span> <span class=n>encKey</span><span class=o>,</span> <span class=kt>boolean</span> <span class=n>armor</span><span class=o>,</span> <span class=kt>boolean</span> <span class=n>withIntegrityCheck</span><span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=kd>throws</span> <span class=n>IOException</span><span class=o>,</span> <span class=n>NoSuchProviderException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>armor</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>out</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ArmoredOutputStream</span><span class=o>(</span><span class=n>out</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=kt>byte</span><span class=o>[]</span> <span class=n>bytes</span> <span class=o>=</span> <span class=n>compressFile</span><span class=o>(</span><span class=n>fileName</span><span class=o>,</span> <span class=n>CompressionAlgorithmTags</span><span class=o>.</span><span class=na>ZIP</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=n>PGPEncryptedDataGenerator</span> <span class=n>encGen</span> <span class=o>=</span> <span class=k>new</span> <span class=n>PGPEncryptedDataGenerator</span><span class=o>(</span>
</span></span><span class=line><span class=cl>                    <span class=k>new</span> <span class=n>JcePGPDataEncryptorBuilder</span><span class=o>(</span><span class=n>PGPEncryptedData</span><span class=o>.</span><span class=na>CAST5</span><span class=o>).</span><span class=na>setWithIntegrityPacket</span><span class=o>(</span><span class=n>withIntegrityCheck</span><span class=o>).</span><span class=na>setSecureRandom</span><span class=o>(</span><span class=k>new</span> <span class=n>SecureRandom</span><span class=o>()).</span><span class=na>setProvider</span><span class=o>(</span><span class=s>&#34;BC&#34;</span><span class=o>));</span>
</span></span><span class=line><span class=cl>            <span class=n>encGen</span><span class=o>.</span><span class=na>addMethod</span><span class=o>(</span><span class=k>new</span> <span class=n>JcePublicKeyKeyEncryptionMethodGenerator</span><span class=o>(</span><span class=n>encKey</span><span class=o>).</span><span class=na>setProvider</span><span class=o>(</span><span class=s>&#34;BC&#34;</span><span class=o>));</span>
</span></span><span class=line><span class=cl>            <span class=n>OutputStream</span> <span class=n>cOut</span> <span class=o>=</span> <span class=n>encGen</span><span class=o>.</span><span class=na>open</span><span class=o>(</span><span class=n>out</span><span class=o>,</span> <span class=n>bytes</span><span class=o>.</span><span class=na>length</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=n>cOut</span><span class=o>.</span><span class=na>write</span><span class=o>(</span><span class=n>bytes</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=n>cOut</span><span class=o>.</span><span class=na>close</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=o>(</span><span class=n>armor</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=n>out</span><span class=o>.</span><span class=na>close</span><span class=o>();</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>PGPException</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>log</span><span class=o>.</span><span class=na>error</span><span class=o>(</span><span class=s>&#34;PGPException.&#34;</span><span class=o>,</span> <span class=n>e</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=o>(</span><span class=n>e</span><span class=o>.</span><span class=na>getUnderlyingException</span><span class=o>()</span> <span class=o>!=</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=n>log</span><span class=o>.</span><span class=na>error</span><span class=o>(</span><span class=s>&#34;UnderlyingException.&#34;</span><span class=o>,</span> <span class=n>e</span><span class=o>.</span><span class=na>getUnderlyingException</span><span class=o>());</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>String</span> <span class=n>path</span> <span class=o>=</span> <span class=s>&#34;D:\\pgp\\&#34;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=n>String</span> <span class=n>pubKeyFile</span> <span class=o>=</span> <span class=n>path</span> <span class=o>+</span> <span class=s>&#34;public-file.key&#34;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=n>String</span> <span class=n>priKeyFile</span> <span class=o>=</span> <span class=n>path</span> <span class=o>+</span> <span class=s>&#34;private-file.key&#34;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 生成PGP密钥对
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=c1>//try {
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=c1>//    generatePGPKeyPair(2048, &#34;&#34;, &#34;sdebank&#34;, pubKeyFile, priKeyFile, path);
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=c1>//} catch (Exception e) {
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=c1>//    System.out.println(&#34;生成PGP密钥对失败&#34;);
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=c1>//    e.printStackTrace();
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=c1>//}
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>        <span class=kt>boolean</span> <span class=n>encryp</span> <span class=o>=</span> <span class=kc>false</span><span class=o>;</span> <span class=c1>//加密：true? 解密：false
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=c1>// 加密
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>String</span> <span class=n>fileName</span> <span class=o>=</span> <span class=s>&#34;test.xml&#34;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>encryp</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>String</span> <span class=n>outPath</span> <span class=o>=</span> <span class=n>path</span> <span class=o>+</span> <span class=n>fileName</span> <span class=o>+</span> <span class=s>&#34;.pgp&#34;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=n>String</span> <span class=n>inputPath</span> <span class=o>=</span> <span class=n>path</span> <span class=o>+</span> <span class=n>fileName</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=n>String</span> <span class=n>publicKeys</span> <span class=o>=</span> <span class=n>pubKeyFile</span><span class=o>;</span> <span class=c1>//公钥地址
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=n>encryptFile</span><span class=o>(</span><span class=n>outPath</span><span class=o>,</span> <span class=n>inputPath</span><span class=o>,</span> <span class=n>publicKeys</span><span class=o>,</span> <span class=kc>true</span><span class=o>,</span> <span class=kc>true</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span> <span class=k>else</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 解密
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=n>String</span> <span class=n>password</span> <span class=o>=</span> <span class=s>&#34;123&#34;</span><span class=o>;</span> <span class=c1>//私钥的密码
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=n>String</span> <span class=n>privateKeys</span> <span class=o>=</span> <span class=n>priKeyFile</span><span class=o>;</span> <span class=c1>//私钥地址
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>            <span class=n>String</span> <span class=n>inputPath</span> <span class=o>=</span> <span class=n>path</span> <span class=o>+</span> <span class=n>fileName</span> <span class=o>+</span> <span class=s>&#34;.pgp&#34;</span><span class=o>;</span> <span class=c1>//被加密的文件
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=n>String</span> <span class=n>outPath</span> <span class=o>=</span> <span class=n>path</span> <span class=o>+</span> <span class=s>&#34;decrypt_&#34;</span> <span class=o>+</span> <span class=n>fileName</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;要解密的文件：&#34;</span> <span class=o>+</span> <span class=n>inputPath</span> <span class=o>+</span> <span class=s>&#34;，解密出来的文件&#34;</span> <span class=o>+</span> <span class=n>outPath</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=n>decryptFileSkipSign</span><span class=o>(</span><span class=n>inputPath</span><span class=o>,</span> <span class=n>privateKeys</span><span class=o>,</span> <span class=n>password</span><span class=o>.</span><span class=na>toCharArray</span><span class=o>(),</span> <span class=n>outPath</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p>虽然Java代码能成功生成PGP密钥对，但是在跟客户交互PGP公钥时发现公钥文件格式不对，最终还是改在Linux上用GPG命令来生成密钥对。除此之外，Java的PGP加解密功能则是没有问题，可以正常对接客户的需求。</p><h2 id=参考链接>参考链接</h2><ul><li><a href=https://blog.csdn.net/nyist_zxp/article/details/107597626 target=_blank rel="noopener noreffer">gpg 密钥生成、导入、导出、自动输入密码</a></li><li><a href=https://blog.csdn.net/nathan_csdn/article/details/116205267 target=_blank rel="noopener noreffer">关于PGP & GPG文件加密有这篇就够了</a></li><li><a href=https://blog.csdn.net/hknaruto/article/details/117958306 target=_blank rel="noopener noreffer">运行gpg &ndash;gen-key生成密钥时卡住在We need to generate a lot of random bytes</a></li><li><a href=https://zhuanlan.zhihu.com/p/344198727 target=_blank rel="noopener noreffer">2021年，用更现代的方法使用PGP（上）</a></li><li><a href=https://blog.csdn.net/nealdor/article/details/121518844 target=_blank rel="noopener noreffer">PGP 对于JSON的加解密</a></li></ul><div class="details admonition warning open"><div class="details-summary admonition-title"><i class="icon fas fa-exclamation-triangle fa-fwwarning"></i>警告<i class="details-icon fas fa-angle-right fa-fw"></i></div><div class=details-content><div class=admonition-content>本文最后更新于 <span class=timeago datetime=2023-06-16T00:19:39 title="June 16, 2023">June 16, 2023</span>，文中内容可能已过时，请谨慎使用。</div></div></div><div class=post-reward><input type=checkbox name=reward id=reward hidden>
<label class=reward-button for=reward>赞赏支持</label><div class=qr-code><label class=qr-code-image for=reward><img class=image src=https://lewky233.top/images/reward/wechat.png>
<span>微信打赏</span></label>
<label class=qr-code-image for=reward><img class=image src=https://lewky233.top/images/reward/alipay.png>
<span>支付宝打赏</span></label></div></div></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>更新于 2023-06-16</span></div><div class=post-info-license><span><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-markdown href=/posts/pgp/index.md target=_blank>阅读原始文档</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 Twitter" data-sharer=twitter data-url=https://lewky233.top/posts/pgp/ data-title=PGP加解密 data-hashtags=PGP,GPG,加解密><i class="fab fa-twitter fa-fw"></i></a><a href=javascript:void(0); title="分享到 Facebook" data-sharer=facebook data-url=https://lewky233.top/posts/pgp/ data-hashtag=PGP><i class="fab fa-facebook-square fa-fw"></i></a><a href=javascript:void(0); title="分享到 Hacker News" data-sharer=hackernews data-url=https://lewky233.top/posts/pgp/ data-title=PGP加解密><i class="fab fa-hacker-news fa-fw"></i></a><a href=javascript:void(0); title="分享到 Line" data-sharer=line data-url=https://lewky233.top/posts/pgp/ data-title=PGP加解密><i data-svg-src=https://unpkg.com/simple-icons@2.14.0/icons/line.svg></i></a><a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://lewky233.top/posts/pgp/ data-title=PGP加解密><i class="fab fa-weibo fa-fw"></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/tags/pgp/>PGP</a>,&nbsp;<a href=/tags/gpg/>GPG</a>,&nbsp;<a href=/tags/%E5%8A%A0%E8%A7%A3%E5%AF%86/>加解密</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/posts/apollo-issues/ class=prev rel=prev title=Apollo问题汇总><i class="fas fa-angle-left fa-fw"></i>Apollo问题汇总</a>
<a href=/posts/ssh-issues/ class=next rel=next title=SSH命令问题汇总>SSH命令问题汇总<i class="fas fa-angle-right fa-fw"></i></a></div></div><div id=comments><div id=waline></div><script src=/js/Waline.min.js></script>
<script>new Waline({el:"#waline",meta:["nick","mail","link"],requiredMeta:["nick","mail"],login:"force",placeholder:"为防恶意灌水攻击，评论前需注册并登录，望见谅~",serverURL:"https://comment.lewky233.top/",avatarCDN:"https://cravatar.cn/avatar/",pageSize:20,avatar:"retro",lang:"zh-CN",visitor:!0,highlight:!0,uploadImage:!1,emoji:["https://lewky233.top/images/emoji/嘉然今天吃什么","https://lewky233.top/images/emoji/大航海嘉然","https://lewky233.top/images/emoji/向晚大魔王","https://lewky233.top/images/emoji/贝拉kira","https://lewky233.top/images/emoji/珈乐Carol","https://lewky233.top/images/emoji/乃琳Queen","https://lewky233.top/images/emoji/EveOneCat","https://lewky233.top/images/emoji/weibo","https://lewky233.top/images/emoji/滑稽","https://lewky233.top/images/emoji/default"]})</script></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line><span id=run-time></span>|
<a href=http://rssblog.vercel.app/ target=_blank rel=noopener title=RSSBlog><i class='fas fa-fw fa-inbox'></i>&nbsp;RSSBlog</a></div><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2018 - 2024</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank>雨临Lewis</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span><span class=icp-splitter>&nbsp;|&nbsp;</span><br class=icp-br><span class=icp><a target=_blank href=http://www.beian.miit.gov.cn/ style=font-weight:700>粤ICP备19103822</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到顶部><i class="fas fa-arrow-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fas fa-comment fa-fw"></i></a></div><div class=sidebar_wo><div id=leimu><img src=https://lewky233.top/images/b2t/leimuA.png alt=雷姆 onmouseover='this.src="https://lewky233.top/images/b2t/leimuB.png"' onmouseout='this.src="https://lewky233.top/images/b2t/leimuA.png"' title=回到顶部></div><div class=sidebar_wo id=lamu><img src=https://lewky233.top/images/b2t/lamuA.png alt=雷姆 onmouseover='this.src="https://lewky233.top/images/b2t/lamuB.png"' onmouseout='this.src="https://lewky233.top/images/b2t/lamuA.png"' title=回到底部></div></div><link rel=stylesheet href=https://unpkg.com/lightgallery.js@1.2.0/dist/css/lightgallery.min.css><script type=text/javascript src=https://unpkg.com/smooth-scroll@16.1.3/dist/smooth-scroll.min.js></script><script type=text/javascript src=https://unpkg.com/lazysizes@5.2.2/lazysizes.min.js></script><script type=text/javascript src=https://unpkg.com/lightgallery.js@1.2.0/dist/js/lightgallery.min.js></script><script type=text/javascript src=https://unpkg.com/lg-thumbnail.js@1.2.0/dist/lg-thumbnail.min.js></script><script type=text/javascript src=https://unpkg.com/lg-zoom.js@1.2.0/dist/lg-zoom.min.js></script><script type=text/javascript src=https://unpkg.com/clipboard@2.0.6/dist/clipboard.min.js></script><script type=text/javascript src=https://unpkg.com/sharer.js@0.4.0/sharer.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"复制到剪贴板",maxShownLines:30},comment:{},lightGallery:{actualSize:!1,exThumbImage:"data-thumbnail",hideBarsDelay:2e3,selector:".lightgallery",speed:400,thumbContHeight:80,thumbWidth:80,thumbnail:!0}}</script><script type=text/javascript src=/js/theme.min.js></script><script type=text/javascript src=https://unpkg.com/jquery@2.1.3/dist/jquery.min.js></script><script type=text/javascript src=https://unpkg.com/jquery-backstretch@2.1.18/jquery.backstretch.min.js></script><script>var $cdnPrefix="https://lewky233.top"</script>
<script type=text/javascript src=/js/custom.js></script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?6f278ed0fdb01edb3b1e7398379e5432",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script></body></html>