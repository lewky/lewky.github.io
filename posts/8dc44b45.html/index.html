<!doctype html><html lang><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta http-equiv=x-ua-compatible content="IE=edge, chrome=1"><title>Log4j2 - 动态生成Appender - Yulin Lewis' Blog</title><meta name=keywords content="雨临Lewis,Java,hugo,hexo,博客"><meta name=Description content="不想当写手的码农不是好咸鱼_(xз」∠)_"><meta property="og:title" content="Log4j2 - 动态生成Appender"><meta property="og:description" content="功能需求
项目里将User分成了各个区域(domain)，这些domain有个标志domainId，现在要求在打印日志的时候，不仅将所有User的日志都打印到日志文件logs/CNTCore.log中，还需要另外再打印到对应domain的日志文件logs/{domainId}/CNTCore.log。
比如User A的domainId是RD2，那么除了logs/CNTCore.log外，还需要将该User A的日志额外打印到logs/RD2/CNTCore.log中。
实现思路
将所有User的日志都打印到日志文件logs/CNTCore.log中，这个可以直接使用配置文件log4j2.xml来解决，一个简单的配置如下："><meta property="og:type" content="article"><meta property="og:url" content="https://lewky.cn/posts/8dc44b45.html/"><meta property="og:image" content="https://lewky.cn/logo.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-01-03T21:39:59+08:00"><meta property="article:modified_time" content="2019-01-03T21:39:59+08:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://lewky.cn/logo.png"><meta name=twitter:title content="Log4j2 - 动态生成Appender"><meta name=twitter:description content="功能需求
项目里将User分成了各个区域(domain)，这些domain有个标志domainId，现在要求在打印日志的时候，不仅将所有User的日志都打印到日志文件logs/CNTCore.log中，还需要另外再打印到对应domain的日志文件logs/{domainId}/CNTCore.log。
比如User A的domainId是RD2，那么除了logs/CNTCore.log外，还需要将该User A的日志额外打印到logs/RD2/CNTCore.log中。
实现思路
将所有User的日志都打印到日志文件logs/CNTCore.log中，这个可以直接使用配置文件log4j2.xml来解决，一个简单的配置如下："><meta name=application-name content="雨临Lewis的博客"><meta name=apple-mobile-web-app-title content="雨临Lewis的博客"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://lewky.cn/posts/8dc44b45.html/><link rel=prev href=https://lewky.cn/posts/55fa957a.html/><link rel=next href=https://lewky.cn/posts/git-issues/><link rel=stylesheet href=https://unpkg.com/normalize.css@8.0.1/normalize.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=https://unpkg.com/@fortawesome/fontawesome-free@5.13.0/css/all.min.css><link rel=stylesheet href=https://unpkg.com/animate.css@3.7.2/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Log4j2 - 动态生成Appender","inLanguage":"","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/lewky.cn\/posts\/8dc44b45.html\/"},"genre":"posts","keywords":"Log4j, Log4j2","wordcount":2312,"url":"https:\/\/lewky.cn\/posts\/8dc44b45.html\/","datePublished":"2019-01-03T21:39:59+08:00","dateModified":"2019-01-03T21:39:59+08:00","license":"This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher":{"@type":"Organization","name":"雨临Lewis","logo":"https:\/\/lewky.cn\/images\/avatar.jpg"},"author":{"@type":"Person","name":"雨临Lewis"},"description":""}</script></head><body header-desktop=fixed header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><a href=https://github.com/lewky class=github-corner target=_blank title="Follow me on GitHub" aria-label="Follow me on GitHub"><svg width="3.5rem" height="3.5rem" viewBox="0 0 250 250" style="fill:#70b7fd;color:#fff;position:absolute;top:0;border:0;left:0;transform:scale(-1,1)" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentcolor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentcolor" class="octo-body"/></svg></a><div class=header-title><a href=/ title="Yulin Lewis' Blog"><span class=header-title-pre><i class='fas fa-fw fa-atom'></i></span>雨临Lewis</a></div><div class=menu><div class=menu-inner><div class=dropdown><a href=/posts/ class="menu-item menu-more dropbtn" title=点击查看所有文章><i class='fas fa-fw fa-archive'></i> 归档</a><div class="menu-more-content dropdown-content"><a href=/categories/ title><i class='fas fa-fw fa-th'></i> 分类 </a><a href=/tags/ title><i class='fas fa-fw fa-tag'></i> 标签 </a><a href=/about/ title><i class='fas fa-fw fa-at'></i> 关于</a></div></div><a class=menu-item href=/friends/ title=欢迎申请友链><i class='fas fa-fw fa-link'></i> 友链</a><div class=dropdown><a href=javascript:void(0); class="menu-item menu-more dropbtn" title=一些有意思的东东~><i class='fas fa-fw fa-fan fa-spin'></i> 趣味</a><div class="menu-more-content dropdown-content"><a href=/funny/high/ title="前方高能♂ 小心外放！" target=_blank rel=noopener><i class='fas fa-fw fa-dizzy'></i> 燥起来！ </a><a href=/funny/mikutap/ title=初音未来音乐游戏 target=_blank rel=noopener><i class='fas fa-fw fa-music'></i> 在线打碟 </a><a href=/funny/catch-the-cat/ title=逮住那只猫!><i class='fas fa-fw fa-cat'></i> 抓住猫咪</a></div></div><div class=dropdown><a href=/ class="menu-item menu-more dropbtn" title=回到首页><i class='fas fa-fw fa-atom'></i> 站点</a><div class="menu-more-content dropdown-content"><a href=/bbs/ title=来留言吧~><i class='fas fa-fw fa-comment'></i> 公告留言 </a><a href=https://seo.chinaz.com title target=_blank rel=noopener><i class='fas fa-fw fa-chart-line'></i> SEO查询 </a><a href=https://www.ping.cn/http/lewky.cn title target=_blank rel=noopener><i class='fas fa-fw fa-bezier-curve'></i> 网站测速 </a><a href=/posts/e62c38c4.html/ title><i class='fas fa-fw fa-cog fa-spin'></i> 建站日志</a></div></div><div class=dropdown><a href=javascript:void(0); class="menu-item menu-more dropbtn" title><i class='fas fa-fw fa-book'></i> 文档</a><div class="menu-more-content dropdown-content"><a href=https://gohugo.io/documentation/ title target=_blank rel=noopener><i class='fas fa-fw fa-star'></i> Hugo文档 </a><a href=https://javanote.doc.lewky.cn/ title=尚在完善中~ target=_blank rel=noopener><i class='fab fa-fw fa-java'></i> Java 笔记</a></div></div><a class=menu-item href=/search/ title=渲染搜索结果需要等待几秒钟~><i class='fas fa-fw fa-search'></i> 搜索
</a><span class="menu-item delimiter"></span>
<a href=https://travellings.link target=_blank class=menu-item rel=noopener title=开往-友链接力><i class='fas fa-fw fa-subway'></i></a>
<a href=https://rssblog.vercel.app/ class=menu-item target=_blank rel=noopener title=RSSBlog><i class='fas fa-fw fa-inbox'></i></a>
<a href=https://github.com/lewky class=menu-item target=_blank rel=noopener title=GitHub><i class='fab fa-fw fa-github'></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Yulin Lewis' Blog"><span class=header-title-pre><i class='fas fa-fw fa-atom'></i></span>雨临Lewis</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=dropdown><a href=/posts/ class="menu-item menu-more dropbtn" title=点击查看所有文章><i class='fas fa-fw fa-archive'></i> 归档</a><div class="menu-more-content dropdown-content"><a href=/categories/ title><i class='fas fa-fw fa-th'></i> 分类 </a><a href=/tags/ title><i class='fas fa-fw fa-tag'></i> 标签 </a><a href=/about/ title><i class='fas fa-fw fa-at'></i> 关于</a></div></div><a class=menu-item href=/friends/ title=欢迎申请友链><i class='fas fa-fw fa-link'></i> 友链</a><div class=dropdown><a href=javascript:void(0); class="menu-item menu-more dropbtn" title=一些有意思的东东~><i class='fas fa-fw fa-fan fa-spin'></i> 趣味</a><div class="menu-more-content dropdown-content"><a href=/funny/high/ title="前方高能♂ 小心外放！" target=_blank rel=noopener><i class='fas fa-fw fa-dizzy'></i> 燥起来！ </a><a href=/funny/mikutap/ title=初音未来音乐游戏 target=_blank rel=noopener><i class='fas fa-fw fa-music'></i> 在线打碟 </a><a href=/funny/catch-the-cat/ title=逮住那只猫!><i class='fas fa-fw fa-cat'></i> 抓住猫咪</a></div></div><div class=dropdown><a href=/ class="menu-item menu-more dropbtn" title=回到首页><i class='fas fa-fw fa-atom'></i> 站点</a><div class="menu-more-content dropdown-content"><a href=/bbs/ title=来留言吧~><i class='fas fa-fw fa-comment'></i> 公告留言 </a><a href=https://seo.chinaz.com title target=_blank rel=noopener><i class='fas fa-fw fa-chart-line'></i> SEO查询 </a><a href=https://www.ping.cn/http/lewky.cn title target=_blank rel=noopener><i class='fas fa-fw fa-bezier-curve'></i> 网站测速 </a><a href=/posts/e62c38c4.html/ title><i class='fas fa-fw fa-cog fa-spin'></i> 建站日志</a></div></div><div class=dropdown><a href=javascript:void(0); class="menu-item menu-more dropbtn" title><i class='fas fa-fw fa-book'></i> 文档</a><div class="menu-more-content dropdown-content"><a href=https://gohugo.io/documentation/ title target=_blank rel=noopener><i class='fas fa-fw fa-star'></i> Hugo文档 </a><a href=https://javanote.doc.lewky.cn/ title=尚在完善中~ target=_blank rel=noopener><i class='fab fa-fw fa-java'></i> Java 笔记</a></div></div><a class=menu-item href=/search/ title=渲染搜索结果需要等待几秒钟~><i class='fas fa-fw fa-search'></i> 搜索</a>
<a href=https://travellings.link target=_blank class=menu-item rel=noopener title=开往-友链接力><i class='fas fa-fw fa-subway'></i></a>
<a href=https://rssblog.vercel.app/ class=menu-item target=_blank rel=noopener title=RSSBlog><i class='fas fa-fw fa-inbox'></i></a>
<a href=https://github.com/lewky class=menu-item target=_blank rel=noopener title=GitHub><i class='fab fa-fw fa-github'></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>目录</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animated flipInX">Log4j2 - 动态生成Appender</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw"></i>雨临Lewis</a></span>&nbsp;<span class=post-category>收录于 <a href=/categories/%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/><i class="far fa-folder fa-fw"></i>日志框架</a></span></div><div class=post-meta-line><i class="far fa-calendar fa-fw"></i>&nbsp;<time datetime=2019-01-03>2019-01-03</time>&nbsp;<i class="far fa-calendar-plus fa-fw"></i>&nbsp;<time datetime=2019-01-03>2019-01-03</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 2312 字
<i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 5 分钟&nbsp;<span id=/posts/8dc44b45.html/ class=leancloud_visitors data-flag-title="Log4j2 - 动态生成Appender">
<i class="far fa-eye fa-fw"></i>&nbsp;<span class=leancloud-visitors-count></span>&nbsp;次阅读
</span>&nbsp;
<a href=#comments id=post-meta-vcount title=查看评论><i class="fas fa-comment fa-fw"></i>&nbsp;<span id=/posts/8dc44b45.html/ class=waline-comment-count></span>&nbsp;条评论</a></div></div><div class="details toc" id=toc-static kept><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ol><li><a href=#功能需求>功能需求</a></li><li><a href=#实现思路>实现思路</a></li><li><a href=#代码的具体实现>代码的具体实现</a><ol><li><a href=#项目的log4j2依赖>项目的Log4j2依赖</a></li><li><a href=#动态生成appender>动态生成appender</a></li><li><a href=#在加载配置文件后拼接domain-appender>在加载配置文件后拼接domain appender</a></li></ol></li><li><a href=#对threadcontextmapfilter的补充>对ThreadContextMapFilter的补充</a></li><li><a href=#参考链接>参考链接</a></li></ol></nav></div></div><div class=content id=content><h2 id=功能需求>功能需求</h2><p>项目里将User分成了各个区域(domain)，这些domain有个标志domainId，现在要求在打印日志的时候，不仅将所有User的日志都打印到日志文件<code>logs/CNTCore.log</code>中，还需要另外再打印到对应domain的日志文件<code>logs/{domainId}/CNTCore.log</code>。</p><p>比如User A的domainId是<code>RD2</code>，那么除了<code>logs/CNTCore.log</code>外，还需要将该User A的日志额外打印到<code>logs/RD2/CNTCore.log</code>中。</p><h2 id=实现思路>实现思路</h2><p>将所有User的日志都打印到日志文件<code>logs/CNTCore.log</code>中，这个可以直接使用配置文件<code>log4j2.xml</code>来解决，一个简单的配置如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=cp>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;configuration</span> <span class=na>monitorInterval=</span><span class=s>&#34;30&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nt>&lt;Appenders&gt;</span>
</span></span><span class=line><span class=cl>		<span class=nt>&lt;Console</span> <span class=na>name=</span><span class=s>&#34;stdout&#34;</span> <span class=na>target=</span><span class=s>&#34;SYSTEM_OUT&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>			<span class=nt>&lt;PatternLayout</span> <span class=na>pattern=</span><span class=s>&#34;%-5p %m%n&#34;</span> <span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>			<span class=nt>&lt;ThresholdFilter</span> <span class=na>level=</span><span class=s>&#34;debug&#34;</span> <span class=na>onMatch=</span><span class=s>&#34;ACCEPT&#34;</span> <span class=na>onMismatch=</span><span class=s>&#34;DENY&#34;</span> <span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>		<span class=nt>&lt;/Console&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=nt>&lt;RollingFile</span> <span class=na>name=</span><span class=s>&#34;cntCorelog&#34;</span> <span class=na>immediateFlush=</span><span class=s>&#34;true&#34;</span> <span class=na>fileName=</span><span class=s>&#34;logs/CNTCore.log&#34;</span> <span class=na>filePattern=</span><span class=s>&#34;logs/CNTCore.log.%d{yyyy-MM-dd-a}.gz&#34;</span>
</span></span><span class=line><span class=cl>			<span class=na>append=</span><span class=s>&#34;true&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>			<span class=nt>&lt;PatternLayout&gt;</span>
</span></span><span class=line><span class=cl>				<span class=nt>&lt;pattern&gt;</span>%d{yyyy-MM-dd HH:mm:ss.SSS}:%p %t %X{TracingMsg} %c - %m%n<span class=nt>&lt;/pattern&gt;</span>
</span></span><span class=line><span class=cl>			<span class=nt>&lt;/PatternLayout&gt;</span>
</span></span><span class=line><span class=cl>			<span class=nt>&lt;Policies&gt;</span>
</span></span><span class=line><span class=cl>				<span class=nt>&lt;TimeBasedTriggeringPolicy</span> <span class=na>modulate=</span><span class=s>&#34;true&#34;</span> <span class=na>interval=</span><span class=s>&#34;1&#34;</span> <span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>			<span class=nt>&lt;/Policies&gt;</span>
</span></span><span class=line><span class=cl>		<span class=nt>&lt;/RollingFile&gt;</span>
</span></span><span class=line><span class=cl>	<span class=nt>&lt;/Appenders&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nt>&lt;Loggers&gt;</span>
</span></span><span class=line><span class=cl>		<span class=nt>&lt;Logger</span> <span class=na>name=</span><span class=s>&#34;com.lewis&#34;</span> <span class=na>level=</span><span class=s>&#34;debug&#34;</span> <span class=na>additivity=</span><span class=s>&#34;true&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>			<span class=nt>&lt;AppenderRef</span> <span class=na>ref=</span><span class=s>&#34;cntCorelog&#34;</span> <span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>		<span class=nt>&lt;/Logger&gt;</span>
</span></span><span class=line><span class=cl>		<span class=nt>&lt;Root</span> <span class=na>level=</span><span class=s>&#34;error&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>			<span class=nt>&lt;AppenderRef</span> <span class=na>ref=</span><span class=s>&#34;stdout&#34;</span> <span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>		<span class=nt>&lt;/Root&gt;</span>
</span></span><span class=line><span class=cl>	<span class=nt>&lt;/Loggers&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nt>&lt;/configuration&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>在上边的配置中，配置了<code>cntCorelog</code>这个appender来生成对应的回滚日志文件，具体由<code>com.lewis</code>这个logger来使用该appender进行拼接日志信息。</p><p>至于另外再打印到对应domain的日志文件<code>logs/{domainId}/CNTCore.log</code>，这个可以通过代码来动态生成各个domain的appender，并交由<code>com.lewis</code>这个logger来进行拼接日志。</p><h2 id=代码的具体实现>代码的具体实现</h2><h3 id=项目的log4j2依赖>项目的Log4j2依赖</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>	<span class=nt>&lt;groupId&gt;</span>org.apache.logging.log4j<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>	<span class=nt>&lt;artifactId&gt;</span>log4j-core<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>	<span class=nt>&lt;version&gt;</span>2.11.1<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/dependency&gt;</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=动态生成appender>动态生成appender</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>createDomainAppender</span><span class=o>(</span><span class=kd>final</span> <span class=n>String</span> <span class=n>domainId</span><span class=o>){</span>
</span></span><span class=line><span class=cl>    <span class=kd>final</span> <span class=n>LoggerContext</span> <span class=n>ctx</span> <span class=o>=</span> <span class=o>(</span><span class=n>LoggerContext</span><span class=o>)</span> <span class=n>LogManager</span><span class=o>.</span><span class=na>getContext</span><span class=o>(</span><span class=kc>false</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=kd>final</span> <span class=n>org</span><span class=o>.</span><span class=na>apache</span><span class=o>.</span><span class=na>logging</span><span class=o>.</span><span class=na>log4j</span><span class=o>.</span><span class=na>core</span><span class=o>.</span><span class=na>config</span><span class=o>.</span><span class=na>Configuration</span> <span class=n>config</span> <span class=o>=</span> <span class=n>ctx</span><span class=o>.</span><span class=na>getConfiguration</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>(</span><span class=n>config</span><span class=o>.</span><span class=na>getAppender</span><span class=o>(</span><span class=n>domainId</span> <span class=o>+</span> <span class=s>&#34;DomainCntCoreLog&#34;</span><span class=o>)</span> <span class=o>!=</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>final</span> <span class=n>PatternLayout</span> <span class=n>layout</span> <span class=o>=</span> <span class=n>PatternLayout</span><span class=o>.</span><span class=na>newBuilder</span><span class=o>()</span>
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=na>withCharset</span><span class=o>(</span><span class=n>Charset</span><span class=o>.</span><span class=na>forName</span><span class=o>(</span><span class=s>&#34;UTF-8&#34;</span><span class=o>))</span>
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=na>withConfiguration</span><span class=o>(</span><span class=n>config</span><span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=na>withPattern</span><span class=o>(</span><span class=s>&#34;%d %t %p %X{TracingMsg} %c - %m%n&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=na>build</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=kd>final</span> <span class=n>TriggeringPolicy</span> <span class=n>policy</span> <span class=o>=</span> <span class=n>TimeBasedTriggeringPolicy</span><span class=o>.</span><span class=na>newBuilder</span><span class=o>()</span>
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=na>withModulate</span><span class=o>(</span><span class=kc>true</span><span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=na>withInterval</span><span class=o>(</span><span class=mi>1</span><span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=na>build</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=kd>final</span> <span class=n>Appender</span> <span class=n>appender</span> <span class=o>=</span> <span class=n>RollingFileAppender</span><span class=o>.</span><span class=na>newBuilder</span><span class=o>()</span>
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=na>withName</span><span class=o>(</span><span class=n>domainId</span> <span class=o>+</span> <span class=s>&#34;DomainCntCoreLog&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=na>withImmediateFlush</span><span class=o>(</span><span class=kc>true</span><span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=na>withFileName</span><span class=o>(</span><span class=s>&#34;logs/&#34;</span> <span class=o>+</span> <span class=n>domainId</span> <span class=o>+</span> <span class=s>&#34;/CNTCore.log&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=na>withFilePattern</span><span class=o>(</span><span class=s>&#34;logs/&#34;</span> <span class=o>+</span> <span class=n>domainId</span> <span class=o>+</span> <span class=s>&#34;/CNTCore.log.%d{yyyy-MM-dd-a}.gz&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=na>withLayout</span><span class=o>(</span><span class=n>layout</span><span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=na>withPolicy</span><span class=o>(</span><span class=n>policy</span><span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=na>build</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=n>appender</span><span class=o>.</span><span class=na>start</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=n>config</span><span class=o>.</span><span class=na>addAppender</span><span class=o>(</span><span class=n>appender</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=kd>final</span> <span class=n>KeyValuePair</span><span class=o>[]</span> <span class=n>pairs</span> <span class=o>=</span> <span class=o>{</span><span class=n>KeyValuePair</span><span class=o>.</span><span class=na>newBuilder</span><span class=o>().</span><span class=na>setKey</span><span class=o>(</span><span class=s>&#34;domainId&#34;</span><span class=o>).</span><span class=na>setValue</span><span class=o>(</span><span class=n>domainId</span><span class=o>).</span><span class=na>build</span><span class=o>()};</span>
</span></span><span class=line><span class=cl>    <span class=kd>final</span> <span class=n>Filter</span> <span class=n>filter</span> <span class=o>=</span> <span class=n>ThreadContextMapFilter</span><span class=o>.</span><span class=na>createFilter</span><span class=o>(</span><span class=n>pairs</span><span class=o>,</span> <span class=kc>null</span><span class=o>,</span> <span class=n>Result</span><span class=o>.</span><span class=na>ACCEPT</span><span class=o>,</span> <span class=n>Result</span><span class=o>.</span><span class=na>DENY</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=n>config</span><span class=o>.</span><span class=na>getLoggerConfig</span><span class=o>(</span><span class=s>&#34;com.lewis&#34;</span><span class=o>).</span><span class=na>addAppender</span><span class=o>(</span><span class=n>appender</span><span class=o>,</span> <span class=n>Level</span><span class=o>.</span><span class=na>DEBUG</span><span class=o>,</span> <span class=n>filter</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=n>ctx</span><span class=o>.</span><span class=na>updateLoggers</span><span class=o>(</span><span class=n>config</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p>这段代码动态生成一个名为<code>omainCntCoreLog</code>的RollingFileAppender，该appender交由<code>com.lewis</code>这个logger来使用，并将日志信息输入到<code>logs/{domainId}/CNTCore.log</code>。</p><p>该logger在使用<code>domainCntCoreLog</code>这个RollingFileAppender时还设置了一个过滤器<code>ThreadContextMapFilter</code>，这个Filter用来控制logger只能对指定了domainId的进行打印日志。</p><p>ThreadContext是Log4j2用来存放线程信息的，相当于Log4j 1.X中的MDC和NDC，MDC是map，NDC是stack。当每个User登录时，就将该User的domainId存放到ThreadContext中，当退出登录时就将该domainId从ThreadContext中移除。</p><p>假如有10个User登录了，一个User对应一个线程，每个线程都存放了User对应的domainId。在用户登录时，调用上边的方法来动态生成domain appender；假如有10个domainId，就会生成10个domain appender。</p><p>由于这10个domain appender都被add到同一个logger里了，如果不通过ThreadContextMapFilter来控制，就会造成每个User的日志信息都会被输入到所有domain appender里去。</p><h3 id=在加载配置文件后拼接domain-appender>在加载配置文件后拼接domain appender</h3><p>需要注意的是，必须在读取配置文件后才能去动态生成appender或者其他的日志对象，否则会被原本的配置文件覆盖掉。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=kd>final</span> <span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>ThreadContext</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=s>&#34;domainId&#34;</span><span class=o>,</span> <span class=s>&#34;RD2&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=kd>final</span> <span class=n>String</span> <span class=n>domainId</span> <span class=o>=</span> <span class=s>&#34;RD2&#34;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>final</span> <span class=n>LoggerContext</span> <span class=n>context1</span> <span class=o>=</span> <span class=o>(</span><span class=n>org</span><span class=o>.</span><span class=na>apache</span><span class=o>.</span><span class=na>logging</span><span class=o>.</span><span class=na>log4j</span><span class=o>.</span><span class=na>core</span><span class=o>.</span><span class=na>LoggerContext</span><span class=o>)</span> <span class=n>LogManager</span><span class=o>.</span><span class=na>getContext</span><span class=o>(</span><span class=kc>false</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>context1</span><span class=o>.</span><span class=na>setConfigLocation</span><span class=o>(</span><span class=n>Loader</span><span class=o>.</span><span class=na>getResource</span><span class=o>(</span><span class=s>&#34;log4j2.xml&#34;</span><span class=o>,</span> <span class=kc>null</span><span class=o>).</span><span class=na>toURI</span><span class=o>());</span>
</span></span><span class=line><span class=cl>        <span class=n>createDomainAppender</span><span class=o>(</span><span class=n>domainId</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=kd>final</span> <span class=n>Exception</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>LogManager</span><span class=o>.</span><span class=na>getRootLogger</span><span class=o>().</span><span class=na>error</span><span class=o>(</span><span class=s>&#34;load log4j2 configuration error&#34;</span><span class=o>,</span> <span class=n>e</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>ThreadContext</span><span class=o>.</span><span class=na>remove</span><span class=o>(</span><span class=s>&#34;domainId&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p>上边的代码简单地动态生成了RD2 domain的appender，需要注意的是，如果启用了Log4j2的动态加载配置文件功能，那么当配置文件被改动后并被重新加载时，会导致原本动态生成的domain appender无效。</p><p>因为重新加载配置文件会生成新的LoggerContext对象，这时候可能会丢失一部分日志信息到对应的domain日志文件里。对于这个暂时没找到很好的解决方法，目前只能是在每个User登录时去创建domain appender对象，如果已存在就不创建。</p><h2 id=对threadcontextmapfilter的补充>对ThreadContextMapFilter的补充</h2><p>上边通过代码动态生成了RollingFileAppender和ThreadContextMapFilter，下边记录下配置文件里的写法：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;RollingFile</span> <span class=na>name=</span><span class=s>&#34;domainCntCoreLog&#34;</span> <span class=na>immediateFlush=</span><span class=s>&#34;true&#34;</span> <span class=na>fileName=</span><span class=s>&#34;logs/RD2/CNTCore.log&#34;</span> <span class=na>filePattern=</span><span class=s>&#34;logs/RD2/CNTCore.log.%d{yyyy-MM-dd-a}.gz&#34;</span> <span class=na>append=</span><span class=s>&#34;true&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>   <span class=nt>&lt;ThreadContextMapFilter</span> <span class=na>onMatch=</span><span class=s>&#34;ACCEPT&#34;</span>
</span></span><span class=line><span class=cl>    <span class=na>onMismatch=</span><span class=s>&#34;DENY&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>	   <span class=nt>&lt;KeyValuePair</span> <span class=na>key=</span><span class=s>&#34;domainId&#34;</span> <span class=na>value=</span><span class=s>&#34;RD2&#34;</span> <span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>   <span class=nt>&lt;/ThreadContextMapFilter&gt;</span>
</span></span><span class=line><span class=cl>   <span class=nt>&lt;PatternLayout</span>   <span class=na>pattern=</span><span class=s>&#34;%d %t %p %X{TracingMsg} %c - %m%n&#34;</span> <span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>   <span class=nt>&lt;Policies&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;TimeBasedTriggeringPolicy</span> <span class=na>modulate=</span><span class=s>&#34;true&#34;</span> <span class=na>interval=</span><span class=s>&#34;1&#34;</span> <span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>   <span class=nt>&lt;/Policies&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/RollingFile&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>从上边的配置就可以看出来短板了，只能配置死某个domainId的RollingFileAppender以及ThreadContextMapFilter，假如有10个domainId，就要手动配置十个对应的appender和Filter，很是繁琐。</p><p>就算通过占位符${ctx:domainId}的写法来避免写死，也只能生成某个domainId的appender：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;RollingFile</span> <span class=na>name=</span><span class=s>&#34;domainCntCoreLog&#34;</span> <span class=na>immediateFlush=</span><span class=s>&#34;true&#34;</span> <span class=na>fileName=</span><span class=s>&#34;logs/${ctx:domainId}/CNTCore.log&#34;</span> <span class=na>filePattern=</span><span class=s>&#34;logs/${ctx:domainId}/CNTCore.log.%d{yyyy-MM-dd-a}.gz&#34;</span> <span class=na>append=</span><span class=s>&#34;true&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>   <span class=nt>&lt;ThreadContextMapFilter</span> <span class=na>onMatch=</span><span class=s>&#34;ACCEPT&#34;</span>
</span></span><span class=line><span class=cl>    <span class=na>onMismatch=</span><span class=s>&#34;DENY&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>	   <span class=nt>&lt;KeyValuePair</span> <span class=na>key=</span><span class=s>&#34;domainId&#34;</span> <span class=na>value=</span><span class=s>&#34;${ctx:domainId}&#34;</span> <span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>   <span class=nt>&lt;/ThreadContextMapFilter&gt;</span>
</span></span><span class=line><span class=cl>   <span class=nt>&lt;PatternLayout</span>   <span class=na>pattern=</span><span class=s>&#34;%d %t %p %X{TracingMsg} %c - %m%n&#34;</span> <span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>   <span class=nt>&lt;Policies&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;TimeBasedTriggeringPolicy</span> <span class=na>modulate=</span><span class=s>&#34;true&#34;</span> <span class=na>interval=</span><span class=s>&#34;1&#34;</span> <span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>   <span class=nt>&lt;/Policies&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/RollingFile&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>这种方法只能生成一个domain appender，此外如果启用了动态加载配置文件的功能，在扫描配置文件是否改动时，还会报错，原因是在RollingFileAppender的FileName和filePattern里使用了占位符。在另起线程扫描配置文件时，该占位符时取不到值的，于是就会报错。</p><h2 id=参考链接>参考链接</h2><ul><li><a href=https://segmentfault.com/a/1190000006973000 target=_blank rel="noopener noreffer">运行时添加log4j2的appender</a></li><li><a href=http://arganzheng.life/log4j2-create-logger-programmatic.html target=_blank rel="noopener noreffer">log4j2如何动态的创建logger和appender</a></li><li><a href=https://www.cnblogs.com/0201zcr/p/5726072.html target=_blank rel="noopener noreffer">log4j2 不使用配置文件，动态生成logger对象</a></li><li><a href=https://blog.csdn.net/json20080301/article/details/41984143 target=_blank rel="noopener noreffer">log4j2的MDC应用配置</a></li></ul><div class="details admonition warning open"><div class="details-summary admonition-title"><i class="icon fas fa-exclamation-triangle fa-fwwarning"></i>警告<i class="details-icon fas fa-angle-right fa-fw"></i></div><div class=details-content><div class=admonition-content>本文最后更新于 <span class=timeago datetime=2019-01-03T21:39:59 title="January 3, 2019">January 3, 2019</span>，文中内容可能已过时，请谨慎使用。</div></div></div><div class=post-reward><input type=checkbox name=reward id=reward hidden>
<label class=reward-button for=reward>赞赏支持</label><div class=qr-code><label class=qr-code-image for=reward><img class=image src=https://lewky.cn/images/reward/wechat.png>
<span>微信打赏</span></label>
<label class=qr-code-image for=reward><img class=image src=https://lewky.cn/images/reward/alipay.png>
<span>支付宝打赏</span></label></div></div></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>更新于 2019-01-03</span></div><div class=post-info-license><span><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-markdown href=/posts/8dc44b45.html/index.md target=_blank>阅读原始文档</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 Twitter" data-sharer=twitter data-url=https://lewky.cn/posts/8dc44b45.html/ data-title="Log4j2 - 动态生成Appender" data-hashtags=Log4j,Log4j2><i class="fab fa-twitter fa-fw"></i></a><a href=javascript:void(0); title="分享到 Facebook" data-sharer=facebook data-url=https://lewky.cn/posts/8dc44b45.html/ data-hashtag=Log4j><i class="fab fa-facebook-square fa-fw"></i></a><a href=javascript:void(0); title="分享到 Hacker News" data-sharer=hackernews data-url=https://lewky.cn/posts/8dc44b45.html/ data-title="Log4j2 - 动态生成Appender"><i class="fab fa-hacker-news fa-fw"></i></a><a href=javascript:void(0); title="分享到 Line" data-sharer=line data-url=https://lewky.cn/posts/8dc44b45.html/ data-title="Log4j2 - 动态生成Appender"><i data-svg-src=https://unpkg.com/simple-icons@2.14.0/icons/line.svg></i></a><a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://lewky.cn/posts/8dc44b45.html/ data-title="Log4j2 - 动态生成Appender"><i class="fab fa-weibo fa-fw"></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/tags/log4j/>Log4j</a>,&nbsp;<a href=/tags/log4j2/>Log4j2</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/posts/55fa957a.html/ class=prev rel=prev title="升级Log4j到Log4j2报错：cannot access org.apache.http.annotation.NotThreadSafe"><i class="fas fa-angle-left fa-fw"></i>升级Log4j到Log4j2报错：cannot access org.apache.http.annotation.NotThreadSafe</a>
<a href=/posts/git-issues/ class=next rel=next title=Git问题汇总>Git问题汇总<i class="fas fa-angle-right fa-fw"></i></a></div></div><div id=comments><div id=waline></div><script src=/js/Waline.min.js></script>
<script>new Waline({el:"#waline",meta:["nick","mail","link"],requiredMeta:["nick","mail"],login:"force",placeholder:"为防恶意灌水攻击，评论前需注册并登录，望见谅~",serverURL:"https://comment.lewky.cn/",avatarCDN:"https://cravatar.cn/avatar/",pageSize:20,avatar:"retro",lang:"zh-CN",visitor:!0,highlight:!0,uploadImage:!1,emoji:["https://lewky.cn/images/emoji/嘉然今天吃什么","https://lewky.cn/images/emoji/大航海嘉然","https://lewky.cn/images/emoji/向晚大魔王","https://lewky.cn/images/emoji/贝拉kira","https://lewky.cn/images/emoji/珈乐Carol","https://lewky.cn/images/emoji/乃琳Queen","https://lewky.cn/images/emoji/EveOneCat","https://lewky.cn/images/emoji/weibo","https://lewky.cn/images/emoji/滑稽","https://lewky.cn/images/emoji/default"]})</script></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line><span id=run-time></span>|
<a href=http://rssblog.vercel.app/ target=_blank rel=noopener title=RSSBlog><i class='fas fa-fw fa-inbox'></i>&nbsp;RSSBlog</a></div><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2018 - 2024</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank>雨临Lewis</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span><span class=icp-splitter>&nbsp;|&nbsp;</span><br class=icp-br><span class=icp><a target=_blank href=http://www.beian.miit.gov.cn/ style=font-weight:700>粤ICP备19103822</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到顶部><i class="fas fa-arrow-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fas fa-comment fa-fw"></i></a></div><div class=sidebar_wo><div id=leimu><img src=https://lewky.cn/images/b2t/leimuA.png alt=雷姆 onmouseover='this.src="https://lewky.cn/images/b2t/leimuB.png"' onmouseout='this.src="https://lewky.cn/images/b2t/leimuA.png"' title=回到顶部></div><div class=sidebar_wo id=lamu><img src=https://lewky.cn/images/b2t/lamuA.png alt=雷姆 onmouseover='this.src="https://lewky.cn/images/b2t/lamuB.png"' onmouseout='this.src="https://lewky.cn/images/b2t/lamuA.png"' title=回到底部></div></div><link rel=stylesheet href=https://unpkg.com/lightgallery.js@1.2.0/dist/css/lightgallery.min.css><script type=text/javascript src=https://unpkg.com/smooth-scroll@16.1.3/dist/smooth-scroll.min.js></script><script type=text/javascript src=https://unpkg.com/lazysizes@5.2.2/lazysizes.min.js></script><script type=text/javascript src=https://unpkg.com/lightgallery.js@1.2.0/dist/js/lightgallery.min.js></script><script type=text/javascript src=https://unpkg.com/lg-thumbnail.js@1.2.0/dist/lg-thumbnail.min.js></script><script type=text/javascript src=https://unpkg.com/lg-zoom.js@1.2.0/dist/lg-zoom.min.js></script><script type=text/javascript src=https://unpkg.com/clipboard@2.0.6/dist/clipboard.min.js></script><script type=text/javascript src=https://unpkg.com/sharer.js@0.4.0/sharer.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"复制到剪贴板",maxShownLines:30},comment:{},lightGallery:{actualSize:!1,exThumbImage:"data-thumbnail",hideBarsDelay:2e3,selector:".lightgallery",speed:400,thumbContHeight:80,thumbWidth:80,thumbnail:!0}}</script><script type=text/javascript src=/js/theme.min.js></script><script type=text/javascript src=https://unpkg.com/jquery@2.1.3/dist/jquery.min.js></script><script type=text/javascript src=https://unpkg.com/jquery-backstretch@2.1.18/jquery.backstretch.min.js></script><script>var $cdnPrefix="https://lewky.cn"</script>
<script type=text/javascript src=/js/custom.js></script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?6f278ed0fdb01edb3b1e7398379e5432",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script></body></html>