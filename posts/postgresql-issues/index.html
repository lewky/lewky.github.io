<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta http-equiv=x-ua-compatible content="IE=edge, chrome=1"><title>PostgreSQL问题汇总 - Yulin Lewis' Blog</title><meta name=keywords content="雨临Lewis,Java,hugo,hexo,博客"><meta name=Description content="不想当写手的码农不是好咸鱼_(xз」∠)_"><meta property="og:title" content="PostgreSQL问题汇总"><meta property="og:description" content="修改默认端口号
PostgreSQL默认使用5432端口号，如果要连接其他端口号，必须通过-p参数来指定端口号。
如果不想指定端口号就能连接数据库，则需要修改默认端口号。首先将PostgreSQL的server服务关闭，这个要在系统的服务管理器中将其关闭：

win + R快捷键打开运行；
输入services.msc打开服务管理器；
找到运行中的PostgreSQL的server服务将其关闭。"><meta property="og:type" content="article"><meta property="og:url" content="https://lewky.cn/posts/postgresql-issues/"><meta property="og:image" content="https://lewky.cn/logo.png"><meta property="article:published_time" content="2018-08-02T22:41:17+08:00"><meta property="article:modified_time" content="2022-03-19T22:41:17+08:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://lewky.cn/logo.png"><meta name=twitter:title content="PostgreSQL问题汇总"><meta name=twitter:description content="修改默认端口号
PostgreSQL默认使用5432端口号，如果要连接其他端口号，必须通过-p参数来指定端口号。
如果不想指定端口号就能连接数据库，则需要修改默认端口号。首先将PostgreSQL的server服务关闭，这个要在系统的服务管理器中将其关闭：

win + R快捷键打开运行；
输入services.msc打开服务管理器；
找到运行中的PostgreSQL的server服务将其关闭。"><meta name=application-name content="雨临Lewis的博客"><meta name=apple-mobile-web-app-title content="雨临Lewis的博客"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5916478302479037" crossorigin=anonymous></script><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://lewky.cn/posts/postgresql-issues/><link rel=prev href=https://lewky.cn/posts/postgresql-psql.html/><link rel=next href=https://lewky.cn/posts/9cdb4f66.html/><link rel=stylesheet href=https://unpkg.com/normalize.css@8.0.1/normalize.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=https://unpkg.com/@fortawesome/fontawesome-free@5.13.0/css/all.min.css><link rel=stylesheet href=https://unpkg.com/animate.css@3.7.2/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"PostgreSQL问题汇总","inLanguage":"","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/lewky.cn\/posts\/postgresql-issues\/"},"genre":"posts","keywords":"工作记录","wordcount":2878,"url":"https:\/\/lewky.cn\/posts\/postgresql-issues\/","datePublished":"2018-08-02T22:41:17+08:00","dateModified":"2022-03-19T22:41:17+08:00","license":"This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher":{"@type":"Organization","name":"雨临Lewis","logo":"https:\/\/lewky.cn\/images\/avatar.jpg"},"author":{"@type":"Person","name":"雨临Lewis"},"description":""}</script></head><body header-desktop=fixed header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem('theme')?localStorage.getItem('theme')==='dark':('auto'==='auto'?window.matchMedia('(prefers-color-scheme: dark)').matches:'auto'==='dark'))&&document.body.setAttribute('theme','dark');</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><a href=https://github.com/lewky class=github-corner target=_blank title="Follow me on GitHub" aria-label="Follow me on GitHub"><svg width="3.5rem" height="3.5rem" viewBox="0 0 250 250" style="fill:#70b7fd;color:#fff;position:absolute;top:0;border:0;left:0;transform:scale(-1,1)" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentcolor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentcolor" class="octo-body"/></svg></a><div class=header-title><a href=/ title="Yulin Lewis' Blog"><span class=header-title-pre><i class="fas fa-fw fa-atom"></i></span>雨临Lewis</a></div><div class=menu><div class=menu-inner><div class=dropdown><a href=/posts/ class="menu-item menu-more dropbtn" title=点击查看所有文章><i class="fas fa-fw fa-archive"></i>归档</a><div class="menu-more-content dropdown-content"><a href=/categories/><i class="fas fa-fw fa-th"></i>分类 </a><a href=/tags/><i class="fas fa-fw fa-tag"></i>标签 </a><a href=/about/><i class="fas fa-fw fa-at"></i>关于</a></div></div><a class=menu-item href=/friends/ title=欢迎申请友链><i class="fas fa-fw fa-link"></i>友链</a><div class=dropdown><a href=javascript:void(0); class="menu-item menu-more dropbtn" title=一些有意思的东东~><i class="fas fa-fw fa-fan fa-spin"></i>趣味</a><div class="menu-more-content dropdown-content"><a href=/funny/high/ title="前方高能♂ 小心外放！" target=_blank rel=noopener><i class="fas fa-fw fa-dizzy"></i>燥起来！ </a><a href=/funny/mikutap/ title=初音未来音乐游戏 target=_blank rel=noopener><i class="fas fa-fw fa-music"></i>在线打碟 </a><a href=/funny/catch-the-cat/ title=逮住那只猫!><i class="fas fa-fw fa-cat"></i>抓住猫咪</a></div></div><div class=dropdown><a href=/ class="menu-item menu-more dropbtn" title=回到首页><i class="fas fa-fw fa-atom"></i>站点</a><div class="menu-more-content dropdown-content"><a href=/bbs/ title=来留言吧~><i class="fas fa-fw fa-comment"></i>公告留言 </a><a href=https://seo.chinaz.com target=_blank rel=noopener><i class="fas fa-fw fa-chart-line"></i>SEO查询 </a><a href=https://www.ping.cn/http/lewky.cn target=_blank rel=noopener><i class="fas fa-fw fa-bezier-curve"></i>网站测速 </a><a href=/posts/e62c38c4.html/><i class="fas fa-fw fa-cog fa-spin"></i>建站日志</a></div></div><div class=dropdown><a href=javascript:void(0); class="menu-item menu-more dropbtn"><i class="fas fa-fw fa-book"></i>文档</a><div class="menu-more-content dropdown-content"><a href=https://gohugo.io/documentation/ target=_blank rel=noopener><i class="fas fa-fw fa-star"></i>Hugo文档 </a><a href=https://javanote.doc.lewky.cn/ title=尚在完善中~ target=_blank rel=noopener><i class="fab fa-fw fa-java"></i>Java 笔记</a></div></div><a class=menu-item href=/search/ title=渲染搜索结果需要等待几秒钟~><i class="fas fa-fw fa-search"></i>搜索
</a><span class="menu-item delimiter"></span><a href=https://travellings.link target=_blank class=menu-item rel=noopener title=开往-友链接力><i class="fas fa-fw fa-subway"></i></a><a href=https://rssblog.vercel.app/ class=menu-item target=_blank rel=noopener title=RSSBlog><i class="fas fa-fw fa-inbox"></i></a><a href=https://github.com/lewky class=menu-item target=_blank rel=noopener title=GitHub><i class="fab fa-fw fa-github"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Yulin Lewis' Blog"><span class=header-title-pre><i class="fas fa-fw fa-atom"></i></span>雨临Lewis</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=dropdown><a href=/posts/ class="menu-item menu-more dropbtn" title=点击查看所有文章><i class="fas fa-fw fa-archive"></i>归档</a><div class="menu-more-content dropdown-content"><a href=/categories/><i class="fas fa-fw fa-th"></i>分类 </a><a href=/tags/><i class="fas fa-fw fa-tag"></i>标签 </a><a href=/about/><i class="fas fa-fw fa-at"></i>关于</a></div></div><a class=menu-item href=/friends/ title=欢迎申请友链><i class="fas fa-fw fa-link"></i>友链</a><div class=dropdown><a href=javascript:void(0); class="menu-item menu-more dropbtn" title=一些有意思的东东~><i class="fas fa-fw fa-fan fa-spin"></i>趣味</a><div class="menu-more-content dropdown-content"><a href=/funny/high/ title="前方高能♂ 小心外放！" target=_blank rel=noopener><i class="fas fa-fw fa-dizzy"></i>燥起来！ </a><a href=/funny/mikutap/ title=初音未来音乐游戏 target=_blank rel=noopener><i class="fas fa-fw fa-music"></i>在线打碟 </a><a href=/funny/catch-the-cat/ title=逮住那只猫!><i class="fas fa-fw fa-cat"></i>抓住猫咪</a></div></div><div class=dropdown><a href=/ class="menu-item menu-more dropbtn" title=回到首页><i class="fas fa-fw fa-atom"></i>站点</a><div class="menu-more-content dropdown-content"><a href=/bbs/ title=来留言吧~><i class="fas fa-fw fa-comment"></i>公告留言 </a><a href=https://seo.chinaz.com target=_blank rel=noopener><i class="fas fa-fw fa-chart-line"></i>SEO查询 </a><a href=https://www.ping.cn/http/lewky.cn target=_blank rel=noopener><i class="fas fa-fw fa-bezier-curve"></i>网站测速 </a><a href=/posts/e62c38c4.html/><i class="fas fa-fw fa-cog fa-spin"></i>建站日志</a></div></div><div class=dropdown><a href=javascript:void(0); class="menu-item menu-more dropbtn"><i class="fas fa-fw fa-book"></i>文档</a><div class="menu-more-content dropdown-content"><a href=https://gohugo.io/documentation/ target=_blank rel=noopener><i class="fas fa-fw fa-star"></i>Hugo文档 </a><a href=https://javanote.doc.lewky.cn/ title=尚在完善中~ target=_blank rel=noopener><i class="fab fa-fw fa-java"></i>Java 笔记</a></div></div><a class=menu-item href=/search/ title=渲染搜索结果需要等待几秒钟~><i class="fas fa-fw fa-search"></i>搜索</a>
<a href=https://travellings.link target=_blank class=menu-item rel=noopener title=开往-友链接力><i class="fas fa-fw fa-subway"></i></a><a href=https://rssblog.vercel.app/ class=menu-item target=_blank rel=noopener title=RSSBlog><i class="fas fa-fw fa-inbox"></i></a><a href=https://github.com/lewky class=menu-item target=_blank rel=noopener title=GitHub><i class="fab fa-fw fa-github"></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>目录</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animated flipInX">PostgreSQL问题汇总</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw"></i>雨临Lewis</a></span>&nbsp;<span class=post-category>收录于 <a href=/categories/postgresql/><i class="far fa-folder fa-fw"></i>PostgreSQL</a></span></div><div class=post-meta-line><i class="far fa-calendar fa-fw"></i>&nbsp;<time datetime=2018-08-02>2018-08-02</time>&nbsp;<i class="far fa-calendar-plus fa-fw"></i>&nbsp;<time datetime=2022-03-19>2022-03-19</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 2878 字
<i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 6 分钟&nbsp;<span id=/posts/postgresql-issues/ class=leancloud_visitors data-flag-title=PostgreSQL问题汇总>
<i class="far fa-eye fa-fw"></i>&nbsp;<span class=leancloud-visitors-count></span>&nbsp;次阅读
</span>&nbsp;
<a href=#comments id=post-meta-vcount title=查看评论><i class="fas fa-comment fa-fw"></i>&nbsp;<span id=/posts/postgresql-issues/ class=waline-comment-count></span>&nbsp;条评论</a></div></div><div class="details toc" id=toc-static kept><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ol><li><a href=#修改默认端口号>修改默认端口号</a></li><li><a href=#pgadmin4远程连接数据库>pgAdmin4远程连接数据库</a><ol><li><a href=#操作步骤>操作步骤</a></li><li><a href=#执行sql语句>执行SQL语句</a></li></ol></li><li><a href=#设置远程访问数据库>设置远程访问数据库</a><ol><li><a href=#修改pg_hbaconf文件>修改pg_hba.conf文件</a></li><li><a href=#修改postgresqlconf文件>修改postgresql.conf文件</a></li></ol></li><li><a href=#invalid-input-syntax-for-type-timestamp-with-time-zone>invalid input syntax for type timestamp with time zone</a></li><li><a href=#怎么转义字符>怎么转义字符</a><ol><li><a href=#使用e和反斜杠进行转义>使用E和反斜杠进行转义</a></li><li><a href=#直接用一个单引号来转义单引号>直接用一个单引号来转义单引号</a></li></ol></li><li><a href=#如何杀掉被锁死的进程>如何杀掉被锁死的进程</a><ol><li><a href=#杀掉指定进程>杀掉指定进程</a></li><li><a href=#杀掉指定表指定锁的进程>杀掉指定表指定锁的进程</a></li></ol></li><li><a href=#参考链接>参考链接</a></li></ol></nav></div></div><div class=content id=content><h2 id=修改默认端口号>修改默认端口号</h2><p>PostgreSQL默认使用5432端口号，如果要连接其他端口号，必须通过<code>-p</code>参数来指定端口号。</p><p>如果不想指定端口号就能连接数据库，则需要修改默认端口号。首先将PostgreSQL的server服务关闭，这个要在系统的服务管理器中将其关闭：</p><ul><li>win + R快捷键打开运行；</li><li>输入<code>services.msc</code>打开服务管理器；</li><li>找到运行中的PostgreSQL的server服务将其关闭。</li></ul><p>在PostgreSQL的安装路径下，找到对应版本的postgresql.conf文件（在data文件夹内）：</p><ul><li>修改<code>port = 5432</code>；</li><li>保存修改，重启该版本的server服务，即可生效。</li></ul><h2 id=pgadmin4远程连接数据库>pgAdmin4远程连接数据库</h2><p>PostgreSQL在安装的时候自带的pgAdmin这个可视化工具，自从将PostgreSQL9升级到了10版本后，自带的pgAdmin也从3升级到了4版本。pgAdmin4的变化非常巨大，这里记录下怎么用pgAdmin4进行远程连接数据库并执行SQL语句。</p><h3 id=操作步骤>操作步骤</h3><ol><li>选中Browser窗口里的Servers -> 点击上方工具栏里的Object -> Create -> Server&mldr;</li><li>在弹窗的General tab里填写Name，可以随意命名</li><li>接着选择第二个tab：Connection，填写Host的ip地址、端口号、数据库名、用户名、密码，点击save保存</li></ol><h3 id=执行sql语句>执行SQL语句</h3><p>在配置好上边的server后，连接该server，接着连接server下的某个Database，连接成功后可以通过以下方式来执行SQL：</p><ol><li>点击上方工具栏里的Tools -> Query Tool</li><li>输入SQL</li><li>选定某条SQL语句，点击Query Tool里的闪电标志的按钮，就可以执行改SQL语句</li></ol><p>虽然pgAdmin4比起3的ui好看了很多，在restore db的时候也变成了后台异步restore，不至于在restore比较大的db时阻塞住进程。但个人还是更喜欢另一款可视化工具DBeaver，不仅支持市面上各大常见的数据库，还有很多好用的功能和快捷键，真的非常好用！！强烈推荐！！</p><h2 id=设置远程访问数据库>设置远程访问数据库</h2><p>安装PostgreSQL数据库之后，默认是只接受本地访问连接。如果想在其他主机上访问PostgreSQL数据库服务器，就需要进行相应的配置，需要修改data目录下的<code>pg_hba.conf</code>和<code>postgresql.conf</code>。</p><p><code>pg_hba.conf</code>配置对数据库的访问权限，<code>postgresql.conf</code>配置PostgreSQL数据库服务器的相应的参数。</p><h3 id=修改pg_hbaconf文件>修改pg_hba.conf文件</h3><p>配置用户的访问权限（#开头的行是注释内容）</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-html data-lang=html># TYPE DATABASE  USER    CIDR-ADDRESS     METHOD

# &#34;local&#34; is for Unix domain socket connections only
local all    all               trust
# IPv4 local connections:
host  all    all    127.0.0.1/32     trust
host  all    all    192.168.1.0/24    md5
# IPv6 local connections:
host  all    all    ::1/128       trust
</code></pre></td></tr></table></div></div><p>上边的第7行是新添加的内容，表示允许网段192.168.1.0上的所有主机使用所有合法的数据库用户名访问数据库，并提供加密的密码验证。</p><p>其中，数字24是子网掩码，表示允许192.168.1.0 ~ 192.168.1.255的计算机访问。</p><h3 id=修改postgresqlconf文件>修改postgresql.conf文件</h3><p>将数据库服务器的监听模式修改为监听所有主机发出的连接请求：</p><p>定位到<code>#listen_addresses='localhost'</code>，PostgreSQL安装完成后，默认是只接受来在本机localhost的连接请求。</p><p>将行开头的#去掉，将行内容修改为<code>listen_addresses='*'</code>来允许数据库服务器监听来自任何主机的连接请求。</p><h2 id=invalid-input-syntax-for-type-timestamp-with-time-zone>invalid input syntax for type timestamp with time zone</h2><p>在执行以下sql时报错：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-sql data-lang=sql><span class=k>select</span> <span class=n>COALESCE</span><span class=p>(</span><span class=k>null</span><span class=p>,</span><span class=k>null</span><span class=p>,</span><span class=n>now</span><span class=p>(),</span><span class=s1>&#39;&#39;</span><span class=p>);</span>
</code></pre></td></tr></table></div></div><p>报错如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>SQL Error [22007]: ERROR: invalid input syntax for type timestamp with time zone: &#34;&#34;
Position: 33
org.postgresql.util.PSQLException: ERROR: invalid input syntax for type timestamp with time zone: &#34;&#34;
Position: 33
</code></pre></td></tr></table></div></div><p>由于<code>coalesce()</code>要求输入参数是null或字符串，而<code>now()</code>返回的结果是带有时区的时间戳，所以就会报错；需要把时间戳转换成字符串才可以：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-sql data-lang=sql><span class=k>select</span> <span class=n>COALESCE</span><span class=p>(</span><span class=k>null</span><span class=p>,</span><span class=k>null</span><span class=p>,</span><span class=n>now</span><span class=p>()</span><span class=o>||</span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=s1>&#39;&#39;</span><span class=p>);</span> 

<span class=k>select</span> <span class=n>COALESCE</span><span class=p>(</span><span class=k>null</span><span class=p>,</span><span class=k>null</span><span class=p>,</span><span class=n>now</span><span class=p>()::</span><span class=nb>varchar</span><span class=p>,</span><span class=s1>&#39;&#39;</span><span class=p>);</span>
</code></pre></td></tr></table></div></div><h2 id=怎么转义字符>怎么转义字符</h2><h3 id=使用e和反斜杠进行转义>使用E和反斜杠进行转义</h3><p>在PostgreSQL 9之前的版本中，可以直接使用反斜杠<code>\</code>进行转义；比如：\b表示退格，\n表示换行，\t表示水平制表符，\r标示回车，\f表示换页。除此之外还支持\digits和\xhexdigits，分别表示转义八进制和十六进制数据。</p><p>但是在PostgreSQL 9之后的版本，反斜杠已经变成了普通字符；如果想要使用反斜杠来转义字符，就必须在需要转义的字符串前面加上E（E就是Escape），如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-sql data-lang=sql><span class=k>select</span> <span class=n>E</span><span class=s1>&#39;张\t小明&#39;</span><span class=p>;</span>
</code></pre></td></tr></table></div></div><h3 id=直接用一个单引号来转义单引号>直接用一个单引号来转义单引号</h3><p>在SQL标准中字符串是用单引号括起来的，而在PostgreSQL中遵守了该标准，双引号则是用来表示变量的，如果在字符串中需要使用到单引号，就需要对其进行转义。</p><p>除了使用E和反斜杠进行转义单引号外：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-sql data-lang=sql><span class=k>select</span> <span class=n>E</span><span class=s1>&#39;\&#39;</span><span class=mi>233</span><span class=s1>&#39;;
</span></code></pre></td></tr></table></div></div><p>还可以直接用一个单引号来转义单引号：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-sql data-lang=sql><span class=k>select</span> <span class=s1>&#39;&#39;&#39;233&#39;</span><span class=p>;</span>
</code></pre></td></tr></table></div></div><p>这两种方式都能得到<code>'233</code>的结果而不会报错，第二种方式比较简单，也可以通过修改<code>standard_conforming_strings</code>参数的值来让反斜杠从普通字符变回转义字符：</p><p>查询并修改该参数的值：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-sql data-lang=sql><span class=k>show</span> <span class=n>standard_conforming_strings</span><span class=p>;</span>
<span class=k>SET</span> <span class=n>standard_conforming_strings</span> <span class=o>=</span> <span class=k>on</span><span class=p>;</span>
<span class=k>SET</span> <span class=n>standard_conforming_strings</span> <span class=o>=</span> <span class=k>off</span><span class=p>;</span>
</code></pre></td></tr></table></div></div><p>当该参数的值为off时就可以直接使用反斜杠作为转义字符里，如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-sql data-lang=sql><span class=k>select</span> <span class=s1>&#39;\&#39;</span><span class=mi>233</span><span class=s1>&#39;;
</span></code></pre></td></tr></table></div></div><p>将会得到<code>'233</code>的结果而不会报错。</p><h2 id=如何杀掉被锁死的进程>如何杀掉被锁死的进程</h2><h3 id=杀掉指定进程>杀掉指定进程</h3><p>PostgreSQL提供了两个函数：<code>pg_cancel_backend()</code>和<code>pg_terminate_backend()</code>，这两个函数的输入参数是进程PID，假定现在要杀死进程PID为20407的进程，使用方法如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-sql data-lang=sql><span class=k>select</span> <span class=n>pg_cancel_backend</span><span class=p>(</span><span class=mi>20407</span><span class=p>);</span>

<span class=c1>--或者执行这个函数也可以：
</span><span class=c1></span><span class=k>select</span> <span class=n>pg_terminate_backend</span><span class=p>(</span><span class=mi>20407</span><span class=p>);</span>
</code></pre></td></tr></table></div></div><p>这两个函数区别如下：</p><p><code>pg_cancel_backend()</code></p><ol><li>只能关闭当前用户下的后台进程</li><li>向后台发送SIGINT信号，用于关闭事务，此时session还在，并且事务回滚</li></ol><p><code>pg_terminate_backend()</code></p><ol><li>需要superuser权限，可以关闭所有的后台进程</li><li>向后台发送SIGTERM信号，用于关闭事务，此时session也会被关闭，并且事务回滚</li></ol><p>那么如何知道有哪些表、哪些进程被锁住了？可以用如下SQL查出来：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-sql data-lang=sql><span class=k>select</span> <span class=o>*</span> <span class=k>from</span> <span class=n>pg_locks</span> <span class=n>a</span>
<span class=k>join</span> <span class=n>pg_class</span> <span class=n>b</span> <span class=k>on</span> <span class=n>a</span><span class=p>.</span><span class=n>relation</span> <span class=o>=</span> <span class=n>b</span><span class=p>.</span><span class=n>oid</span>
<span class=k>join</span> <span class=n>pg_stat_activity</span> <span class=k>c</span> <span class=k>on</span> <span class=n>a</span><span class=p>.</span><span class=n>pid</span> <span class=o>=</span> <span class=k>c</span><span class=p>.</span><span class=n>pid</span>
<span class=k>where</span> <span class=n>a</span><span class=p>.</span><span class=k>mode</span> <span class=k>like</span> <span class=s1>&#39;%ExclusiveLock%&#39;</span><span class=p>;</span>
</code></pre></td></tr></table></div></div><p>这里查的是排它锁，也可以精确到行排它锁或者共享锁之类的。这里有几个重要的column：<code>a.pid</code>是进程id，<code>b.relname</code>是表名、约束名或者索引名，<code>a.mode</code>是锁类型。</p><h3 id=杀掉指定表指定锁的进程>杀掉指定表指定锁的进程</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-sql data-lang=sql><span class=k>select</span> <span class=n>pg_cancel_backend</span><span class=p>(</span><span class=n>a</span><span class=p>.</span><span class=n>pid</span><span class=p>)</span> <span class=k>from</span> <span class=n>pg_locks</span> <span class=n>a</span>
<span class=k>join</span> <span class=n>pg_class</span> <span class=n>b</span> <span class=k>on</span> <span class=n>a</span><span class=p>.</span><span class=n>relation</span> <span class=o>=</span> <span class=n>b</span><span class=p>.</span><span class=n>oid</span>
<span class=k>join</span> <span class=n>pg_stat_activity</span> <span class=k>c</span> <span class=k>on</span> <span class=n>a</span><span class=p>.</span><span class=n>pid</span> <span class=o>=</span> <span class=k>c</span><span class=p>.</span><span class=n>pid</span>
<span class=k>where</span> <span class=n>b</span><span class=p>.</span><span class=n>relname</span> <span class=k>ilike</span> <span class=s1>&#39;表名&#39;</span> 
<span class=k>and</span> <span class=n>a</span><span class=p>.</span><span class=k>mode</span> <span class=k>like</span> <span class=s1>&#39;%ExclusiveLock%&#39;</span><span class=p>;</span>

<span class=c1>--或者使用更加霸道的pg_terminate_backend()：
</span><span class=c1></span><span class=k>select</span> <span class=n>pg_terminate_backend</span><span class=p>(</span><span class=n>a</span><span class=p>.</span><span class=n>pid</span><span class=p>)</span> <span class=k>from</span> <span class=n>pg_locks</span> <span class=n>a</span>
<span class=k>join</span> <span class=n>pg_class</span> <span class=n>b</span> <span class=k>on</span> <span class=n>a</span><span class=p>.</span><span class=n>relation</span> <span class=o>=</span> <span class=n>b</span><span class=p>.</span><span class=n>oid</span>
<span class=k>join</span> <span class=n>pg_stat_activity</span> <span class=k>c</span> <span class=k>on</span> <span class=n>a</span><span class=p>.</span><span class=n>pid</span> <span class=o>=</span> <span class=k>c</span><span class=p>.</span><span class=n>pid</span>
<span class=k>where</span> <span class=n>b</span><span class=p>.</span><span class=n>relname</span> <span class=k>ilike</span> <span class=s1>&#39;表名&#39;</span> 
<span class=k>and</span> <span class=n>a</span><span class=p>.</span><span class=k>mode</span> <span class=k>like</span> <span class=s1>&#39;%ExclusiveLock%&#39;</span><span class=p>;</span>
</code></pre></td></tr></table></div></div><p>另外需要注意的是，<code>pg_terminate_backend()</code>会把session也关闭，此时sessionId会失效，可能会导致系统账号退出登录，需要清除掉浏览器的缓存cookie（我们系统遇到的情况是这样的）。</p><h2 id=参考链接>参考链接</h2><ul><li><a href=https://blog.csdn.net/s630730701/article/details/80870206 target=_blank rel="noopener noreffer">pgadmin4远程连接 postgresql服务</a></li><li><a href=https://blog.csdn.net/ll136078/article/details/12747403 target=_blank rel="noopener noreffer">PostgreSQL 允许远程访问设置方法</a></li><li><a href=https://blog.csdn.net/hatofdragon/article/details/54601121 target=_blank rel="noopener noreffer">postgresql字符转义</a></li><li><a href=https://www.liangzl.com/get-article-detail-16499.html target=_blank rel="noopener noreffer">pg_cancel_backend与pg_terminate_backend函数的区别</a></li><li><a href=https://blog.csdn.net/lt89102476/article/details/84759743 target=_blank rel="noopener noreffer">pg_cancel_backend()和pg_terminate_backend()</a></li></ul><div class="details admonition warning open"><div class="details-summary admonition-title"><i class="icon fas fa-exclamation-triangle fa-fwwarning"></i>警告<i class="details-icon fas fa-angle-right fa-fw"></i></div><div class=details-content><div class=admonition-content>本文最后更新于 <span class=timeago datetime=2022-03-19T22:41:17 title="March 19, 2022">March 19, 2022</span>，文中内容可能已过时，请谨慎使用。</div></div></div><div class=post-reward><input type=checkbox name=reward id=reward hidden>
<label class=reward-button for=reward>赞赏支持</label><div class=qr-code><label class=qr-code-image for=reward><img class=image src=https://lewky.cn/images/reward/wechat.png>
<span>微信打赏</span></label>
<label class=qr-code-image for=reward><img class=image src=https://lewky.cn/images/reward/alipay.png>
<span>支付宝打赏</span></label></div></div></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>更新于 2022-03-19</span></div><div class=post-info-license><span><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-markdown href=/posts/postgresql-issues/index.md target=_blank>阅读原始文档</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 Twitter" data-sharer=twitter data-url=https://lewky.cn/posts/postgresql-issues/ data-title=PostgreSQL问题汇总 data-hashtags=工作记录><i class="fab fa-twitter fa-fw"></i></a><a href=javascript:void(0); title="分享到 Facebook" data-sharer=facebook data-url=https://lewky.cn/posts/postgresql-issues/ data-hashtag=工作记录><i class="fab fa-facebook-square fa-fw"></i></a><a href=javascript:void(0); title="分享到 Hacker News" data-sharer=hackernews data-url=https://lewky.cn/posts/postgresql-issues/ data-title=PostgreSQL问题汇总><i class="fab fa-hacker-news fa-fw"></i></a><a href=javascript:void(0); title="分享到 Line" data-sharer=line data-url=https://lewky.cn/posts/postgresql-issues/ data-title=PostgreSQL问题汇总><i data-svg-src=https://unpkg.com/simple-icons@2.14.0/icons/line.svg></i></a><a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://lewky.cn/posts/postgresql-issues/ data-title=PostgreSQL问题汇总><i class="fab fa-weibo fa-fw"></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/tags/%E5%B7%A5%E4%BD%9C%E8%AE%B0%E5%BD%95/>工作记录</a></section><section><span><a href=javascript:void(0); onclick=window.history.back();>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/posts/postgresql-psql.html/ class=prev rel=prev title="PostgreSQL - psql使用汇总"><i class="fas fa-angle-left fa-fw"></i>PostgreSQL - psql使用汇总</a>
<a href=/posts/9cdb4f66.html/ class=next rel=next title="Google hosts - 简单介绍与使用方法">Google hosts - 简单介绍与使用方法<i class="fas fa-angle-right fa-fw"></i></a></div></div><div id=comments><div id=waline></div><script src=/js/Waline.min.js></script><script>new Waline({el:'#waline',meta:["nick","mail","link"],requiredMeta:["nick","mail"],login:"force",placeholder:"为防恶意灌水攻击，评论前需注册并登录，望见谅~",serverURL:"https://comment.lewky.cn/",avatarCDN:"https://cravatar.cn/avatar/",pageSize:20,avatar:"retro",lang:"zh-CN",visitor:true,highlight:true,uploadImage:false,emoji:['https:\/\/lewky.cn/images/emoji/嘉然今天吃什么','https:\/\/lewky.cn/images/emoji/大航海嘉然','https:\/\/lewky.cn/images/emoji/向晚大魔王','https:\/\/lewky.cn/images/emoji/贝拉kira','https:\/\/lewky.cn/images/emoji/珈乐Carol','https:\/\/lewky.cn/images/emoji/乃琳Queen','https:\/\/lewky.cn/images/emoji/EveOneCat','https:\/\/lewky.cn/images/emoji/weibo','https:\/\/lewky.cn/images/emoji/滑稽','https:\/\/lewky.cn/images/emoji/default']});</script></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line><span id=run-time></span>|
<a href=http://rssblog.vercel.app/ target=_blank rel=noopener title=RSSBlog><i class="fas fa-fw fa-inbox"></i>&nbsp;RSSBlog</a></div><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2018 - 2025</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank>雨临Lewis</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span><span class=icp-splitter>&nbsp;|&nbsp;</span><br class=icp-br><span class=icp><a target=_blank href=http://www.beian.miit.gov.cn/ style=font-weight:700>粤ICP备19103822</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到顶部><i class="fas fa-arrow-up fa-fw"></i></a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fas fa-comment fa-fw"></i></a></div><div class=sidebar_wo><div id=leimu><img src=https://lewky.cn/images/b2t/leimuA.png alt=雷姆 onmouseover="this.src='https:\/\/lewky.cn/images/b2t/leimuB.png'" onmouseout="this.src='https:\/\/lewky.cn/images/b2t/leimuA.png'" title=回到顶部></div><div class=sidebar_wo id=lamu><img src=https://lewky.cn/images/b2t/lamuA.png alt=雷姆 onmouseover="this.src='https:\/\/lewky.cn/images/b2t/lamuB.png'" onmouseout="this.src='https:\/\/lewky.cn/images/b2t/lamuA.png'" title=回到底部></div></div><link rel=stylesheet href=https://unpkg.com/lightgallery.js@1.2.0/dist/css/lightgallery.min.css><script type=text/javascript src=https://unpkg.com/smooth-scroll@16.1.3/dist/smooth-scroll.min.js></script><script type=text/javascript src=https://unpkg.com/lazysizes@5.2.2/lazysizes.min.js></script><script type=text/javascript src=https://unpkg.com/lightgallery.js@1.2.0/dist/js/lightgallery.min.js></script><script type=text/javascript src=https://unpkg.com/lg-thumbnail.js@1.2.0/dist/lg-thumbnail.min.js></script><script type=text/javascript src=https://unpkg.com/lg-zoom.js@1.2.0/dist/lg-zoom.min.js></script><script type=text/javascript src=https://unpkg.com/clipboard@2.0.6/dist/clipboard.min.js></script><script type=text/javascript src=https://unpkg.com/sharer.js@0.4.0/sharer.min.js></script><script type=text/javascript>window.config={"code":{"copyTitle":"复制到剪贴板","maxShownLines":30},"comment":{},"lightGallery":{"actualSize":false,"exThumbImage":"data-thumbnail","hideBarsDelay":2000,"selector":".lightgallery","speed":400,"thumbContHeight":80,"thumbWidth":80,"thumbnail":true}};</script><script type=text/javascript src=/js/theme.min.js></script><script type=text/javascript src=https://unpkg.com/jquery@2.1.3/dist/jquery.min.js></script><script type=text/javascript src=https://unpkg.com/jquery-backstretch@2.1.18/jquery.backstretch.min.js></script><script>var $cdnPrefix="https://lewky.cn";</script><script type=text/javascript src=/js/custom.js></script><script>var _hmt=_hmt||[];(function(){var hm=document.createElement("script");hm.src="https://hm.baidu.com/hm.js?6f278ed0fdb01edb3b1e7398379e5432";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(hm,s);})();</script></body></html>