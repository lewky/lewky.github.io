<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta http-equiv=x-ua-compatible content="IE=edge, chrome=1"><title>JPA/Hibernate问题汇总 - Yulin Lewis' Blog</title><meta name=keywords content="雨临Lewis,Java,hugo,hexo,博客"><meta name=Description content="不想当写手的码农不是好咸鱼_(xз」∠)_"><meta property="og:title" content="JPA/Hibernate问题汇总"><meta property="og:description" content="懒加载异常 - JsonMappingException: could not initialize proxy
查询数据时报懒加载异常：


1
2
3
4
5


Caused by: org.hibernate.LazyInitializationException: could not initialize proxy [com.cbxsoftware.cbx.attachment.entity.RefAttachment#c109ec36e60c4a89a10eabc72416d984] - no Session
	at org.hibernate.proxy.AbstractLazyInitializer.initialize(AbstractLazyInitializer.java:169)
	at org.hibernate.proxy.AbstractLazyInitializer.getImplementation(AbstractLazyInitializer.java:309)
	at org.hibernate.proxy.pojo.bytebuddy.ByteBuddyInterceptor.intercept(ByteBuddyInterceptor.java:45)
	at org.hibernate.proxy.ProxyConfiguration$InterceptorDispatcher.intercept(ProxyConfiguration.java:95)"><meta property="og:type" content="article"><meta property="og:url" content="https://lewky.cn/posts/jpa-hibernate.html/"><meta property="og:image" content="https://lewky.cn/logo.png"><meta property="article:published_time" content="2021-04-01T00:07:30+08:00"><meta property="article:modified_time" content="2021-05-26T00:07:30+08:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://lewky.cn/logo.png"><meta name=twitter:title content="JPA/Hibernate问题汇总"><meta name=twitter:description content="懒加载异常 - JsonMappingException: could not initialize proxy
查询数据时报懒加载异常：


1
2
3
4
5


Caused by: org.hibernate.LazyInitializationException: could not initialize proxy [com.cbxsoftware.cbx.attachment.entity.RefAttachment#c109ec36e60c4a89a10eabc72416d984] - no Session
	at org.hibernate.proxy.AbstractLazyInitializer.initialize(AbstractLazyInitializer.java:169)
	at org.hibernate.proxy.AbstractLazyInitializer.getImplementation(AbstractLazyInitializer.java:309)
	at org.hibernate.proxy.pojo.bytebuddy.ByteBuddyInterceptor.intercept(ByteBuddyInterceptor.java:45)
	at org.hibernate.proxy.ProxyConfiguration$InterceptorDispatcher.intercept(ProxyConfiguration.java:95)"><meta name=application-name content="雨临Lewis的博客"><meta name=apple-mobile-web-app-title content="雨临Lewis的博客"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://lewky.cn/posts/jpa-hibernate.html/><link rel=prev href=https://lewky.cn/posts/docsify-0.html/><link rel=next href=https://lewky.cn/posts/plantuml-class-diagram.html/><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.13.0/css/all.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@3.7.2/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"JPA/Hibernate问题汇总","inLanguage":"","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/lewky.cn\/posts\/jpa-hibernate.html\/"},"genre":"posts","keywords":"JPA, Hibernate, 懒加载","wordcount":4314,"url":"https:\/\/lewky.cn\/posts\/jpa-hibernate.html\/","datePublished":"2021-04-01T00:07:30+08:00","dateModified":"2021-05-26T00:07:30+08:00","license":"This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher":{"@type":"Organization","name":"雨临Lewis","logo":"https:\/\/lewky.cn\/images\/avatar.jpg"},"author":{"@type":"Person","name":"雨临Lewis"},"description":""}</script></head><body header-desktop=fixed header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem('theme')?localStorage.getItem('theme')==='dark':('auto'==='auto'?window.matchMedia('(prefers-color-scheme: dark)').matches:'auto'==='dark'))&&document.body.setAttribute('theme','dark');</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><a href=https://github.com/lewky class=github-corner target=_blank title="Follow me on GitHub" aria-label="Follow me on GitHub"><svg width="3.5rem" height="3.5rem" viewBox="0 0 250 250" style="fill:#70b7fd;color:#fff;position:absolute;top:0;border:0;left:0;transform:scale(-1,1)" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentcolor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentcolor" class="octo-body"/></svg></a><div class=header-title><a href=/ title="Yulin Lewis' Blog"><span class=header-title-pre><i class="fas fa-fw fa-atom"></i></span>雨临Lewis</a></div><div class=menu><div class=menu-inner><div class=dropdown><a href=/posts/ class="menu-item menu-more dropbtn"><i class="fas fa-fw fa-archive"></i>归档</a><div class="menu-more-content dropdown-content"><a href=/categories/><i class="fas fa-fw fa-th"></i>分类 </a><a href=/tags/><i class="fas fa-fw fa-tag"></i>标签 </a><a href=/hot/ title=文章热度Top15><i class="fas fa-fw fa-fire"></i>热度 </a><a href=/posts/d65a1577.html/ title=密码是123><i class="fas fa-fw fa-pen-nib"></i>随笔 </a><a href=/about/><i class="fas fa-fw fa-at"></i>关于</a></div></div><a class=menu-item href=/friends/><i class="fas fa-fw fa-link"></i>友链</a><div class=dropdown><a href=javascript:void(0); class="menu-item menu-more dropbtn"><i class="fas fa-fw fa-fan fa-spin"></i>趣味</a><div class="menu-more-content dropdown-content"><a href=/funny/high/ title="前方高能♂ 小心外放！" target=_blank rel=noopener><i class="fas fa-fw fa-dizzy"></i>燥起来！ </a><a href=/funny/mikutap/ title=初音未来音乐游戏 target=_blank rel=noopener><i class="fas fa-fw fa-music"></i>在线打碟 </a><a href=/funny/catch-the-cat/ title=逮住那只猫!><i class="fas fa-fw fa-cat"></i>抓住猫咪</a></div></div><div class=dropdown><a href=/ class="menu-item menu-more dropbtn" title=回到首页><i class="fas fa-fw fa-atom"></i>站点</a><div class="menu-more-content dropdown-content"><a href=/bbs/ title=来留言吧~><i class="fas fa-fw fa-comment"></i>公告留言 </a><a href=https://seo.chinaz.com target=_blank rel=noopener><i class="fas fa-fw fa-chart-line"></i>SEO查询 </a><a href=https://www.ping.cn/http/lewky.cn target=_blank rel=noopener><i class="fas fa-fw fa-bezier-curve"></i>网站测速 </a><a href=/posts/e62c38c4.html/><i class="fas fa-fw fa-cog fa-spin"></i>建站日志</a></div></div><div class=dropdown><a href=javascript:void(0); class="menu-item menu-more dropbtn"><i class="fas fa-fw fa-book"></i>文档</a><div class="menu-more-content dropdown-content"><a href=https://gohugo.io/documentation/ target=_blank rel=noopener><i class="fas fa-fw fa-star"></i>Hugo文档 </a><a href=https://javanote.doc.lewky.cn/ title=尚在完善中~ target=_blank rel=noopener><i class="fab fa-fw fa-java"></i>Java 笔记</a></div></div><a class=menu-item href=/search/><i class="fas fa-fw fa-search"></i>搜索
</a><span class="menu-item delimiter"></span><a href=https://travellings.link target=_blank class=menu-item rel=noopener title=开往-友链接力><i class="fas fa-fw fa-subway"></i></a><a href=https://rssblog.vercel.app/ class=menu-item target=_blank rel=noopener title=RSSBlog><i class="fas fa-fw fa-inbox"></i></a><a href=https://github.com/lewky class=menu-item target=_blank rel=noopener title=GitHub><i class="fab fa-fw fa-github"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Yulin Lewis' Blog"><span class=header-title-pre><i class="fas fa-fw fa-atom"></i></span>雨临Lewis</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=dropdown><a href=/posts/ class="menu-item menu-more dropbtn"><i class="fas fa-fw fa-archive"></i>归档</a><div class="menu-more-content dropdown-content"><a href=/categories/><i class="fas fa-fw fa-th"></i>分类 </a><a href=/tags/><i class="fas fa-fw fa-tag"></i>标签 </a><a href=/hot/ title=文章热度Top15><i class="fas fa-fw fa-fire"></i>热度 </a><a href=/posts/d65a1577.html/ title=密码是123><i class="fas fa-fw fa-pen-nib"></i>随笔 </a><a href=/about/><i class="fas fa-fw fa-at"></i>关于</a></div></div><a class=menu-item href=/friends/><i class="fas fa-fw fa-link"></i>友链</a><div class=dropdown><a href=javascript:void(0); class="menu-item menu-more dropbtn"><i class="fas fa-fw fa-fan fa-spin"></i>趣味</a><div class="menu-more-content dropdown-content"><a href=/funny/high/ title="前方高能♂ 小心外放！" target=_blank rel=noopener><i class="fas fa-fw fa-dizzy"></i>燥起来！ </a><a href=/funny/mikutap/ title=初音未来音乐游戏 target=_blank rel=noopener><i class="fas fa-fw fa-music"></i>在线打碟 </a><a href=/funny/catch-the-cat/ title=逮住那只猫!><i class="fas fa-fw fa-cat"></i>抓住猫咪</a></div></div><div class=dropdown><a href=/ class="menu-item menu-more dropbtn" title=回到首页><i class="fas fa-fw fa-atom"></i>站点</a><div class="menu-more-content dropdown-content"><a href=/bbs/ title=来留言吧~><i class="fas fa-fw fa-comment"></i>公告留言 </a><a href=https://seo.chinaz.com target=_blank rel=noopener><i class="fas fa-fw fa-chart-line"></i>SEO查询 </a><a href=https://www.ping.cn/http/lewky.cn target=_blank rel=noopener><i class="fas fa-fw fa-bezier-curve"></i>网站测速 </a><a href=/posts/e62c38c4.html/><i class="fas fa-fw fa-cog fa-spin"></i>建站日志</a></div></div><div class=dropdown><a href=javascript:void(0); class="menu-item menu-more dropbtn"><i class="fas fa-fw fa-book"></i>文档</a><div class="menu-more-content dropdown-content"><a href=https://gohugo.io/documentation/ target=_blank rel=noopener><i class="fas fa-fw fa-star"></i>Hugo文档 </a><a href=https://javanote.doc.lewky.cn/ title=尚在完善中~ target=_blank rel=noopener><i class="fab fa-fw fa-java"></i>Java 笔记</a></div></div><a class=menu-item href=/search/><i class="fas fa-fw fa-search"></i>搜索</a>
<a href=https://travellings.link target=_blank class=menu-item rel=noopener title=开往-友链接力><i class="fas fa-fw fa-subway"></i></a><a href=https://rssblog.vercel.app/ class=menu-item target=_blank rel=noopener title=RSSBlog><i class="fas fa-fw fa-inbox"></i></a><a href=https://github.com/lewky class=menu-item target=_blank rel=noopener title=GitHub><i class="fab fa-fw fa-github"></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>目录</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animated flipInX">JPA/Hibernate问题汇总</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw"></i>雨临Lewis</a></span>&nbsp;<span class=post-category>收录于 <a href=/categories/jpa/><i class="far fa-folder fa-fw"></i>JPA</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2021-04-01>2021-04-01</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 4314 字
<i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 9 分钟&nbsp;</div></div><div class="details toc" id=toc-static kept><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ol><li><a href=#懒加载异常---jsonmappingexception-could-not-initialize-proxy>懒加载异常 - JsonMappingException: could not initialize proxy</a><ol><li><a href=#解决方法一>解决方法一</a></li><li><a href=#解决方法二>解决方法二</a></li><li><a href=#懒加载源码分析>懒加载源码分析</a></li></ol></li><li><a href=#joincolumn注解无法找回数据导致报错>@JoinColumn注解无法找回数据导致报错</a></li><li><a href=#懒加载导致的n--1问题>懒加载导致的N + 1问题</a></li><li><a href=#cannot-simultaneously-fetch-multiple-bags异常>cannot simultaneously fetch multiple bags异常</a></li><li><a href=#unexpectedrollbackexception异常>UnexpectedRollbackException异常</a></li><li><a href=#参考链接>参考链接</a></li></ol></nav></div></div><div class=content id=content><h2 id=懒加载异常---jsonmappingexception-could-not-initialize-proxy>懒加载异常 - JsonMappingException: could not initialize proxy</h2><p>查询数据时报懒加载异常：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=n>Caused</span> <span class=n>by</span><span class=o>:</span> <span class=n>org</span><span class=o>.</span><span class=na>hibernate</span><span class=o>.</span><span class=na>LazyInitializationException</span><span class=o>:</span> <span class=n>could</span> <span class=n>not</span> <span class=n>initialize</span> <span class=n>proxy</span> <span class=o>[</span><span class=n>com</span><span class=o>.</span><span class=na>cbxsoftware</span><span class=o>.</span><span class=na>cbx</span><span class=o>.</span><span class=na>attachment</span><span class=o>.</span><span class=na>entity</span><span class=o>.</span><span class=na>RefAttachment</span><span class=err>#</span><span class=n>c109ec36e60c4a89a10eabc72416d984</span><span class=o>]</span> <span class=o>-</span> <span class=n>no</span> <span class=n>Session</span>
	<span class=n>at</span> <span class=n>org</span><span class=o>.</span><span class=na>hibernate</span><span class=o>.</span><span class=na>proxy</span><span class=o>.</span><span class=na>AbstractLazyInitializer</span><span class=o>.</span><span class=na>initialize</span><span class=o>(</span><span class=n>AbstractLazyInitializer</span><span class=o>.</span><span class=na>java</span><span class=o>:</span><span class=n>169</span><span class=o>)</span>
	<span class=n>at</span> <span class=n>org</span><span class=o>.</span><span class=na>hibernate</span><span class=o>.</span><span class=na>proxy</span><span class=o>.</span><span class=na>AbstractLazyInitializer</span><span class=o>.</span><span class=na>getImplementation</span><span class=o>(</span><span class=n>AbstractLazyInitializer</span><span class=o>.</span><span class=na>java</span><span class=o>:</span><span class=n>309</span><span class=o>)</span>
	<span class=n>at</span> <span class=n>org</span><span class=o>.</span><span class=na>hibernate</span><span class=o>.</span><span class=na>proxy</span><span class=o>.</span><span class=na>pojo</span><span class=o>.</span><span class=na>bytebuddy</span><span class=o>.</span><span class=na>ByteBuddyInterceptor</span><span class=o>.</span><span class=na>intercept</span><span class=o>(</span><span class=n>ByteBuddyInterceptor</span><span class=o>.</span><span class=na>java</span><span class=o>:</span><span class=n>45</span><span class=o>)</span>
	<span class=n>at</span> <span class=n>org</span><span class=o>.</span><span class=na>hibernate</span><span class=o>.</span><span class=na>proxy</span><span class=o>.</span><span class=na>ProxyConfiguration$InterceptorDispatcher</span><span class=o>.</span><span class=na>intercept</span><span class=o>(</span><span class=n>ProxyConfiguration</span><span class=o>.</span><span class=na>java</span><span class=o>:</span><span class=n>95</span><span class=o>)</span>
</code></pre></td></tr></table></div></div><p>报错很明显，是由于hibernate的懒加载引起的。项目使用的是SpringBoot框架，JPA默认使用的是hibernate的实现，而hibernate的懒加载机制其实就是延迟加载对象，如果没有在session关闭前使用到对象里除id以外的属性时，就只会返回一个没有初始化过的包含了id的代理类。很多时候，这个代理类会引发上述的异常。</p><p>简单说一下为什么会触发懒加载异常，首先hibernate开启一个session（会话），然后开启transaction（事务），接着发出sql找回数据并组装成pojo（或者说entity、model），这时候如果pojo里有懒加载的对象，并不会去发出sql查询db，而是直接返回一个懒加载的代理对象，这个对象里只有id。</p><p>如果接下来没有其他的操作去访问这个代理对象除了id以外的属性，就不会去初始化这个代理对象，也就不会去发出sql查找db。接着事务提交，session关闭。如果这时候再去访问代理对象除了id以外的属性时，就会报上述的懒加载异常，原因是这时候已经没有session了，无法初始化懒加载的代理对象。</p><h3 id=解决方法一>解决方法一</h3><p>如果是spring继承的hibernate，根据上述的原因，可以延长session的生命周期，但是这里用的是SpringBoot的JPA，处理方法不同，需要在<code>application.properties</code>配置下懒加载相关的东西：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-xml data-lang=xml>spring.jpa.properties.hibernate.enable_lazy_load_no_trans=true
</code></pre></td></tr></table></div></div><p>进行该配置后，可以在session关闭时也能另外开启一个新的session和事务来访问db以取回懒加载对象的数据。</p><h3 id=解决方法二>解决方法二</h3><p>因为该懒加载异常是缺少session导致的，那么可以通过在方法前添加事务注解<code>@Transactional</code>的方式来解决，只要事务没有提交，session就不会关闭，自然就不会出现上述的懒加载异常。不过由于该事务注解是用Spring AOP实现的，存在着一些坑，比如类内直接调用无效或者对非public方法无效等，需要多加注意。</p><p>当使用了上述两种方法后，发现不再触发<code>LazyInitializationException</code>，但是却发生了另一个新的异常<code>InvalidDefinitionException</code>：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=n>com</span><span class=o>.</span><span class=na>fasterxml</span><span class=o>.</span><span class=na>jackson</span><span class=o>.</span><span class=na>databind</span><span class=o>.</span><span class=na>exc</span><span class=o>.</span><span class=na>InvalidDefinitionException</span><span class=o>:</span> <span class=n>No</span> <span class=n>serializer</span> <span class=n>found</span> <span class=k>for</span> <span class=kd>class</span> <span class=nc>org</span><span class=o>.</span><span class=na>hibernate</span><span class=o>.</span><span class=na>proxy</span><span class=o>.</span><span class=na>pojo</span><span class=o>.</span><span class=na>bytebuddy</span><span class=o>.</span><span class=na>ByteBuddyInterceptor</span> <span class=n>and</span> <span class=n>no</span> <span class=n>properties</span> <span class=n>discovered</span> <span class=n>to</span> <span class=n>create</span> <span class=nf>BeanSerializer</span> <span class=o>(</span><span class=n>to</span> <span class=n>avoid</span> <span class=n>exception</span><span class=o>,</span> <span class=n>disable</span> <span class=n>SerializationFeature</span><span class=o>.</span><span class=na>FAIL_ON_EMPTY_BEANS</span><span class=o>)</span> <span class=o>(</span><span class=n>through</span> <span class=n>reference</span> <span class=n>chain</span><span class=o>:</span> <span class=n>com</span><span class=o>.</span><span class=na>cbxsoftware</span><span class=o>.</span><span class=na>cbx</span><span class=o>.</span><span class=na>item</span><span class=o>.</span><span class=na>elasticsearch</span><span class=o>.</span><span class=na>entity</span><span class=o>.</span><span class=na>ItemEstc</span><span class=o>[</span><span class=s>&#34;mainEntity&#34;</span><span class=o>]-&gt;</span><span class=n>com</span><span class=o>.</span><span class=na>cbxsoftware</span><span class=o>.</span><span class=na>cbx</span><span class=o>.</span><span class=na>item</span><span class=o>.</span><span class=na>entity</span><span class=o>.</span><span class=na>Item</span><span class=o>[</span><span class=s>&#34;image&#34;</span><span class=o>]-&gt;</span><span class=n>com</span><span class=o>.</span><span class=na>cbxsoftware</span><span class=o>.</span><span class=na>cbx</span><span class=o>.</span><span class=na>image</span><span class=o>.</span><span class=na>entity</span><span class=o>.</span><span class=na>RefImage</span><span class=o>[</span><span class=s>&#34;propFormat&#34;</span><span class=o>]-&gt;</span><span class=n>com</span><span class=o>.</span><span class=na>cbxsoftware</span><span class=o>.</span><span class=na>cbx</span><span class=o>.</span><span class=na>attachment</span><span class=o>.</span><span class=na>entity</span><span class=o>.</span><span class=na>RefAttachment$HibernateProxy$vTKSYzrN</span><span class=o>[</span><span class=s>&#34;hibernateLazyInitializer&#34;</span><span class=o>])</span>
	<span class=n>at</span> <span class=n>com</span><span class=o>.</span><span class=na>fasterxml</span><span class=o>.</span><span class=na>jackson</span><span class=o>.</span><span class=na>databind</span><span class=o>.</span><span class=na>exc</span><span class=o>.</span><span class=na>InvalidDefinitionException</span><span class=o>.</span><span class=na>from</span><span class=o>(</span><span class=n>InvalidDefinitionException</span><span class=o>.</span><span class=na>java</span><span class=o>:</span><span class=n>77</span><span class=o>)</span>
	<span class=n>at</span> <span class=n>com</span><span class=o>.</span><span class=na>fasterxml</span><span class=o>.</span><span class=na>jackson</span><span class=o>.</span><span class=na>databind</span><span class=o>.</span><span class=na>SerializerProvider</span><span class=o>.</span><span class=na>reportBadDefinition</span><span class=o>(</span><span class=n>SerializerProvider</span><span class=o>.</span><span class=na>java</span><span class=o>:</span><span class=n>1191</span><span class=o>)</span>
	<span class=n>at</span> <span class=n>com</span><span class=o>.</span><span class=na>fasterxml</span><span class=o>.</span><span class=na>jackson</span><span class=o>.</span><span class=na>databind</span><span class=o>.</span><span class=na>DatabindContext</span><span class=o>.</span><span class=na>reportBadDefinition</span><span class=o>(</span><span class=n>DatabindContext</span><span class=o>.</span><span class=na>java</span><span class=o>:</span><span class=n>313</span><span class=o>)</span>
	<span class=n>at</span> <span class=n>com</span><span class=o>.</span><span class=na>fasterxml</span><span class=o>.</span><span class=na>jackson</span><span class=o>.</span><span class=na>databind</span><span class=o>.</span><span class=na>ser</span><span class=o>.</span><span class=na>impl</span><span class=o>.</span><span class=na>UnknownSerializer</span><span class=o>.</span><span class=na>failForEmpty</span><span class=o>(</span><span class=n>UnknownSerializer</span><span class=o>.</span><span class=na>java</span><span class=o>:</span><span class=n>71</span><span class=o>)</span>
	<span class=n>at</span> <span class=n>com</span><span class=o>.</span><span class=na>fasterxml</span><span class=o>.</span><span class=na>jackson</span><span class=o>.</span><span class=na>databind</span><span class=o>.</span><span class=na>ser</span><span class=o>.</span><span class=na>impl</span><span class=o>.</span><span class=na>UnknownSerializer</span><span class=o>.</span><span class=na>serialize</span><span class=o>(</span><span class=n>UnknownSerializer</span><span class=o>.</span><span class=na>java</span><span class=o>:</span><span class=n>33</span><span class=o>)</span>
	<span class=n>at</span> <span class=n>com</span><span class=o>.</span><span class=na>fasterxml</span><span class=o>.</span><span class=na>jackson</span><span class=o>.</span><span class=na>databind</span><span class=o>.</span><span class=na>ser</span><span class=o>.</span><span class=na>BeanPropertyWriter</span><span class=o>.</span><span class=na>serializeAsField</span><span class=o>(</span><span class=n>BeanPropertyWriter</span><span class=o>.</span><span class=na>java</span><span class=o>:</span><span class=n>727</span><span class=o>)</span>
	<span class=n>at</span> <span class=n>com</span><span class=o>.</span><span class=na>fasterxml</span><span class=o>.</span><span class=na>jackson</span><span class=o>.</span><span class=na>databind</span><span class=o>.</span><span class=na>ser</span><span class=o>.</span><span class=na>std</span><span class=o>.</span><span class=na>BeanSerializerBase</span><span class=o>.</span><span class=na>serializeFields</span><span class=o>(</span><span class=n>BeanSerializerBase</span><span class=o>.</span><span class=na>java</span><span class=o>:</span><span class=n>719</span><span class=o>)</span>
	<span class=o>...</span>
</code></pre></td></tr></table></div></div><p>这个异常是由于hibernate在代理类里添加了一个属性<code>hibernateLazyInitializer</code>，当该对象转换成json的时候就会报错。解决方法是将该属性过滤掉，可以在对应的类名或者公共类前加上如下注解：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=nd>@JsonIgnoreProperties</span><span class=o>(</span><span class=n>value</span> <span class=o>=</span> <span class=o>{</span> <span class=s>&#34;hibernateLazyInitializer&#34;</span> <span class=o>})</span>
</code></pre></td></tr></table></div></div><h3 id=懒加载源码分析>懒加载源码分析</h3><p>因为对懒加载异常的发生有些好奇，所以看了下hibernate的源码，这里简单分析下，另外我看的是两个源码包如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>spring-orm-5.1.5.RELEASE.jar
hibernate-core-5.3.7.Final.jar
</code></pre></td></tr></table></div></div><p>首先是关于<code>spring.jpa.properties.hibernate.enable_lazy_load_no_trans=true</code>的配置，前面半截是因为JPA集成了hibernate的配置，所以在hibernate中，这个配置应该是<code>hibernate.enable_lazy_load_no_trans=true</code>。</p><p>在hibernate的一个常量接口<code>org.hibernate.cfg.AvailableSettings</code>中定义了各种配置常量，其中就包括上述这个配置：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=n>String</span> <span class=n>ENABLE_LAZY_LOAD_NO_TRANS</span> <span class=o>=</span> <span class=s>&#34;hibernate.enable_lazy_load_no_trans&#34;</span><span class=o>;</span>
</code></pre></td></tr></table></div></div><p>在启动项目的时候会读取配置文件，将其解析为一个<code>HashMap&lt;K,V></code>，这些参数在new<code>EntityManagerFactoryBuilderImpl</code>的时候被使用到，上面的常量会在<code>org.hibernate.boot.internal.SessionFactoryOptionsBuilder</code>里被拿来初始化：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=k>this</span><span class=o>.</span><span class=na>initializeLazyStateOutsideTransactions</span> <span class=o>=</span> <span class=n>cfgService</span><span class=o>.</span><span class=na>getSetting</span><span class=o>(</span> <span class=n>ENABLE_LAZY_LOAD_NO_TRANS</span><span class=o>,</span> <span class=n>BOOLEAN</span><span class=o>,</span> <span class=kc>false</span> <span class=o>);</span>
</code></pre></td></tr></table></div></div><p>因为在配置文件里配置了该变量的值为true，所以这里在初始化的时候就会把<code>initializeLazyStateOutsideTransactions</code>的值设置为true。该变量由一个方法来判断其值是否为true：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java>	<span class=nd>@Override</span>
	<span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>isInitializeLazyStateOutsideTransactionsEnabled</span><span class=o>()</span> <span class=o>{</span>
		<span class=k>return</span> <span class=n>initializeLazyStateOutsideTransactions</span><span class=o>;</span>
	<span class=o>}</span>
</code></pre></td></tr></table></div></div><p>接着在组装pojo时，会为懒加载对象创建对应的代理对象，当需要获取该代理对象除id以外的属性时，就会调用<code>AbstractLazyInitializer#initialize()</code>进行初始化，逻辑如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java>	<span class=nd>@Override</span>
	<span class=kd>public</span> <span class=kd>final</span> <span class=kt>void</span> <span class=nf>initialize</span><span class=o>()</span> <span class=kd>throws</span> <span class=n>HibernateException</span> <span class=o>{</span>
		<span class=k>if</span> <span class=o>(</span> <span class=o>!</span><span class=n>initialized</span> <span class=o>)</span> <span class=o>{</span>
			<span class=k>if</span> <span class=o>(</span> <span class=n>allowLoadOutsideTransaction</span> <span class=o>)</span> <span class=o>{</span>
				<span class=n>permissiveInitialization</span><span class=o>();</span>
			<span class=o>}</span>
			<span class=k>else</span> <span class=k>if</span> <span class=o>(</span> <span class=n>session</span> <span class=o>==</span> <span class=kc>null</span> <span class=o>)</span> <span class=o>{</span>
				<span class=k>throw</span> <span class=k>new</span> <span class=n>LazyInitializationException</span><span class=o>(</span> <span class=s>&#34;could not initialize proxy [&#34;</span> <span class=o>+</span> <span class=n>entityName</span> <span class=o>+</span> <span class=s>&#34;#&#34;</span> <span class=o>+</span> <span class=n>id</span> <span class=o>+</span> <span class=s>&#34;] - no Session&#34;</span> <span class=o>);</span>
			<span class=o>}</span>
			<span class=k>else</span> <span class=k>if</span> <span class=o>(</span> <span class=o>!</span><span class=n>session</span><span class=o>.</span><span class=na>isOpen</span><span class=o>()</span> <span class=o>)</span> <span class=o>{</span>
				<span class=k>throw</span> <span class=k>new</span> <span class=n>LazyInitializationException</span><span class=o>(</span> <span class=s>&#34;could not initialize proxy [&#34;</span> <span class=o>+</span> <span class=n>entityName</span> <span class=o>+</span> <span class=s>&#34;#&#34;</span> <span class=o>+</span> <span class=n>id</span> <span class=o>+</span> <span class=s>&#34;] - the owning Session was closed&#34;</span> <span class=o>);</span>
			<span class=o>}</span>
			<span class=k>else</span> <span class=k>if</span> <span class=o>(</span> <span class=o>!</span><span class=n>session</span><span class=o>.</span><span class=na>isConnected</span><span class=o>()</span> <span class=o>)</span> <span class=o>{</span>
				<span class=k>throw</span> <span class=k>new</span> <span class=n>LazyInitializationException</span><span class=o>(</span> <span class=s>&#34;could not initialize proxy [&#34;</span> <span class=o>+</span> <span class=n>entityName</span> <span class=o>+</span> <span class=s>&#34;#&#34;</span> <span class=o>+</span> <span class=n>id</span> <span class=o>+</span> <span class=s>&#34;] - the owning Session is disconnected&#34;</span> <span class=o>);</span>
			<span class=o>}</span>
			<span class=k>else</span> <span class=o>{</span>
				<span class=n>target</span> <span class=o>=</span> <span class=n>session</span><span class=o>.</span><span class=na>immediateLoad</span><span class=o>(</span> <span class=n>entityName</span><span class=o>,</span> <span class=n>id</span> <span class=o>);</span>
				<span class=n>initialized</span> <span class=o>=</span> <span class=kc>true</span><span class=o>;</span>
				<span class=n>checkTargetState</span><span class=o>(</span><span class=n>session</span><span class=o>);</span>
			<span class=o>}</span>
		<span class=o>}</span>
		<span class=k>else</span> <span class=o>{</span>
			<span class=n>checkTargetState</span><span class=o>(</span><span class=n>session</span><span class=o>);</span>
		<span class=o>}</span>
	<span class=o>}</span>
</code></pre></td></tr></table></div></div><p>如果在配置文件中设置了<code>spring.jpa.properties.hibernate.enable_lazy_load_no_trans=true</code>，那么上述的<code>allowLoadOutsideTransaction</code>变量值就为true，则可以进入<code>permissiveInitialization()</code>方法另起session和事务，最终避免懒加载异常<code>LazyInitializationException</code>。如果没有配置该参数，那么就会由于session已关闭（即为null）而抛出<code>LazyInitializationException</code>。</p><h2 id=joincolumn注解无法找回数据导致报错>@JoinColumn注解无法找回数据导致报错</h2><p>使用<code>@JoinColumn</code>时如果无法找到对应的record，就会报错导致查询失败：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=n>javax</span><span class=o>.</span><span class=na>persistence</span><span class=o>.</span><span class=na>EntityNotFoundException</span><span class=o>:</span> <span class=n>Unable</span> <span class=n>to</span> <span class=n>find</span> <span class=n>com</span><span class=o>.</span><span class=na>cbxsoftware</span><span class=o>.</span><span class=na>rest</span><span class=o>.</span><span class=na>entity</span><span class=o>.</span><span class=na>fact</span><span class=o>.</span><span class=na>Fact</span> <span class=n>with</span> <span class=n>id</span> <span class=n>4d644cfa243b493ab34d69e4207ee5f1</span>
	<span class=n>at</span> <span class=n>org</span><span class=o>.</span><span class=na>hibernate</span><span class=o>.</span><span class=na>jpa</span><span class=o>.</span><span class=na>boot</span><span class=o>.</span><span class=na>internal</span><span class=o>.</span><span class=na>EntityManagerFactoryBuilderImpl$JpaEntityNotFoundDelegate</span><span class=o>.</span><span class=na>handleEntityNotFound</span><span class=o>(</span><span class=n>EntityManagerFactoryBuilderImpl</span><span class=o>.</span><span class=na>java</span><span class=o>:</span><span class=n>163</span><span class=o>)</span>
	<span class=n>at</span> <span class=n>org</span><span class=o>.</span><span class=na>hibernate</span><span class=o>.</span><span class=na>proxy</span><span class=o>.</span><span class=na>AbstractLazyInitializer</span><span class=o>.</span><span class=na>checkTargetState</span><span class=o>(</span><span class=n>AbstractLazyInitializer</span><span class=o>.</span><span class=na>java</span><span class=o>:</span><span class=n>286</span><span class=o>)</span>
	<span class=n>at</span> <span class=n>org</span><span class=o>.</span><span class=na>hibernate</span><span class=o>.</span><span class=na>proxy</span><span class=o>.</span><span class=na>AbstractLazyInitializer</span><span class=o>.</span><span class=na>initialize</span><span class=o>(</span><span class=n>AbstractLazyInitializer</span><span class=o>.</span><span class=na>java</span><span class=o>:</span><span class=n>181</span><span class=o>)</span>
	<span class=n>at</span> <span class=n>org</span><span class=o>.</span><span class=na>hibernate</span><span class=o>.</span><span class=na>proxy</span><span class=o>.</span><span class=na>AbstractLazyInitializer</span><span class=o>.</span><span class=na>getImplementation</span><span class=o>(</span><span class=n>AbstractLazyInitializer</span><span class=o>.</span><span class=na>java</span><span class=o>:</span><span class=n>310</span><span class=o>)</span>
	<span class=n>at</span> <span class=n>org</span><span class=o>.</span><span class=na>hibernate</span><span class=o>.</span><span class=na>proxy</span><span class=o>.</span><span class=na>pojo</span><span class=o>.</span><span class=na>bytebuddy</span><span class=o>.</span><span class=na>ByteBuddyInterceptor</span><span class=o>.</span><span class=na>intercept</span><span class=o>(</span><span class=n>ByteBuddyInterceptor</span><span class=o>.</span><span class=na>java</span><span class=o>:</span><span class=n>45</span><span class=o>)</span>
	<span class=n>at</span> <span class=n>org</span><span class=o>.</span><span class=na>hibernate</span><span class=o>.</span><span class=na>proxy</span><span class=o>.</span><span class=na>ProxyConfiguration$InterceptorDispatcher</span><span class=o>.</span><span class=na>intercept</span><span class=o>(</span><span class=n>ProxyConfiguration</span><span class=o>.</span><span class=na>java</span><span class=o>:</span><span class=n>95</span><span class=o>)</span>
</code></pre></td></tr></table></div></div><p>通过使用Hibernate提供的<code>@NotFound(action = NotFoundAction.IGNORE)</code>可以避免这个问题，该注解的默认值是<code>NotFoundAction.EXCEPTION</code>，所以hibernate在join表时查不到对应的数据就会抛出异常。</p><h2 id=懒加载导致的n--1问题>懒加载导致的N + 1问题</h2><p>Hibernate的懒加载有个让人诟病的问题，就是所谓的N + 1问题：如果一个实体里存在一个懒加载的集合对象，在查询该实体时，会发出一条SQL。当触发查询该懒加载的集合时，则会发出N条SQL。</p><p>如果这个实体比较复杂，存在多个懒加载的集合，集合对象又各自关联了其他的懒加载的集合，如果触发查询这些集合，就会发出大量的SQL去查询，对DB造成较大的负荷。</p><p>解决方法有如下几种：</p><ol><li>取消懒加载，改为<code>FetchType.EAGER</code>。</li><li>给集合对象添加<code>@Fetch(FetchMode.SUBSELECT)</code>，该注解会让Hibernate只会生成一条SQL去查询该集合。</li><li>使用<code>@NamedEntityGraph</code>和<code>@EntityGraph</code>来解决懒加载时SQL查询过多的问题，但是这种方法比较复杂。</li></ol><ul><li><a href=https://blog.csdn.net/ahilll/article/details/83107982 target=_blank rel="noopener noreffer">解决JPA懒加载典型的N+1问题-注解@NamedEntityGraph</a></li></ul><h2 id=cannot-simultaneously-fetch-multiple-bags异常>cannot simultaneously fetch multiple bags异常</h2><p>应用启动时报错：<code>org.hibernate.loader.MultipleBagFetchException: cannot simultaneously fetch multiple bags</code>，该异常由Hibernate引发，当一个实体中定义了两个及两个以上的非懒加载的集合时，即<code>fetch = FetchType.EAGER</code>，这些集合又可能关联其他的对象。Hibernate实现的JPA，默认最高抓取深度含本身级为四级(它有个属性配置是0-3)，若多方(第二级)存在重复值，则第三级中抓取的值就无法映射，就会出现 multiple bags。</p><p>简单来说，Hibernate默认会用一条SQL直接把<code>FetchType.EAGER</code>的集合也一起left join进来，如果这些集合允许重复值，且存在两个及两个以上的这些集合，而集合又可能关联其他的对象。一旦出现这种情况，Hibernate就会无法区分清楚查询回来的结果集。</p><p>解决方法有如下几种：</p><ol><li>改用懒加载<code>FetchType.LAZY</code>来加载这些集合对象。</li><li>给集合对象添加<code>@Fetch(FetchMode.SUBSELECT)</code>，该注解会让Hibernate另外生成一条SQL去查询该集合。效果类似于懒加载，也是用分开的SQL去查询，区别是这个是非懒加载。</li><li>使用Set集合来替代List集合。</li><li>使用<code>@IndexColumn</code>，该注解允许你指明存放索引值的字段，目的跟Set容器不允许重复元素的道理一样。但是该注解以废弃，官方推荐使用的是JPA规范的<code>@OrderColumn</code>。</li></ol><p>前两种方法比较常用，不过第二个方法是Hibernate自身的规范。</p><h2 id=unexpectedrollbackexception异常>UnexpectedRollbackException异常</h2><p>在使用事务时发生异常，事务回滚时报错：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=n>org</span><span class=o>.</span><span class=na>springframework</span><span class=o>.</span><span class=na>transaction</span><span class=o>.</span><span class=na>UnexpectedRollbackException</span><span class=o>:</span> <span class=n>Transaction</span> <span class=n>rolled</span> <span class=n>back</span> <span class=n>because</span> <span class=n>it</span> <span class=n>has</span> <span class=n>been</span> <span class=n>marked</span> <span class=n>as</span> <span class=n>rollback</span><span class=o>-</span><span class=n>only</span>
</code></pre></td></tr></table></div></div><p>这是事务传播行为导致的，JPA默认的事务传播级别是<code>PROPAGATION_REQUIRED</code>：如果当前存在事务则加入该事务，否则新建一个事务。</p><p>于是当一个事务方法A去调用了另一个事务方法B时，不指明事务传播级别，那么事务方法B依然使用方法A的事务。此时如果方法B抛出异常，触发事务回滚，而在方法A调用方法B的地方使用try-catch捕获发生的异常，理论上方法A应该继续正常执行，实际上却不是这样。</p><p>当方法A继续执行完毕，在最后提交事务时，会发现当前事务已经被标记为<code>rollback-only</code>状态，于是整个事务回滚并抛出<code>UnexpectedRollbackException</code>异常。</p><p>在这种情况下，一般有两种处理场景：</p><ul><li>只有方法B在遇到异常时事务回滚，且不影响到方法A的事务提交，那么此时方法B的事务要指明为<code>PROPAGATION_NESTED</code>。但是，<strong>JPA默认实现是Hibernate，而Hibernate不提供事务嵌套</strong>。对于这种情况，要么使用其他的JPA实现，要么在方法B中将可能发生的异常try-catch并且不往外抛出，但此时方法B将不能自动事务回滚。</li><li>方法B发生异常时，和方法A一起事务回滚。这种场景需要在方法A调用方法B的地方使用try-catch捕获发生的异常，并且将该异常重新往外抛出，这样就可以让方法A事务回滚，且得到的异常也是真正的异常，而不是UnexpectedRollbackException异常。</li></ul><h2 id=参考链接>参考链接</h2><ul><li><a href=https://blog.csdn.net/hsz2568952354/article/details/82724719 target=_blank rel="noopener noreffer">springboot jpa 解决延迟加载问题</a></li><li><a href=https://blog.csdn.net/weixin_43839457/article/details/90445950 target=_blank rel="noopener noreffer">No serializer found for class org.hibernate.proxy.pojo.bytebuddy.ByteBuddyInterceptor</a></li><li><a href=https://blog.csdn.net/liu_yulong/article/details/84594771 target=_blank rel="noopener noreffer">springboot集成jpa返回Json报错 com.fasterxml.jackson.databind.exc.InvalidDefinitionException:</a></li><li><a href=https://www.cnblogs.com/TTTTT/p/6682798.html target=_blank rel="noopener noreffer">Hibernate和Spring整合出现懒加载异常：org.hibernate.LazyInitializationException: could not initialize proxy - no Session</a></li><li><a href=https://blog.csdn.net/mamingjie12/article/details/25911967 target=_blank rel="noopener noreffer">[JPA] javax.persistence.EntityNotFoundException: Unable to find XXXX with id 0 问题原因</a></li><li><a href=http://blog.sina.com.cn/s/blog_697b968901017w9p.html target=_blank rel="noopener noreffer">[转]cannot simultaneously fetch multiple bags 问题的解决办法</a></li><li><a href="https://segmentfault.com/a/1190000016418596?utm_source=tag-newest" target=_blank rel="noopener noreffer">UnexpectedRollbackException解决方案</a></li></ul><div class=post-reward><input type=checkbox name=reward id=reward hidden>
<label class=reward-button for=reward>赞赏支持</label><div class=qr-code><label class=qr-code-image for=reward><img class=image src=https://cdn.jsdelivr.net/gh/lewky/lewky.github.io@master/images/common/wechat.png>
<span>微信打赏</span></label>
<label class=qr-code-image for=reward><img class=image src=https://cdn.jsdelivr.net/gh/lewky/lewky.github.io@master/images/common/alipay.png>
<span>支付宝打赏</span></label></div></div></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>更新于 2021-05-26</span></div><div class=post-info-license><span><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-markdown href=/posts/jpa-hibernate.html/index.md target=_blank>阅读原始文档</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 Twitter" data-sharer=twitter data-url=https://lewky.cn/posts/jpa-hibernate.html/ data-title=JPA/Hibernate问题汇总 data-hashtags=JPA,Hibernate,懒加载><i class="fab fa-twitter fa-fw"></i></a><a href=javascript:void(0); title="分享到 Facebook" data-sharer=facebook data-url=https://lewky.cn/posts/jpa-hibernate.html/ data-hashtag=JPA><i class="fab fa-facebook-square fa-fw"></i></a><a href=javascript:void(0); title="分享到 Hacker News" data-sharer=hackernews data-url=https://lewky.cn/posts/jpa-hibernate.html/ data-title=JPA/Hibernate问题汇总><i class="fab fa-hacker-news fa-fw"></i></a><a href=javascript:void(0); title="分享到 Line" data-sharer=line data-url=https://lewky.cn/posts/jpa-hibernate.html/ data-title=JPA/Hibernate问题汇总><i data-svg-src=https://cdn.jsdelivr.net/npm/simple-icons@2.14.0/icons/line.svg></i></a><a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://lewky.cn/posts/jpa-hibernate.html/ data-title=JPA/Hibernate问题汇总><i class="fab fa-weibo fa-fw"></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/tags/jpa/>JPA</a>,&nbsp;<a href=/tags/hibernate/>Hibernate</a>,&nbsp;<a href=/tags/%E6%87%92%E5%8A%A0%E8%BD%BD/>懒加载</a></section><section><span><a href=javascript:void(0); onclick=window.history.back();>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/posts/docsify-0.html/ class=prev rel=prev title=docsify快速入门><i class="fas fa-angle-left fa-fw"></i>docsify快速入门</a>
<a href=/posts/plantuml-class-diagram.html/ class=next rel=next title="PlantUML - 类图">PlantUML - 类图<i class="fas fa-angle-right fa-fw"></i></a></div></div><div id=comments></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line><span id=run-time></span>|
<a href=http://rssblog.vercel.app/ target=_blank rel=noopener title=RSSBlog><i class="fas fa-fw fa-inbox"></i>&nbsp;RSSBlog</a></div><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2018 - 2021</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank>雨临Lewis</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span><span class=icp-splitter>&nbsp;|&nbsp;</span><br class=icp-br><span class=icp><a target=_blank href=http://www.beian.miit.gov.cn/ style=font-weight:700>粤ICP备19103822</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到顶部><i class="fas fa-arrow-up fa-fw"></i></a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fas fa-comment fa-fw"></i></a></div><div class=sidebar_wo><div id=leimu><img src=https://cdn.jsdelivr.net/gh/lewky/lewky.github.io@master/images/b2t/leimuA.png alt=雷姆 onmouseover="this.src='https:\/\/cdn.jsdelivr.net\/gh\/lewky\/lewky.github.io@master/images/b2t/leimuB.png'" onmouseout="this.src='https:\/\/cdn.jsdelivr.net\/gh\/lewky\/lewky.github.io@master/images/b2t/leimuA.png'" title=回到顶部></div><div class=sidebar_wo id=lamu><img src=https://cdn.jsdelivr.net/gh/lewky/lewky.github.io@master/images/b2t/lamuA.png alt=雷姆 onmouseover="this.src='https:\/\/cdn.jsdelivr.net\/gh\/lewky\/lewky.github.io@master/images/b2t/lamuB.png'" onmouseout="this.src='https:\/\/cdn.jsdelivr.net\/gh\/lewky\/lewky.github.io@master/images/b2t/lamuA.png'" title=回到底部></div></div><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/lightgallery.js@1.2.0/dist/css/lightgallery.min.css><script type=text/javascript src=https://cdn.jsdelivr.net/npm/smooth-scroll@16.1.3/dist/smooth-scroll.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.2.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lightgallery.js@1.2.0/dist/js/lightgallery.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lg-thumbnail.js@1.2.0/dist/lg-thumbnail.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lg-zoom.js@1.2.0/dist/lg-zoom.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.4.0/sharer.min.js></script><script type=text/javascript>window.config={"code":{"copyTitle":"复制到剪贴板","maxShownLines":30},"comment":{},"lightGallery":{"actualSize":false,"exThumbImage":"data-thumbnail","hideBarsDelay":2000,"selector":".lightgallery","speed":400,"thumbContHeight":80,"thumbWidth":80,"thumbnail":true}};</script><script type=text/javascript src=/js/theme.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/jquery@2.1.3/dist/jquery.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/jquery-backstretch@2.1.18/jquery.backstretch.min.js></script><script>$(function(){$(".site-avatar-plug-bilibili").attr("src","https:\/\/cdn.jsdelivr.net\/gh\/lewky\/lewky.github.io@master/images/avatar-plug/bilibili_"+(~~(128*Math.random())+1)+".png");});var avatar_plug=0;var avatar_click=1;jQuery(document).ready(function($){var frequency=1;var plug_count=128;$("div.home-avatar a").click(function(e){if(avatar_click%frequency===0){avatar_plug++;$(".site-avatar-plug-bilibili").attr("src","https:\/\/cdn.jsdelivr.net\/gh\/lewky\/lewky.github.io@master/images/avatar-plug/bilibili_"+avatar_plug+".png");}
if(avatar_plug===plug_count){avatar_plug=0;}
$("div.home-avatar a").attr("alt","再点击"+(frequency-avatar_click%frequency)+"次头像试试看~~");avatar_click++;});});</script><script>var $cdnPrefix="https://cdn.jsdelivr.net/gh/lewky/lewky.github.io@master";</script><script type=text/javascript src=/js/custom.js></script><script>var _hmt=_hmt||[];(function(){var hm=document.createElement("script");hm.src="https://hm.baidu.com/hm.js?6f278ed0fdb01edb3b1e7398379e5432";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(hm,s);})();</script></body></html>