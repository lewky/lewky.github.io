<!doctype html><html lang><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta http-equiv=x-ua-compatible content="IE=edge, chrome=1"><title>Jackson问题汇总 - Yulin Lewis' Blog</title><meta name=keywords content="雨临Lewis,Java,hugo,hexo,博客"><meta name=Description content="不想当写手的码农不是好咸鱼_(xз」∠)_"><meta property="og:title" content="Jackson问题汇总"><meta property="og:description" content="前言
常见的json框架有：Jackson，FasJson（阿里的，万年没更新，积累了大量issue），Gson（谷歌的）。其中Jackson效率最高，性能最好，最为常用。本文基于2.11.3版本的Jackson。
Jackson在1.x版本使用的包名是codehaus，后来升级到2.x版本时，为了和旧版本区分开来，采用了新的包名fasterxml。有这种类似操作的还有Log4j和Log4j2，在使用时需要注意引入的包名，避免混用版本或误用版本。
Jackson可以轻松的将Java对象转换成json对象和xml文档（即序列化），同样也可以将json、xml转换成Java对象（即反序列化）。"><meta property="og:type" content="article"><meta property="og:url" content="https://lewky.cn/posts/jackson-issues/"><meta property="og:image" content="https://lewky.cn/logo.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-01-04T23:45:42+08:00"><meta property="article:modified_time" content="2022-01-04T23:45:42+08:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://lewky.cn/logo.png"><meta name=twitter:title content="Jackson问题汇总"><meta name=twitter:description content="前言
常见的json框架有：Jackson，FasJson（阿里的，万年没更新，积累了大量issue），Gson（谷歌的）。其中Jackson效率最高，性能最好，最为常用。本文基于2.11.3版本的Jackson。
Jackson在1.x版本使用的包名是codehaus，后来升级到2.x版本时，为了和旧版本区分开来，采用了新的包名fasterxml。有这种类似操作的还有Log4j和Log4j2，在使用时需要注意引入的包名，避免混用版本或误用版本。
Jackson可以轻松的将Java对象转换成json对象和xml文档（即序列化），同样也可以将json、xml转换成Java对象（即反序列化）。"><meta name=application-name content="雨临Lewis的博客"><meta name=apple-mobile-web-app-title content="雨临Lewis的博客"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://lewky.cn/posts/jackson-issues/><link rel=prev href=https://lewky.cn/posts/javaweb-servlet-issues/><link rel=next href=https://lewky.cn/posts/lombok-issues/><link rel=stylesheet href=https://unpkg.com/normalize.css@8.0.1/normalize.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=https://unpkg.com/@fortawesome/fontawesome-free@5.13.0/css/all.min.css><link rel=stylesheet href=https://unpkg.com/animate.css@3.7.2/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Jackson问题汇总","inLanguage":"","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/lewky.cn\/posts\/jackson-issues\/"},"genre":"posts","keywords":"Jackson","wordcount":3499,"url":"https:\/\/lewky.cn\/posts\/jackson-issues\/","datePublished":"2022-01-04T23:45:42+08:00","dateModified":"2022-01-04T23:45:42+08:00","license":"This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher":{"@type":"Organization","name":"雨临Lewis","logo":"https:\/\/lewky.cn\/images\/avatar.jpg"},"author":{"@type":"Person","name":"雨临Lewis"},"description":""}</script></head><body header-desktop=fixed header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><a href=https://github.com/lewky class=github-corner target=_blank title="Follow me on GitHub" aria-label="Follow me on GitHub"><svg width="3.5rem" height="3.5rem" viewBox="0 0 250 250" style="fill:#70b7fd;color:#fff;position:absolute;top:0;border:0;left:0;transform:scale(-1,1)" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentcolor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentcolor" class="octo-body"/></svg></a><div class=header-title><a href=/ title="Yulin Lewis' Blog"><span class=header-title-pre><i class='fas fa-fw fa-atom'></i></span>雨临Lewis</a></div><div class=menu><div class=menu-inner><div class=dropdown><a href=/posts/ class="menu-item menu-more dropbtn" title=点击查看所有文章><i class='fas fa-fw fa-archive'></i> 归档</a><div class="menu-more-content dropdown-content"><a href=/categories/ title><i class='fas fa-fw fa-th'></i> 分类 </a><a href=/tags/ title><i class='fas fa-fw fa-tag'></i> 标签 </a><a href=/about/ title><i class='fas fa-fw fa-at'></i> 关于</a></div></div><a class=menu-item href=/friends/ title=欢迎申请友链><i class='fas fa-fw fa-link'></i> 友链</a><div class=dropdown><a href=javascript:void(0); class="menu-item menu-more dropbtn" title=一些有意思的东东~><i class='fas fa-fw fa-fan fa-spin'></i> 趣味</a><div class="menu-more-content dropdown-content"><a href=/funny/high/ title="前方高能♂ 小心外放！" target=_blank rel=noopener><i class='fas fa-fw fa-dizzy'></i> 燥起来！ </a><a href=/funny/mikutap/ title=初音未来音乐游戏 target=_blank rel=noopener><i class='fas fa-fw fa-music'></i> 在线打碟 </a><a href=/funny/catch-the-cat/ title=逮住那只猫!><i class='fas fa-fw fa-cat'></i> 抓住猫咪</a></div></div><div class=dropdown><a href=/ class="menu-item menu-more dropbtn" title=回到首页><i class='fas fa-fw fa-atom'></i> 站点</a><div class="menu-more-content dropdown-content"><a href=/bbs/ title=来留言吧~><i class='fas fa-fw fa-comment'></i> 公告留言 </a><a href=https://seo.chinaz.com title target=_blank rel=noopener><i class='fas fa-fw fa-chart-line'></i> SEO查询 </a><a href=https://www.ping.cn/http/lewky.cn title target=_blank rel=noopener><i class='fas fa-fw fa-bezier-curve'></i> 网站测速 </a><a href=/posts/e62c38c4.html/ title><i class='fas fa-fw fa-cog fa-spin'></i> 建站日志</a></div></div><div class=dropdown><a href=javascript:void(0); class="menu-item menu-more dropbtn" title><i class='fas fa-fw fa-book'></i> 文档</a><div class="menu-more-content dropdown-content"><a href=https://gohugo.io/documentation/ title target=_blank rel=noopener><i class='fas fa-fw fa-star'></i> Hugo文档 </a><a href=https://javanote.doc.lewky.cn/ title=尚在完善中~ target=_blank rel=noopener><i class='fab fa-fw fa-java'></i> Java 笔记</a></div></div><a class=menu-item href=/search/ title=渲染搜索结果需要等待几秒钟~><i class='fas fa-fw fa-search'></i> 搜索
</a><span class="menu-item delimiter"></span>
<a href=https://travellings.link target=_blank class=menu-item rel=noopener title=开往-友链接力><i class='fas fa-fw fa-subway'></i></a>
<a href=https://rssblog.vercel.app/ class=menu-item target=_blank rel=noopener title=RSSBlog><i class='fas fa-fw fa-inbox'></i></a>
<a href=https://github.com/lewky class=menu-item target=_blank rel=noopener title=GitHub><i class='fab fa-fw fa-github'></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Yulin Lewis' Blog"><span class=header-title-pre><i class='fas fa-fw fa-atom'></i></span>雨临Lewis</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=dropdown><a href=/posts/ class="menu-item menu-more dropbtn" title=点击查看所有文章><i class='fas fa-fw fa-archive'></i> 归档</a><div class="menu-more-content dropdown-content"><a href=/categories/ title><i class='fas fa-fw fa-th'></i> 分类 </a><a href=/tags/ title><i class='fas fa-fw fa-tag'></i> 标签 </a><a href=/about/ title><i class='fas fa-fw fa-at'></i> 关于</a></div></div><a class=menu-item href=/friends/ title=欢迎申请友链><i class='fas fa-fw fa-link'></i> 友链</a><div class=dropdown><a href=javascript:void(0); class="menu-item menu-more dropbtn" title=一些有意思的东东~><i class='fas fa-fw fa-fan fa-spin'></i> 趣味</a><div class="menu-more-content dropdown-content"><a href=/funny/high/ title="前方高能♂ 小心外放！" target=_blank rel=noopener><i class='fas fa-fw fa-dizzy'></i> 燥起来！ </a><a href=/funny/mikutap/ title=初音未来音乐游戏 target=_blank rel=noopener><i class='fas fa-fw fa-music'></i> 在线打碟 </a><a href=/funny/catch-the-cat/ title=逮住那只猫!><i class='fas fa-fw fa-cat'></i> 抓住猫咪</a></div></div><div class=dropdown><a href=/ class="menu-item menu-more dropbtn" title=回到首页><i class='fas fa-fw fa-atom'></i> 站点</a><div class="menu-more-content dropdown-content"><a href=/bbs/ title=来留言吧~><i class='fas fa-fw fa-comment'></i> 公告留言 </a><a href=https://seo.chinaz.com title target=_blank rel=noopener><i class='fas fa-fw fa-chart-line'></i> SEO查询 </a><a href=https://www.ping.cn/http/lewky.cn title target=_blank rel=noopener><i class='fas fa-fw fa-bezier-curve'></i> 网站测速 </a><a href=/posts/e62c38c4.html/ title><i class='fas fa-fw fa-cog fa-spin'></i> 建站日志</a></div></div><div class=dropdown><a href=javascript:void(0); class="menu-item menu-more dropbtn" title><i class='fas fa-fw fa-book'></i> 文档</a><div class="menu-more-content dropdown-content"><a href=https://gohugo.io/documentation/ title target=_blank rel=noopener><i class='fas fa-fw fa-star'></i> Hugo文档 </a><a href=https://javanote.doc.lewky.cn/ title=尚在完善中~ target=_blank rel=noopener><i class='fab fa-fw fa-java'></i> Java 笔记</a></div></div><a class=menu-item href=/search/ title=渲染搜索结果需要等待几秒钟~><i class='fas fa-fw fa-search'></i> 搜索</a>
<a href=https://travellings.link target=_blank class=menu-item rel=noopener title=开往-友链接力><i class='fas fa-fw fa-subway'></i></a>
<a href=https://rssblog.vercel.app/ class=menu-item target=_blank rel=noopener title=RSSBlog><i class='fas fa-fw fa-inbox'></i></a>
<a href=https://github.com/lewky class=menu-item target=_blank rel=noopener title=GitHub><i class='fab fa-fw fa-github'></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>目录</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animated flipInX">Jackson问题汇总</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw"></i>雨临Lewis</a></span>&nbsp;<span class=post-category>收录于 <a href=/categories/%E5%B7%A5%E4%BD%9C%E8%AE%B0%E5%BD%95/><i class="far fa-folder fa-fw"></i>工作记录</a></span></div><div class=post-meta-line><i class="far fa-calendar fa-fw"></i>&nbsp;<time datetime=2022-01-04>2022-01-04</time>&nbsp;<i class="far fa-calendar-plus fa-fw"></i>&nbsp;<time datetime=2022-01-04>2022-01-04</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 3499 字
<i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 7 分钟&nbsp;<span id=/posts/jackson-issues/ class=leancloud_visitors data-flag-title=Jackson问题汇总>
<i class="far fa-eye fa-fw"></i>&nbsp;<span class=leancloud-visitors-count></span>&nbsp;次阅读
</span>&nbsp;
<a href=#comments id=post-meta-vcount title=查看评论><i class="fas fa-comment fa-fw"></i>&nbsp;<span id=/posts/jackson-issues/ class=waline-comment-count></span>&nbsp;条评论</a></div></div><div class="details toc" id=toc-static kept><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ol><li><a href=#前言>前言</a></li><li><a href=#序列化日期字段的时区问题>序列化日期字段的时区问题</a></li><li><a href=#序列化时重命名字段>序列化时重命名字段</a></li><li><a href=#序列化忽略指定的字段>序列化忽略指定的字段</a><ol><li><a href=#按照字段进行忽略>按照字段进行忽略</a></li><li><a href=#按照字段的值进行忽略>按照字段的值进行忽略</a></li></ol></li><li><a href=#pojo的循环依赖导致序列化时无限递归>pojo的循环依赖导致序列化时无限递归</a><ol><li><a href=#使用jsonignore>使用<code>@JsonIgnore</code></a></li></ol></li><li><a href=#自定义对象的序列化和反序列化>自定义对象的序列化和反序列化</a></li><li><a href=#参考链接>参考链接</a></li></ol></nav></div></div><div class=content id=content><h2 id=前言>前言</h2><p>常见的json框架有：Jackson，FasJson（阿里的，万年没更新，积累了大量issue），Gson（谷歌的）。其中Jackson效率最高，性能最好，最为常用。本文基于<code>2.11.3</code>版本的Jackson。</p><p>Jackson在1.x版本使用的包名是<code>codehaus</code>，后来升级到2.x版本时，为了和旧版本区分开来，采用了新的包名<code>fasterxml</code>。有这种类似操作的还有Log4j和Log4j2，在使用时需要注意引入的包名，避免混用版本或误用版本。</p><p>Jackson可以轻松的将Java对象转换成json对象和xml文档（即序列化），同样也可以将json、xml转换成Java对象（即反序列化）。</p><h2 id=序列化日期字段的时区问题>序列化日期字段的时区问题</h2><p>在将日期转为字符串时会使用<code>@JsonFormat</code>注解，默认使用零时区，因此在使用时要注意时区问题。比如项目部署在中国境内的服务器（东八区时区），不注意时区问题可能会导致json中的时间和预期的差距8个小时。</p><p>实际开发中，假如存在多个不同时区的客户，通常是把客户所在的时区时间转换为零时区，然后存入到数据库中。这样项目从数据库读取到的时间就是零时区，再根据客户所在时区修改显示在前端页面的时间。这样比较灵活，不怕时间字段的值发生混乱，不易管理。</p><p>在格式化成json时注解如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 将日期格式化成ISO格式
</span></span></span><span class=line><span class=cl><span class=c1>// 这里转成零时区，北京时间东八区是GMT+8
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nd>@JsonFormat</span><span class=o>(</span><span class=n>shape</span><span class=o>=</span><span class=n>JsonFormat</span><span class=o>.</span><span class=na>Shape</span><span class=o>.</span><span class=na>STRING</span><span class=o>,</span> <span class=n>pattern</span><span class=o>=</span><span class=s>&#34;yyyy-MM-dd&#39;T&#39;HH:mm:ss.SSS&#39;Z&#39;&#34;</span><span class=o>,</span> <span class=n>timezone</span><span class=o>=</span><span class=s>&#34;GMT&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=kd>private</span> <span class=n>LocalDateTime</span> <span class=n>updatedOn</span><span class=o>;</span>
</span></span></code></pre></td></tr></table></div></div><p>另外，<code>@DatetimeFormat</code>是spring提供的一个注解，用以将日期转为String，提供给前端使用。</p><h2 id=序列化时重命名字段>序列化时重命名字段</h2><p>可以使用<code>@JsonProperty</code>来重命名字段，<code>@JsonProperty</code>能够在序列化和反序列化时给字段映射到指定的名字：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@JsonProperty</span><span class=o>(</span><span class=s>&#34;updatedBy&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=kd>private</span> <span class=n>String</span> <span class=n>updateUserName</span><span class=o>;</span>
</span></span></code></pre></td></tr></table></div></div><p>如上，<code>updateUserName</code>在序列化为json时会被重命名为<code>updatedBy</code>，在反序列化时json中<code>updatedBy</code>的值会被映射到<code>updateUserName</code>。</p><p>将这个注解和MapStruct映射框架结合起来，可以通过定义<code>@JsonProperty</code>来避免额外定义MapStruct框架的不同名字段映射规则；比如：<code>@Mapping(source = "updateUserName", target = "updatedBy")</code></p><p>还有个类似的注解<code>@JsonAlias</code>，其作用是给字段起别名，只在<strong>反序列化</strong>阶段有效，可以让字段接受更多的映射名称：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@JsonAlias</span><span class=o>(</span><span class=s>&#34;updatedBy&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=kd>private</span> <span class=n>String</span> <span class=n>updateUserName</span><span class=o>;</span>
</span></span></code></pre></td></tr></table></div></div><p>如上，在反序列化时，json中的<code>updatedBy</code>或者<code>updateUserName</code>都可以映射到pojo的<code>updateUserName</code>字段上。</p><h2 id=序列化忽略指定的字段>序列化忽略指定的字段</h2><h3 id=按照字段进行忽略>按照字段进行忽略</h3><p>可以使用<code>@JsonIgnore</code>或者<code>@JsonIgnoreProperties</code>来忽略字段，<code>@JsonIgnoreProperties</code>比前者多了一个使用方式，那就是加在类上：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 在使用JPA-hibernate的懒加载功能时，懒加载对象会多出来`hibernateLazyInitializer`字段，这里将其忽略掉
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nd>@JsonIgnoreProperties</span><span class=o>(</span><span class=n>value</span> <span class=o>=</span> <span class=o>{</span> <span class=s>&#34;hibernateLazyInitializer&#34;</span> <span class=o>})</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Item</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@JsonIgnore</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>String</span> <span class=n>tag</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=按照字段的值进行忽略>按照字段的值进行忽略</h3><p>上述两个注解会直接忽略指定的字段，如果想忽略满足某个条件的字段，比如忽略值为null的字段，或者值为0的数值型字段等，可以用<code>@JsonInclude</code>注解。</p><p><code>@JsonInclude</code>用来指定序列化时需要包括哪些字段，本身提供了多种策略：ALWAYS、NON_NULL、NON_EMPTY等。如果需要自定义包括字段的策略，方式如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 指定自定义的序列化策略，同时提供相关的值过滤类ValueFilter
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nd>@JsonInclude</span><span class=o>(</span><span class=n>value</span> <span class=o>=</span> <span class=n>Include</span><span class=o>.</span><span class=na>CUSTOM</span> <span class=o>,</span> <span class=n>valueFilter</span> <span class=o>=</span> <span class=n>ValueFilter</span><span class=o>.</span><span class=na>class</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Item</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>//...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 自定义的过滤类
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>public</span> <span class=kd>class</span> <span class=nc>ValueFilter</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span>  <span class=kt>boolean</span> <span class=nf>equals</span><span class=o>(</span><span class=kd>final</span> <span class=n>Object</span> <span class=n>obj</span><span class=o>){</span>
</span></span><span class=line><span class=cl>        <span class=c1>// return true表示将其过滤，即在序列化时将其忽略。
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=c1>// 这里将所有值为null、false、0的字段全部忽略
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>if</span> <span class=o>(</span><span class=n>obj</span> <span class=o>==</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>true</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>obj</span><span class=o>.</span><span class=na>equals</span><span class=o>(</span><span class=n>Boolean</span><span class=o>.</span><span class=na>FALSE</span><span class=o>))</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>true</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>obj</span><span class=o>.</span><span class=na>equals</span><span class=o>(</span><span class=n>Integer</span><span class=o>.</span><span class=na>valueOf</span><span class=o>(</span><span class=mi>0</span><span class=o>)))</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>true</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>obj</span> <span class=k>instanceof</span> <span class=n>BigDecimal</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=kd>final</span> <span class=n>BigDecimal</span> <span class=n>value</span> <span class=o>=</span> <span class=o>(</span><span class=n>BigDecimal</span><span class=o>)</span> <span class=n>obj</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=o>(</span><span class=n>value</span><span class=o>.</span><span class=na>compareTo</span><span class=o>(</span><span class=n>BigDecimal</span><span class=o>.</span><span class=na>ZERO</span><span class=o>)</span> <span class=o>==</span> <span class=mi>0</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=kc>true</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>false</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>int</span> <span class=nf>hashCode</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kd>super</span><span class=o>.</span><span class=na>hashCode</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=pojo的循环依赖导致序列化时无限递归>pojo的循环依赖导致序列化时无限递归</h2><p>当多个pojo之间存在循环依赖时，在序列化时会无限递归，最终堆栈溢出<code>StackOverflowError</code>。pojo如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 供应商Vendor，关联着中间表VendorFact
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nd>@Data</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Vendor</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>List</span><span class=o>&lt;</span><span class=n>VendorFact</span><span class=o>&gt;</span> <span class=n>facts</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 工厂Fact，关联着中间表VendorFact
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nd>@Data</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Fact</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>List</span><span class=o>&lt;</span><span class=n>VendorFact</span><span class=o>&gt;</span> <span class=n>vendors</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 中间表VendorFact，存放Vendor和Fact的关联关系（多对多）
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nd>@Data</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>VendorFact</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>Fact</span> <span class=n>fact</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>Vendor</span> <span class=n>vendor</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p>上述的pojo在序列化时会互相引用、无限递归，因此需要打断这个循环链。</p><p>经过本人测试，其他博客中提及的<code>@JsonManagedReference</code>和<code>@JsonBackReference</code>并无效果，至少在多对多的关联关系中不起效（一对多没有测试）。</p><h3 id=使用jsonignore>使用<code>@JsonIgnore</code></h3><p>直接在其中一方的字段上加上<code>@JsonIgnore</code>，这样在序列化时该字段就会被忽略，自然也就不会互相引用无限递归了。比如对于Vendor的序列化，可以将VendorFact里的vendor变量忽略：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Data</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>VendorFact</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>Fact</span> <span class=n>fact</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@JsonIgnore</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>Vendor</span> <span class=n>vendor</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p>不过这个方案有个缺点，就是序列化后的json中只有一方持有另一方，在另一方的json中无法持有对方，在一对多或者多对多的情况中并不便利。比如上面的方式，虽然Vendor可以正常序列化了，但是Fact依然不能正常序列化。而在序列化VendorFact时，也缺少了vendor的信息。</p><p>当然有个方案是，为每一方都单独创建一套对应的dto来进行序列化，这样的话虽然类的数量变多了，但是可以解决多对多关系中只有一方能序列化的问题。比如上面的例子，需要两个VendorFact的dto类，各自对应Vendor和Fact。不过在序列化VendorFact时，依然缺少另一方的信息。不过正常情况下不会单独去序列化作为中间表的VendorFact，因此不予考虑这个缺点。</p><p>此外，和<code>@JsonIgnore</code>效果类似的<code>@JsonIgnoreProperties</code>，也能起到一样的效果，但是这个注解如果添加在集合变量上是无效的，如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Data</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Vendor</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 不会起效，因为这里的json结构实际上是数组，对应的是List对象，而不是VendorFact
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// 需要将该注解添加在VendorFact类上
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nd>@JsonIgnoreProperties</span><span class=o>(</span><span class=s>&#34;vendor&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>List</span><span class=o>&lt;</span><span class=n>VendorFact</span><span class=o>&gt;</span> <span class=n>facts</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@Data</span>
</span></span><span class=line><span class=cl><span class=c1>// 上面的注解应该加在这里
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nd>@JsonIgnoreProperties</span><span class=o>(</span><span class=s>&#34;vendor&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>VendorFact</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>Fact</span> <span class=n>fact</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>Vendor</span> <span class=n>vendor</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=自定义对象的序列化和反序列化>自定义对象的序列化和反序列化</h2><p>有时候只靠默认的序列化方式，或者常规的json注解，难以实现某个对象的序列化要求。比如，现在需要对一个HashMap对象进行序列化，这个对象中的字段和类型是未知的，此时可以用<code>@JsonSerialize</code>和<code>@JsonDeserialize</code>来控制序列化和反序列化。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Data</span>
</span></span><span class=line><span class=cl><span class=c1>// 指定自定义的序列化器CustomTableDtoSerializer
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nd>@JsonSerialize</span><span class=o>(</span><span class=n>using</span> <span class=o>=</span> <span class=n>CustomTableDtoSerializer</span><span class=o>.</span><span class=na>class</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=c1>// 指定自定义的反序列化器CustomTableDtoDeserializer
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nd>@JsonDeserialize</span><span class=o>(</span><span class=n>using</span> <span class=o>=</span> <span class=n>CustomTableDtoDeserializer</span><span class=o>.</span><span class=na>class</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>CustomTableDto</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kd>final</span> <span class=n>DateTimeFormatter</span> <span class=n>DATE_FORMAT</span> <span class=o>=</span> <span class=n>DateTimeFormatter</span><span class=o>.</span><span class=na>ofPattern</span><span class=o>(</span><span class=s>&#34;yyyy-MM-dd&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>Map</span><span class=o>&lt;</span><span class=n>String</span><span class=o>,</span> <span class=n>Object</span><span class=o>&gt;</span> <span class=n>dynamicModelMap</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 序列化器
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>public</span> <span class=kd>class</span> <span class=nc>CustomTableDtoSerializer</span> <span class=kd>extends</span> <span class=n>JsonSerializer</span><span class=o>&lt;</span><span class=n>CustomTableDto</span><span class=o>&gt;</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>serialize</span><span class=o>(</span><span class=kd>final</span> <span class=n>CustomTableDto</span> <span class=n>customTable</span><span class=o>,</span> <span class=kd>final</span> <span class=n>JsonGenerator</span> <span class=n>gen</span><span class=o>,</span>
</span></span><span class=line><span class=cl>                          <span class=kd>final</span> <span class=n>SerializerProvider</span> <span class=n>serializers</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>IOException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>final</span> <span class=n>Map</span><span class=o>&lt;</span><span class=n>String</span><span class=o>,</span> <span class=n>Object</span><span class=o>&gt;</span> <span class=n>dynamicModelMap</span> <span class=o>=</span> <span class=n>customTable</span><span class=o>.</span><span class=na>getDynamicModelMap</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>dynamicModelMap</span> <span class=o>!=</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>gen</span><span class=o>.</span><span class=na>writeStartObject</span><span class=o>();</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=o>(</span><span class=kd>final</span> <span class=n>String</span> <span class=n>key</span> <span class=o>:</span> <span class=n>dynamicModelMap</span><span class=o>.</span><span class=na>keySet</span><span class=o>())</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=kd>final</span> <span class=n>Object</span> <span class=n>value</span> <span class=o>=</span> <span class=n>dynamicModelMap</span><span class=o>.</span><span class=na>get</span><span class=o>(</span><span class=n>key</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                <span class=kd>final</span> <span class=n>Optional</span><span class=o>&lt;</span><span class=n>CustomFieldType</span><span class=o>&gt;</span> <span class=n>typeOpt</span> <span class=o>=</span> <span class=n>CustomFieldType</span><span class=o>.</span><span class=na>findTypeByColumnName</span><span class=o>(</span><span class=n>key</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=o>(</span><span class=n>typeOpt</span><span class=o>.</span><span class=na>isPresent</span><span class=o>()</span> <span class=o>&amp;&amp;</span> <span class=n>value</span> <span class=o>!=</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                    <span class=n>writeType</span><span class=o>(</span><span class=n>gen</span><span class=o>,</span> <span class=n>typeOpt</span><span class=o>.</span><span class=na>get</span><span class=o>(),</span> <span class=n>key</span><span class=o>,</span> <span class=n>value</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                <span class=o>}</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>
</span></span><span class=line><span class=cl>            <span class=n>gen</span><span class=o>.</span><span class=na>writeEndObject</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span> <span class=k>else</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>gen</span><span class=o>.</span><span class=na>writeNull</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>writeType</span><span class=o>(</span><span class=kd>final</span> <span class=n>JsonGenerator</span> <span class=n>gen</span><span class=o>,</span> <span class=kd>final</span> <span class=n>CustomFieldType</span> <span class=n>type</span><span class=o>,</span>
</span></span><span class=line><span class=cl>                                  <span class=kd>final</span> <span class=n>String</span> <span class=n>key</span><span class=o>,</span> <span class=kd>final</span> <span class=n>Object</span> <span class=n>value</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>IOException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>final</span> <span class=n>String</span> <span class=n>jsonKey</span> <span class=o>=</span> <span class=n>StringUtils</span><span class=o>.</span><span class=na>replaceOnce</span><span class=o>(</span><span class=n>key</span><span class=o>,</span> <span class=n>type</span><span class=o>.</span><span class=na>getColumnName</span><span class=o>(),</span> <span class=n>type</span><span class=o>.</span><span class=na>getJsonName</span><span class=o>());</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 根据不同的字段类型进行对应的业务处理
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=c1>// CustomFieldType是自定义的枚举类，这里就不写出来了
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>switch</span> <span class=o>(</span><span class=n>type</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>case</span> <span class=n>TEXT</span><span class=o>:</span>
</span></span><span class=line><span class=cl>            <span class=k>case</span> <span class=n>TEXT_AREA</span><span class=o>:</span>
</span></span><span class=line><span class=cl>                <span class=n>gen</span><span class=o>.</span><span class=na>writeStringField</span><span class=o>(</span><span class=n>jsonKey</span><span class=o>,</span> <span class=o>(</span><span class=n>String</span><span class=o>)</span> <span class=n>value</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                <span class=k>break</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=k>case</span> <span class=n>DATE</span><span class=o>:</span>
</span></span><span class=line><span class=cl>                <span class=n>gen</span><span class=o>.</span><span class=na>writeStringField</span><span class=o>(</span><span class=n>jsonKey</span><span class=o>,</span> <span class=n>CustomTableDto</span><span class=o>.</span><span class=na>DATE_FORMAT</span><span class=o>.</span><span class=na>format</span><span class=o>((</span><span class=n>LocalDate</span><span class=o>)</span> <span class=n>value</span><span class=o>));</span>
</span></span><span class=line><span class=cl>                <span class=k>break</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=k>case</span> <span class=n>NUMBER</span><span class=o>:</span>
</span></span><span class=line><span class=cl>                <span class=n>gen</span><span class=o>.</span><span class=na>writeNumberField</span><span class=o>(</span><span class=n>jsonKey</span><span class=o>,</span> <span class=o>(</span><span class=n>Long</span><span class=o>)</span> <span class=n>value</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                <span class=k>break</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=k>case</span> <span class=n>DECIMAL</span><span class=o>:</span>
</span></span><span class=line><span class=cl>                <span class=n>gen</span><span class=o>.</span><span class=na>writeNumberField</span><span class=o>(</span><span class=n>jsonKey</span><span class=o>,</span> <span class=o>(</span><span class=n>BigDecimal</span><span class=o>)</span> <span class=n>value</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                <span class=k>break</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=k>case</span> <span class=n>CHECKBOX</span><span class=o>:</span>
</span></span><span class=line><span class=cl>                <span class=n>gen</span><span class=o>.</span><span class=na>writeBooleanField</span><span class=o>(</span><span class=n>jsonKey</span><span class=o>,</span> <span class=o>(</span><span class=n>Boolean</span><span class=o>)</span> <span class=n>value</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                <span class=k>break</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=k>case</span> <span class=n>CODELIST</span><span class=o>:</span>
</span></span><span class=line><span class=cl>            <span class=k>case</span> <span class=n>HCL_GROUP</span><span class=o>:</span>
</span></span><span class=line><span class=cl>                <span class=n>gen</span><span class=o>.</span><span class=na>writeObjectField</span><span class=o>(</span><span class=n>jsonKey</span><span class=o>,</span> <span class=n>value</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                <span class=k>break</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=k>default</span><span class=o>:</span>
</span></span><span class=line><span class=cl>                <span class=c1>//do nothing
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 反序列化器
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>public</span> <span class=kd>class</span> <span class=nc>CustomTableDtoDeserializer</span> <span class=kd>extends</span> <span class=n>JsonDeserializer</span><span class=o>&lt;</span><span class=n>CustomTableDto</span><span class=o>&gt;</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>CustomTableDto</span> <span class=nf>deserialize</span><span class=o>(</span><span class=kd>final</span> <span class=n>JsonParser</span> <span class=n>p</span><span class=o>,</span> <span class=kd>final</span> <span class=n>DeserializationContext</span> <span class=n>ctxt</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>IOException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>final</span> <span class=n>ObjectCodec</span> <span class=n>oc</span> <span class=o>=</span> <span class=n>p</span><span class=o>.</span><span class=na>getCodec</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=kd>final</span> <span class=n>JsonNode</span> <span class=n>root</span> <span class=o>=</span> <span class=n>oc</span><span class=o>.</span><span class=na>readTree</span><span class=o>(</span><span class=n>p</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kd>final</span> <span class=n>Map</span><span class=o>&lt;</span><span class=n>String</span><span class=o>,</span> <span class=n>Object</span><span class=o>&gt;</span> <span class=n>dynamicModelMap</span> <span class=o>=</span> <span class=k>new</span> <span class=n>HashMap</span><span class=o>&lt;&gt;();</span>
</span></span><span class=line><span class=cl>        <span class=kd>final</span> <span class=n>Iterator</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>fieldIterator</span> <span class=o>=</span> <span class=n>root</span><span class=o>.</span><span class=na>fieldNames</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>while</span> <span class=o>(</span><span class=n>fieldIterator</span><span class=o>.</span><span class=na>hasNext</span><span class=o>())</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=kd>final</span> <span class=n>String</span> <span class=n>jsonKey</span> <span class=o>=</span> <span class=n>fieldIterator</span><span class=o>.</span><span class=na>next</span><span class=o>();</span>
</span></span><span class=line><span class=cl>            <span class=kd>final</span> <span class=n>JsonNode</span> <span class=n>value</span> <span class=o>=</span> <span class=n>root</span><span class=o>.</span><span class=na>get</span><span class=o>(</span><span class=n>jsonKey</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=kd>final</span> <span class=n>Optional</span><span class=o>&lt;</span><span class=n>CustomFieldType</span><span class=o>&gt;</span> <span class=n>typeOpt</span> <span class=o>=</span> <span class=n>CustomFieldType</span><span class=o>.</span><span class=na>findTypeByJsonName</span><span class=o>(</span><span class=n>jsonKey</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=o>(</span><span class=n>typeOpt</span><span class=o>.</span><span class=na>isPresent</span><span class=o>()</span> <span class=o>&amp;&amp;</span> <span class=n>value</span> <span class=o>!=</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=n>put</span><span class=o>(</span><span class=n>oc</span><span class=o>,</span> <span class=n>dynamicModelMap</span><span class=o>,</span> <span class=n>typeOpt</span><span class=o>.</span><span class=na>get</span><span class=o>(),</span> <span class=n>jsonKey</span><span class=o>,</span> <span class=n>value</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kd>final</span> <span class=n>CustomTableDto</span> <span class=n>customTableDto</span> <span class=o>=</span> <span class=k>new</span> <span class=n>CustomTableDto</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>customTableDto</span><span class=o>.</span><span class=na>setDynamicModelMap</span><span class=o>(</span><span class=n>dynamicModelMap</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>customTableDto</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>put</span><span class=o>(</span><span class=kd>final</span> <span class=n>ObjectCodec</span> <span class=n>oc</span><span class=o>,</span> <span class=kd>final</span> <span class=n>Map</span><span class=o>&lt;</span><span class=n>String</span><span class=o>,</span> <span class=n>Object</span><span class=o>&gt;</span> <span class=n>dynamicModelMap</span><span class=o>,</span> <span class=kd>final</span> <span class=n>CustomFieldType</span> <span class=n>type</span><span class=o>,</span>
</span></span><span class=line><span class=cl>                            <span class=kd>final</span> <span class=n>String</span> <span class=n>jsonKey</span><span class=o>,</span> <span class=kd>final</span> <span class=n>JsonNode</span> <span class=n>value</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>IOException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>final</span> <span class=n>String</span> <span class=n>columnKey</span> <span class=o>=</span> <span class=n>StringUtils</span><span class=o>.</span><span class=na>replaceOnce</span><span class=o>(</span><span class=n>jsonKey</span><span class=o>,</span> <span class=n>type</span><span class=o>.</span><span class=na>getJsonName</span><span class=o>(),</span> <span class=n>type</span><span class=o>.</span><span class=na>getColumnName</span><span class=o>());</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 根据不同的字段类型进行对应的业务处理
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=c1>// CustomFieldType是自定义的枚举类，这里就不写出来了
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>switch</span> <span class=o>(</span><span class=n>type</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>case</span> <span class=n>TEXT</span><span class=o>:</span>
</span></span><span class=line><span class=cl>            <span class=k>case</span> <span class=n>TEXT_AREA</span><span class=o>:</span>
</span></span><span class=line><span class=cl>                <span class=n>dynamicModelMap</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=n>columnKey</span><span class=o>,</span> <span class=n>value</span><span class=o>.</span><span class=na>textValue</span><span class=o>());</span>
</span></span><span class=line><span class=cl>                <span class=k>break</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=k>case</span> <span class=n>DATE</span><span class=o>:</span>
</span></span><span class=line><span class=cl>                <span class=kd>final</span> <span class=n>String</span> <span class=n>dateStr</span> <span class=o>=</span> <span class=n>value</span><span class=o>.</span><span class=na>textValue</span><span class=o>();</span>
</span></span><span class=line><span class=cl>                <span class=n>dynamicModelMap</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=n>columnKey</span><span class=o>,</span> <span class=n>LocalDate</span><span class=o>.</span><span class=na>from</span><span class=o>(</span><span class=n>CustomTableDto</span><span class=o>.</span><span class=na>DATE_FORMAT</span><span class=o>.</span><span class=na>parse</span><span class=o>(</span><span class=n>dateStr</span><span class=o>)));</span>
</span></span><span class=line><span class=cl>                <span class=k>break</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=k>case</span> <span class=n>NUMBER</span><span class=o>:</span>
</span></span><span class=line><span class=cl>                <span class=n>dynamicModelMap</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=n>columnKey</span><span class=o>,</span> <span class=n>value</span><span class=o>.</span><span class=na>longValue</span><span class=o>());</span>
</span></span><span class=line><span class=cl>                <span class=k>break</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=k>case</span> <span class=n>DECIMAL</span><span class=o>:</span>
</span></span><span class=line><span class=cl>                <span class=n>dynamicModelMap</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=n>columnKey</span><span class=o>,</span> <span class=n>value</span><span class=o>.</span><span class=na>decimalValue</span><span class=o>());</span>
</span></span><span class=line><span class=cl>                <span class=k>break</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=k>case</span> <span class=n>CHECKBOX</span><span class=o>:</span>
</span></span><span class=line><span class=cl>                <span class=n>dynamicModelMap</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=n>columnKey</span><span class=o>,</span> <span class=n>value</span><span class=o>.</span><span class=na>booleanValue</span><span class=o>());</span>
</span></span><span class=line><span class=cl>                <span class=k>break</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=k>case</span> <span class=n>CODELIST</span><span class=o>:</span>
</span></span><span class=line><span class=cl>                <span class=n>dynamicModelMap</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=n>columnKey</span><span class=o>,</span> <span class=n>oc</span><span class=o>.</span><span class=na>treeToValue</span><span class=o>(</span><span class=n>value</span><span class=o>,</span> <span class=n>EmbedCodelist</span><span class=o>.</span><span class=na>class</span><span class=o>));</span>
</span></span><span class=line><span class=cl>                <span class=k>break</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=k>case</span> <span class=n>HCL_GROUP</span><span class=o>:</span>
</span></span><span class=line><span class=cl>                <span class=n>dynamicModelMap</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=n>columnKey</span><span class=o>,</span> <span class=n>oc</span><span class=o>.</span><span class=na>treeToValue</span><span class=o>(</span><span class=n>value</span><span class=o>,</span> <span class=n>EmbedHcl</span><span class=o>.</span><span class=na>class</span><span class=o>));</span>
</span></span><span class=line><span class=cl>                <span class=k>break</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=k>default</span><span class=o>:</span>
</span></span><span class=line><span class=cl>                <span class=c1>//do nothing
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=参考链接>参考链接</h2><ul><li><a href=https://blog.csdn.net/u013088495/article/details/80366147 target=_blank rel="noopener noreffer">java 关于时间返回结果与参数的注解@DatetimeFormat和@JsonFormat</a></li><li><a href=https://blog.csdn.net/u010234516/article/details/84316340 target=_blank rel="noopener noreffer">@JsonProperty和@JsonAlias的区别</a></li><li><a href=https://blog.csdn.net/qq_29407009/article/details/78110052 target=_blank rel="noopener noreffer">JPA中因双向依赖而造成的json怪相 相互访问造成溢出</a></li></ul><div class="details admonition warning open"><div class="details-summary admonition-title"><i class="icon fas fa-exclamation-triangle fa-fwwarning"></i>警告<i class="details-icon fas fa-angle-right fa-fw"></i></div><div class=details-content><div class=admonition-content>本文最后更新于 <span class=timeago datetime=2022-01-04T23:45:42 title="January 4, 2022">January 4, 2022</span>，文中内容可能已过时，请谨慎使用。</div></div></div><div class=post-reward><input type=checkbox name=reward id=reward hidden>
<label class=reward-button for=reward>赞赏支持</label><div class=qr-code><label class=qr-code-image for=reward><img class=image src=https://lewky.cn/images/reward/wechat.png>
<span>微信打赏</span></label>
<label class=qr-code-image for=reward><img class=image src=https://lewky.cn/images/reward/alipay.png>
<span>支付宝打赏</span></label></div></div></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>更新于 2022-01-04</span></div><div class=post-info-license><span><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-markdown href=/posts/jackson-issues/index.md target=_blank>阅读原始文档</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 Twitter" data-sharer=twitter data-url=https://lewky.cn/posts/jackson-issues/ data-title=Jackson问题汇总 data-hashtags=Jackson><i class="fab fa-twitter fa-fw"></i></a><a href=javascript:void(0); title="分享到 Facebook" data-sharer=facebook data-url=https://lewky.cn/posts/jackson-issues/ data-hashtag=Jackson><i class="fab fa-facebook-square fa-fw"></i></a><a href=javascript:void(0); title="分享到 Hacker News" data-sharer=hackernews data-url=https://lewky.cn/posts/jackson-issues/ data-title=Jackson问题汇总><i class="fab fa-hacker-news fa-fw"></i></a><a href=javascript:void(0); title="分享到 Line" data-sharer=line data-url=https://lewky.cn/posts/jackson-issues/ data-title=Jackson问题汇总><i data-svg-src=https://unpkg.com/simple-icons@2.14.0/icons/line.svg></i></a><a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://lewky.cn/posts/jackson-issues/ data-title=Jackson问题汇总><i class="fab fa-weibo fa-fw"></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/tags/jackson/>Jackson</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/posts/javaweb-servlet-issues/ class=prev rel=prev title="Java Servlet问题汇总"><i class="fas fa-angle-left fa-fw"></i>Java Servlet问题汇总</a>
<a href=/posts/lombok-issues/ class=next rel=next title=lombok问题汇总>lombok问题汇总<i class="fas fa-angle-right fa-fw"></i></a></div></div><div id=comments><div id=waline></div><script src=/js/Waline.min.js></script>
<script>new Waline({el:"#waline",meta:["nick","mail","link"],requiredMeta:["nick","mail"],login:"force",placeholder:"为防恶意灌水攻击，评论前需注册并登录，望见谅~",serverURL:"https://comment.lewky.cn/",avatarCDN:"https://cravatar.cn/avatar/",pageSize:20,avatar:"retro",lang:"zh-CN",visitor:!0,highlight:!0,uploadImage:!1,emoji:["https://lewky.cn/images/emoji/嘉然今天吃什么","https://lewky.cn/images/emoji/大航海嘉然","https://lewky.cn/images/emoji/向晚大魔王","https://lewky.cn/images/emoji/贝拉kira","https://lewky.cn/images/emoji/珈乐Carol","https://lewky.cn/images/emoji/乃琳Queen","https://lewky.cn/images/emoji/EveOneCat","https://lewky.cn/images/emoji/weibo","https://lewky.cn/images/emoji/滑稽","https://lewky.cn/images/emoji/default"]})</script></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line><span id=run-time></span>|
<a href=http://rssblog.vercel.app/ target=_blank rel=noopener title=RSSBlog><i class='fas fa-fw fa-inbox'></i>&nbsp;RSSBlog</a></div><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2018 - 2023</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank>雨临Lewis</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span><span class=icp-splitter>&nbsp;|&nbsp;</span><br class=icp-br><span class=icp><a target=_blank href=http://www.beian.miit.gov.cn/ style=font-weight:700>粤ICP备19103822</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到顶部><i class="fas fa-arrow-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fas fa-comment fa-fw"></i></a></div><div class=sidebar_wo><div id=leimu><img src=https://lewky.cn/images/b2t/leimuA.png alt=雷姆 onmouseover='this.src="https://lewky.cn/images/b2t/leimuB.png"' onmouseout='this.src="https://lewky.cn/images/b2t/leimuA.png"' title=回到顶部></div><div class=sidebar_wo id=lamu><img src=https://lewky.cn/images/b2t/lamuA.png alt=雷姆 onmouseover='this.src="https://lewky.cn/images/b2t/lamuB.png"' onmouseout='this.src="https://lewky.cn/images/b2t/lamuA.png"' title=回到底部></div></div><link rel=stylesheet href=https://unpkg.com/lightgallery.js@1.2.0/dist/css/lightgallery.min.css><script type=text/javascript src=https://unpkg.com/smooth-scroll@16.1.3/dist/smooth-scroll.min.js></script><script type=text/javascript src=https://unpkg.com/lazysizes@5.2.2/lazysizes.min.js></script><script type=text/javascript src=https://unpkg.com/lightgallery.js@1.2.0/dist/js/lightgallery.min.js></script><script type=text/javascript src=https://unpkg.com/lg-thumbnail.js@1.2.0/dist/lg-thumbnail.min.js></script><script type=text/javascript src=https://unpkg.com/lg-zoom.js@1.2.0/dist/lg-zoom.min.js></script><script type=text/javascript src=https://unpkg.com/clipboard@2.0.6/dist/clipboard.min.js></script><script type=text/javascript src=https://unpkg.com/sharer.js@0.4.0/sharer.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"复制到剪贴板",maxShownLines:30},comment:{},lightGallery:{actualSize:!1,exThumbImage:"data-thumbnail",hideBarsDelay:2e3,selector:".lightgallery",speed:400,thumbContHeight:80,thumbWidth:80,thumbnail:!0}}</script><script type=text/javascript src=/js/theme.min.js></script><script type=text/javascript src=https://unpkg.com/jquery@2.1.3/dist/jquery.min.js></script><script type=text/javascript src=https://unpkg.com/jquery-backstretch@2.1.18/jquery.backstretch.min.js></script><script>var $cdnPrefix="https://lewky.cn"</script>
<script type=text/javascript src=/js/custom.js></script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?6f278ed0fdb01edb3b1e7398379e5432",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script></body></html>